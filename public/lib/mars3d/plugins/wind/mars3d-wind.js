/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.6.15
 * 编译日期：2023-12-05 11:26:00
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x254ba6=_0x4321;(function(_0x2796a4,_0x5bc8a9){const _0x1e9e54=_0x4321,_0x56ab6b=_0x2796a4();while(!![]){try{const _0x257f73=parseInt(_0x1e9e54(0xe3))/0x1*(-parseInt(_0x1e9e54(0x14f))/0x2)+parseInt(_0x1e9e54(0x170))/0x3*(parseInt(_0x1e9e54(0x1bd))/0x4)+-parseInt(_0x1e9e54(0x1c3))/0x5*(parseInt(_0x1e9e54(0x101))/0x6)+-parseInt(_0x1e9e54(0x19d))/0x7+-parseInt(_0x1e9e54(0xf8))/0x8*(-parseInt(_0x1e9e54(0xdd))/0x9)+-parseInt(_0x1e9e54(0x165))/0xa+parseInt(_0x1e9e54(0x11b))/0xb;if(_0x257f73===_0x5bc8a9)break;else _0x56ab6b['push'](_0x56ab6b['shift']());}catch(_0x4a3385){_0x56ab6b['push'](_0x56ab6b['shift']());}}}(_0x2db2,0xf2a2b));function _interopNamespace(_0x598a5f){if(_0x598a5f&&_0x598a5f['__esModule'])return _0x598a5f;var _0x3f9188=Object['create'](null);return _0x598a5f&&Object['keys'](_0x598a5f)['forEach'](function(_0x28dc60){const _0x170780=_0x4321;if(_0x28dc60!==_0x170780(0x183)){var _0x157790=Object[_0x170780(0xeb)](_0x598a5f,_0x28dc60);Object[_0x170780(0x104)](_0x3f9188,_0x28dc60,_0x157790['get']?_0x157790:{'enumerable':!![],'get':function(){return _0x598a5f[_0x28dc60];}});}}),_0x3f9188['default']=_0x598a5f,_0x3f9188;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace['Cesium'];function getU(_0x3404c4,_0x2d405d){const _0x34b49c=_0x4321,_0x1cda92=_0x3404c4*Math['cos'](Cesium$7[_0x34b49c(0x1a8)]['toRadians'](_0x2d405d));return _0x1cda92;}function getV(_0x1f9d92,_0x9bba5f){const _0x488cba=_0x4321,_0x4383b1=_0x1f9d92*Math['sin'](Cesium$7['Math'][_0x488cba(0x109)](_0x9bba5f));return _0x4383b1;}function getSpeed(_0x48f826,_0x22dc91){const _0x3a948e=_0x4321,_0x39b10a=Math['sqrt'](Math['pow'](_0x48f826,0x2)+Math[_0x3a948e(0x1ca)](_0x22dc91,0x2));return _0x39b10a;}function getDirection(_0x95f8b3,_0x52187e){const _0x412b6b=_0x4321;let _0x2dd036=Cesium$7[_0x412b6b(0x1a8)]['toDegrees'](Math['atan2'](_0x52187e,_0x95f8b3));return _0x2dd036+=_0x2dd036<0x0?0x168:0x0,_0x2dd036;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0x1adabd){const _0x1ba39c=_0x4321;this[_0x1ba39c(0x1c1)]=_0x1adabd['commandType'],this[_0x1ba39c(0x128)]=_0x1adabd[_0x1ba39c(0x128)],this[_0x1ba39c(0x16a)]=_0x1adabd['attributeLocations'],this['primitiveType']=_0x1adabd[_0x1ba39c(0x103)],this['uniformMap']=_0x1adabd['uniformMap'],this['vertexShaderSource']=_0x1adabd['vertexShaderSource'],this['fragmentShaderSource']=_0x1adabd['fragmentShaderSource'],this['rawRenderState']=_0x1adabd['rawRenderState'],this['framebuffer']=_0x1adabd[_0x1ba39c(0x14b)],this[_0x1ba39c(0x1b0)]=_0x1adabd['outputTexture'],this[_0x1ba39c(0x12e)]=_0x1adabd['autoClear']??![],this[_0x1ba39c(0x18a)]=_0x1adabd['preExecute'],this['show']=!![],this['commandToExecute']=undefined,this['clearCommand']=undefined,this['autoClear']&&(this['clearCommand']=new Cesium$6['ClearCommand']({'color':new Cesium$6[(_0x1ba39c(0x162))](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE']}));}[_0x254ba6(0x18e)](_0x37a6e4){const _0x37c642=_0x254ba6;switch(this['commandType']){case'Draw':{const _0x35145d=Cesium$6[_0x37c642(0x17d)]['fromGeometry']({'context':_0x37a6e4,'geometry':this['geometry'],'attributeLocations':this[_0x37c642(0x16a)],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']}),_0x141161=Cesium$6[_0x37c642(0x168)][_0x37c642(0x108)]({'context':_0x37a6e4,'attributeLocations':this[_0x37c642(0x16a)],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this['fragmentShaderSource']}),_0x4e9782=Cesium$6['RenderState']['fromCache'](this[_0x37c642(0x187)]);return new Cesium$6['DrawCommand']({'primitiveType':this[_0x37c642(0x103)],'shaderProgram':_0x141161,'vertexArray':_0x35145d,'modelMatrix':Cesium$6['Matrix4'][_0x37c642(0x126)],'renderState':_0x4e9782,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this[_0x37c642(0x14b)],'pass':Cesium$6['Pass']['OPAQUE'],'pickOnly':!![],'owner':this});}case _0x37c642(0xf9):{return new Cesium$6[(_0x37c642(0x1c2))]({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this[_0x37c642(0x17e)],'outputTexture':this['outputTexture'],'persists':!![]});}}}['setGeometry'](_0x235664,_0x22e240){const _0x49e6d1=_0x254ba6;this[_0x49e6d1(0x128)]=_0x22e240;const _0x233f75=Cesium$6['VertexArray']['fromGeometry']({'context':_0x235664,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage'][_0x49e6d1(0x15f)]});this['commandToExecute']['vertexArray']=_0x233f75;}['update'](_0x29e91a){const _0x591900=_0x254ba6;if(!this[_0x591900(0x16e)])return;if(_0x29e91a['mode']!==Cesium$6['SceneMode'][_0x591900(0x16f)])return;!Cesium$6['defined'](this['commandToExecute'])&&(this['commandToExecute']=this['createCommand'](_0x29e91a[_0x591900(0x1b7)])),Cesium$6['defined'](this['preExecute'])&&this[_0x591900(0x18a)](),Cesium$6[_0x591900(0xea)](this['clearCommand'])&&_0x29e91a['commandList']['push'](this['clearCommand']),_0x29e91a['commandList'][_0x591900(0x13f)](this['commandToExecute']);}['isDestroyed'](){return![];}[_0x254ba6(0x169)](){const _0x566e83=_0x254ba6;if(this['clearCommand']){var _0x1cba2c,_0x417235;(_0x1cba2c=this['clearCommand'])!==null&&_0x1cba2c!==void 0x0&&_0x1cba2c['vertexArray']&&this['clearCommand']['vertexArray'][_0x566e83(0x169)](),(_0x417235=this[_0x566e83(0x1bc)])!==null&&_0x417235!==void 0x0&&_0x417235[_0x566e83(0x15d)]&&this[_0x566e83(0x1bc)]['shaderProgram']['destroy'](),delete this['clearCommand'];}return this['commandToExecute']&&(this[_0x566e83(0x12c)][_0x566e83(0x10f)]&&this['commandToExecute'][_0x566e83(0x10f)][_0x566e83(0x169)](),this['commandToExecute']['shaderProgram']&&this['commandToExecute']['shaderProgram']['destroy'](),delete this[_0x566e83(0x12c)]),Cesium$6['destroyObject'](this);}}const Cesium$5=mars3d__namespace[_0x254ba6(0x111)],Util=(function(){const _0xe1894e=function(){const _0x2f948e=_0x4321,_0x376f9f=new Cesium$5['Geometry']({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5[_0x2f948e(0x146)][_0x2f948e(0x115)],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x376f9f;},_0x5a3a12=function(_0x33ddcb,_0xd013af){const _0x327031=_0x4321;if(Cesium$5['defined'](_0xd013af)){const _0x465f15={};_0x465f15['arrayBufferView']=_0xd013af,_0x33ddcb['source']=_0x465f15;}const _0x23dac2=new Cesium$5[(_0x327031(0x129))](_0x33ddcb);return _0x23dac2;},_0x3a0768=function(_0x36b9c4,_0x19137a,_0x493811){const _0x47f129=new Cesium$5['Framebuffer']({'context':_0x36b9c4,'colorTextures':[_0x19137a],'depthTexture':_0x493811});return _0x47f129;},_0xbb9a34=function(_0xed490a){const _0x4fd26a=_0x4321,_0x407c3e=!![],_0x1bea5e=![],_0x3bf404={'viewport':_0xed490a['viewport'],'depthTest':_0xed490a['depthTest'],'depthMask':_0xed490a['depthMask'],'blending':_0xed490a[_0x4fd26a(0xf1)]},_0x17d4b6=Cesium$5['Appearance']['getDefaultRenderState'](_0x407c3e,_0x1bea5e,_0x3bf404);return _0x17d4b6;},_0x3538f1=function(_0x5bd90f){const _0x2cd7ed=_0x4321,_0xe81ed2={},_0x4e04db=Cesium$5['Math']['mod'](_0x5bd90f['west'],Cesium$5['Math']['TWO_PI']),_0x474247=Cesium$5[_0x2cd7ed(0x1a8)]['mod'](_0x5bd90f[_0x2cd7ed(0x1a1)],Cesium$5['Math'][_0x2cd7ed(0x1af)]),_0x1cb45c=_0x5bd90f['width'];let _0x4d33b1,_0xa7c3d;_0x1cb45c>Cesium$5[_0x2cd7ed(0x1a8)][_0x2cd7ed(0x179)]?(_0x4d33b1=0x0,_0xa7c3d=Cesium$5['Math']['TWO_PI']):_0x474247-_0x4e04db<_0x1cb45c?(_0x4d33b1=_0x4e04db,_0xa7c3d=_0x4e04db+_0x1cb45c):(_0x4d33b1=_0x4e04db,_0xa7c3d=_0x474247);_0xe81ed2['lon']={'min':Cesium$5['Math']['toDegrees'](_0x4d33b1),'max':Cesium$5['Math']['toDegrees'](_0xa7c3d)};const _0x49a824=_0x5bd90f['south'],_0x535751=_0x5bd90f[_0x2cd7ed(0x177)],_0x3b54c0=_0x5bd90f['height'],_0x3547ee=_0x3b54c0>Cesium$5['Math']['PI']/0xc?_0x3b54c0/0x2:0x0;let _0x585b56=Cesium$5[_0x2cd7ed(0x1a8)]['clampToLatitudeRange'](_0x49a824-_0x3547ee),_0x385f09=Cesium$5['Math']['clampToLatitudeRange'](_0x535751+_0x3547ee);return _0x585b56<-Cesium$5['Math'][_0x2cd7ed(0x161)]&&(_0x585b56=-Cesium$5[_0x2cd7ed(0x1a8)]['PI_OVER_TWO']),_0x385f09>Cesium$5[_0x2cd7ed(0x1a8)]['PI_OVER_THREE']&&(_0x385f09=Cesium$5[_0x2cd7ed(0x1a8)]['PI_OVER_TWO']),_0xe81ed2[_0x2cd7ed(0xe4)]={'min':Cesium$5['Math']['toDegrees'](_0x585b56),'max':Cesium$5['Math']['toDegrees'](_0x385f09)},_0xe81ed2;};return{'getFullscreenQuad':_0xe1894e,'createTexture':_0x5a3a12,'createFramebuffer':_0x3a0768,'createRawRenderState':_0xbb9a34,'viewRectangleToLonLatRange':_0x3538f1};}());var segmentDraw_vert=_0x254ba6(0x12a),segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert=_0x254ba6(0x13c),trailDraw_frag=_0x254ba6(0x1c4),screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace['Cesium'];class ParticlesRendering{constructor(_0x1211d6,_0x294653,_0x3f3456,_0x507ca1,_0x166265){const _0x3bc1a1=_0x254ba6;this['createRenderingTextures'](_0x1211d6,_0x294653,_0x3f3456['colors']),this[_0x3bc1a1(0x1a0)](_0x1211d6),this['createRenderingPrimitives'](_0x1211d6,_0x3f3456,_0x507ca1,_0x166265);}['createRenderingTextures'](_0x5f3e5a,_0x4f56b0,_0x2785c3){const _0x550aec=_0x254ba6,_0x13516f={'context':_0x5f3e5a,'width':_0x5f3e5a['drawingBufferWidth'],'height':_0x5f3e5a['drawingBufferHeight'],'pixelFormat':Cesium$4[_0x550aec(0x119)]['RGBA'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_BYTE']},_0x266229={'context':_0x5f3e5a,'width':_0x5f3e5a['drawingBufferWidth'],'height':_0x5f3e5a['drawingBufferHeight'],'pixelFormat':Cesium$4[_0x550aec(0x119)]['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_INT']},_0x547165=_0x2785c3['length'],_0x401d8f=new Float32Array(_0x547165*0x3);for(let _0x4ae8b8=0x0;_0x4ae8b8<_0x547165;_0x4ae8b8++){const _0x282f62=Cesium$4['Color']['fromCssColorString'](_0x2785c3[_0x4ae8b8]);_0x401d8f[0x3*_0x4ae8b8]=_0x282f62['red'],_0x401d8f[0x3*_0x4ae8b8+0x1]=_0x282f62['green'],_0x401d8f[0x3*_0x4ae8b8+0x2]=_0x282f62[_0x550aec(0x14e)];}const _0x3b4732={'context':_0x5f3e5a,'width':_0x547165,'height':0x1,'pixelFormat':Cesium$4['PixelFormat']['RGB'],'pixelDatatype':Cesium$4['PixelDatatype']['FLOAT'],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4['TextureMinificationFilter'][_0x550aec(0x13a)],'magnificationFilter':Cesium$4['TextureMagnificationFilter'][_0x550aec(0x13a)]})};this['textures']={'segmentsColor':Util[_0x550aec(0x137)](_0x13516f),'segmentsDepth':Util[_0x550aec(0x137)](_0x266229),'currentTrailsColor':Util['createTexture'](_0x13516f),'currentTrailsDepth':Util[_0x550aec(0x137)](_0x266229),'nextTrailsColor':Util['createTexture'](_0x13516f),'nextTrailsDepth':Util[_0x550aec(0x137)](_0x266229),'colorTable':Util['createTexture'](_0x3b4732,_0x401d8f)};}['createRenderingFramebuffers'](_0x52369a){const _0x558a64=_0x254ba6;this['framebuffers']={'segments':Util[_0x558a64(0x15c)](_0x52369a,this['textures']['segmentsColor'],this['textures']['segmentsDepth']),'currentTrails':Util[_0x558a64(0x15c)](_0x52369a,this[_0x558a64(0x12b)][_0x558a64(0x12d)],this['textures'][_0x558a64(0x14a)]),'nextTrails':Util['createFramebuffer'](_0x52369a,this['textures']['nextTrailsColor'],this[_0x558a64(0x12b)]['nextTrailsDepth'])};}[_0x254ba6(0x11f)](_0x4cb038){const _0x222c9f=_0x254ba6,_0x3f261b=0x4;let _0x59bc22=[];for(let _0x151542=0x0;_0x151542<_0x4cb038['particlesTextureSize'];_0x151542++){for(let _0x2d6783=0x0;_0x2d6783<_0x4cb038['particlesTextureSize'];_0x2d6783++){for(let _0x3ab8a9=0x0;_0x3ab8a9<_0x3f261b;_0x3ab8a9++){_0x59bc22['push'](_0x151542/_0x4cb038['particlesTextureSize']),_0x59bc22['push'](_0x2d6783/_0x4cb038['particlesTextureSize']);}}}_0x59bc22=new Float32Array(_0x59bc22);let _0x7bab9=[];const _0x5b2e0e=[-0x1,0x1],_0x12308e=[-0x1,0x1];for(let _0xb75480=0x0;_0xb75480<_0x4cb038[_0x222c9f(0x17b)];_0xb75480++){for(let _0xb47afa=0x0;_0xb47afa<_0x3f261b/0x2;_0xb47afa++){for(let _0x16c997=0x0;_0x16c997<_0x3f261b/0x2;_0x16c997++){_0x7bab9[_0x222c9f(0x13f)](_0x5b2e0e[_0xb47afa]),_0x7bab9[_0x222c9f(0x13f)](_0x12308e[_0x16c997]),_0x7bab9['push'](0x0);}}}_0x7bab9=new Float32Array(_0x7bab9);const _0xee4a2f=0x6*_0x4cb038['maxParticles'],_0x12ad3d=new Uint32Array(_0xee4a2f);for(let _0xe82e74=0x0,_0xf531b7=0x0,_0x72520=0x0;_0xe82e74<_0x4cb038[_0x222c9f(0x17b)];_0xe82e74++){_0x12ad3d[_0xf531b7++]=_0x72520+0x0,_0x12ad3d[_0xf531b7++]=_0x72520+0x1,_0x12ad3d[_0xf531b7++]=_0x72520+0x2,_0x12ad3d[_0xf531b7++]=_0x72520+0x2,_0x12ad3d[_0xf531b7++]=_0x72520+0x1,_0x12ad3d[_0xf531b7++]=_0x72520+0x3,_0x72520+=0x4;}const _0x2cca3c=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':_0x59bc22}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4[_0x222c9f(0x146)]['FLOAT'],'componentsPerAttribute':0x3,'values':_0x7bab9})}),'indices':_0x12ad3d});return _0x2cca3c;}['createRenderingPrimitives'](_0x7dafdd,_0x3f86d9,_0x2ac1f5,_0x50fe3c){const _0x1fd103=_0x254ba6,_0x461511=this;this[_0x1fd103(0x151)]={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x3f86d9),'primitiveType':Cesium$4['PrimitiveType'][_0x1fd103(0x122)],'uniformMap':{'currentParticlesPosition':function(){const _0x2e60d3=_0x1fd103;return _0x50fe3c['particlesTextures'][_0x2e60d3(0x164)];},'postProcessingPosition':function(){return _0x50fe3c['particlesTextures']['postProcessingPosition'];},'postProcessingSpeed':function(){return _0x50fe3c['particlesTextures']['postProcessingSpeed'];},'colorTable':function(){return _0x461511['textures']['colorTable'];},'aspect':function(){const _0x1aabc2=_0x1fd103;return _0x7dafdd['drawingBufferWidth']/_0x7dafdd[_0x1aabc2(0x107)];},'pixelSize':function(){const _0x5eab19=_0x1fd103;return _0x2ac1f5[_0x5eab19(0x171)];},'lineWidth':function(){return _0x3f86d9['lineWidth'];},'particleHeight':function(){return _0x3f86d9['particleHeight'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4[(_0x1fd103(0x1aa))]({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this[_0x1fd103(0x1b6)][_0x1fd103(0x17f)],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':_0x1fd103(0x145),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){const _0x22a00b=_0x1fd103;return _0x461511[_0x22a00b(0x12b)]['segmentsColor'];},'segmentsDepthTexture':function(){return _0x461511['textures']['segmentsDepth'];},'currentTrailsColor':function(){const _0x23d673=_0x1fd103;return _0x461511[_0x23d673(0x1b6)]['currentTrails'][_0x23d673(0x197)](0x0);},'trailsDepthTexture':function(){const _0x3dfa34=_0x1fd103;return _0x461511['framebuffers'][_0x3dfa34(0x188)]['depthTexture'];},'fadeOpacity':function(){return _0x3f86d9['fadeOpacity'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x1fd103(0xff)],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this['framebuffers'][_0x1fd103(0x1a5)],'autoClear':!![],'preExecute':function(){const _0x22ac82=_0x1fd103,_0xcce81a=_0x461511[_0x22ac82(0x1b6)][_0x22ac82(0x188)];_0x461511['framebuffers']['currentTrails']=_0x461511['framebuffers'][_0x22ac82(0x1a5)],_0x461511['framebuffers']['nextTrails']=_0xcce81a,_0x461511['primitives']['trails']['commandToExecute']['framebuffer']=_0x461511['framebuffers']['nextTrails'],_0x461511['primitives']['trails']['clearCommand'][_0x22ac82(0x14b)]=_0x461511[_0x22ac82(0x1b6)]['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType'][_0x1fd103(0x122)],'uniformMap':{'trailsColorTexture':function(){const _0x25aa3f=_0x1fd103;return _0x461511[_0x25aa3f(0x1b6)][_0x25aa3f(0x1a5)]['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x5af593=_0x1fd103;return _0x461511[_0x5af593(0x1b6)]['nextTrails']['depthTexture'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x1fd103(0x154)],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag=_0x254ba6(0x1ba),updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace['Cesium'];function _0x2db2(){const _0x23e611=['Draw','ComponentDatatype','getOptions','postProcessingPosition','xmax','currentTrailsDepth','framebuffer','dropRate','_data','blue','2HFmtZV','all','primitives','_addedHook','canvas','DISABLE_GL_POSITION_LOG_DEPTH','_map','_createCanvas','particlesComputing','data','particlesTextures','width','_updateIng','createFramebuffer','shaderProgram','now','STATIC_DRAW','_tomap','PI_OVER_THREE','Color','_updateIng2','currentParticlesPosition','6182290onEIWh','NEAREST','wind','ShaderProgram','destroy','attributeLocations','lon','_colorRamp','color','show','SCENE3D','3fsblrT','pixelSize','computeViewRectangle','cols','tlat','canvasResize','speedRate','north','LayerUtil','THREE_PI_OVER_TWO','ymin','maxParticles','EventType','VertexArray','uniformMap','segments','lev','removeChild','_setOptionsHook','default','_pointerEvents','sqrt','getUVByPoint','rawRenderState','currentTrails','nextParticlesPosition','preExecute','windData','rows','_onMouseUpEvent','createCommand','_onMapWhellEvent','forEach','setData','TextureMinificationFilter','addPrimitives','canvasWidth','particles','cancelAnimationFrame','getColorTexture','vmin','Cartesian3','maxAge','speedFactor','array','8505742bUrECz','umin','camera','createRenderingFramebuffers','east','requestAnimationFrame','max','age','nextTrails','mouseDown','ymax','Math','particlesNumber','ShaderSource','register','particleSystem','onmessage','scene','TWO_PI','outputTexture','options','height','hidden','drawingBufferWidth','fixedHeight','framebuffers','context','mode','mouseMove','//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a','viewerParameters','clearCommand','2864596giyWSi','colors','getUVByXY','dimensions','commandType','ComputeCommand','25hUYwqU','uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a','postMessage','keys','length','Pass','refreshParticles','pow','randomBetween','1259289uoSByX','particlesWind','_mountedHook','bind','_removedHook','getParticles','773821UNWYkv','lat','xmin','layer','getWind','nextParticlesSpeed','zIndex','defined','getOwnPropertyDescriptor','preRender','update','fromDegrees','tlng','SceneTransforms','blending','frameRate','particlesRendering','worker','redraw','_randomParticle','setDate','40cnzBuI','Compute','vdata','off','clientWidth','fadeOpacity','_maxAge','DISABLE_LOG_DEPTH_FRAGMENT_WRITE','mouseUp','1536510ZJmwWF','speed','primitiveType','defineProperty','add','auto','drawingBufferHeight','fromCache','toRadians','canvasContext','canvasHeight','top','bindEvent','min','vertexArray','_calc_speedRate','Cesium','_onMouseMoveEvent','mouse_move','trails','FLOAT','windTextures','Cartesian2','setOptions','PixelFormat','floor','38122282jkWrMg','removeAll','levmin','fromGeometry','createSegmentsGeometry','_drawLines','reverseY','TRIANGLES','ceil','particlesTextureSize','lonRange','IDENTITY','lineWidth','geometry','Texture','in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a','textures','commandToExecute','currentTrailsColor','autoClear','resize','latRange','style','windField','_canrefresh','screen','clear','none','createTexture','create','initWorker','LINEAR','visibility','in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a','pointer-events','lng','push','createParticlesTextures','WindLayer','dropRateBump','colorTable','mouseHidden'];_0x2db2=function(){return _0x23e611;};return _0x2db2();}class ParticlesComputing{constructor(_0x20be4c,_0x5f0ea5,_0x10de13,_0x4d470d){const _0x2d8ba4=_0x254ba6;this[_0x2d8ba4(0x158)]=_0x5f0ea5,this['createWindTextures'](_0x20be4c,_0x5f0ea5),this[_0x2d8ba4(0x140)](_0x20be4c,_0x10de13,_0x4d470d),this['createComputingPrimitives'](_0x5f0ea5,_0x10de13,_0x4d470d);}['createWindTextures'](_0x4f50d0,_0x5b867e){const _0x2f2654=_0x254ba6,_0x4417d4={'context':_0x4f50d0,'width':_0x5b867e['dimensions']['lon'],'height':_0x5b867e['dimensions'][_0x2f2654(0xe4)]*(_0x5b867e['dimensions']['lev']||0x1),'pixelFormat':Cesium$3['PixelFormat']['LUMINANCE'],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3[_0x2f2654(0x192)]['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})};this[_0x2f2654(0x116)]={'U':Util['createTexture'](_0x4417d4,_0x5b867e['U']['array']),'V':Util['createTexture'](_0x4417d4,_0x5b867e['V']['array'])};}[_0x254ba6(0x140)](_0x328c1b,_0x423934,_0x2c5bd8){const _0x17f07f=_0x254ba6,_0x1be9fb={'context':_0x328c1b,'width':_0x423934[_0x17f07f(0x124)],'height':_0x423934['particlesTextureSize'],'pixelFormat':Cesium$3['PixelFormat']['RGBA'],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter'][_0x17f07f(0x166)]})},_0x3547fa=this['randomizeParticles'](_0x423934['maxParticles'],_0x2c5bd8),_0x28ce7c=new Float32Array(0x4*_0x423934['maxParticles'])['fill'](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x1be9fb),'currentParticlesPosition':Util['createTexture'](_0x1be9fb,_0x3547fa),'nextParticlesPosition':Util[_0x17f07f(0x137)](_0x1be9fb,_0x3547fa),'currentParticlesSpeed':Util[_0x17f07f(0x137)](_0x1be9fb,_0x28ce7c),'nextParticlesSpeed':Util['createTexture'](_0x1be9fb,_0x28ce7c),'postProcessingPosition':Util['createTexture'](_0x1be9fb,_0x3547fa),'postProcessingSpeed':Util[_0x17f07f(0x137)](_0x1be9fb,_0x28ce7c)};}['randomizeParticles'](_0x434b57,_0x1a8ad2){const _0x5e5cfd=_0x254ba6,_0x309edc=new Float32Array(0x4*_0x434b57);for(let _0x14db21=0x0;_0x14db21<_0x434b57;_0x14db21++){_0x309edc[0x4*_0x14db21]=Cesium$3['Math']['randomBetween'](_0x1a8ad2['lonRange']['x'],_0x1a8ad2['lonRange']['y']),_0x309edc[0x4*_0x14db21+0x1]=Cesium$3['Math'][_0x5e5cfd(0x1cb)](_0x1a8ad2['latRange']['x'],_0x1a8ad2['latRange']['y']),_0x309edc[0x4*_0x14db21+0x2]=Cesium$3['Math']['randomBetween'](this[_0x5e5cfd(0x158)]['lev']['min'],this['data'][_0x5e5cfd(0x180)]['max']),_0x309edc[0x4*_0x14db21+0x3]=0x0;}return _0x309edc;}['destroyParticlesTextures'](){const _0x3bab08=_0x254ba6;Object[_0x3bab08(0x1c6)](this['particlesTextures'])['forEach'](_0x2ef402=>{this['particlesTextures'][_0x2ef402]['destroy']();});}['createComputingPrimitives'](_0x507e07,_0x8bc989,_0x380cb3){const _0x2d9e84=_0x254ba6,_0x20bd47=new Cesium$3['Cartesian3'](_0x507e07['dimensions']['lon'],_0x507e07['dimensions']['lat'],_0x507e07['dimensions']['lev']),_0x565f3a=new Cesium$3['Cartesian3'](_0x507e07['lon'][_0x2d9e84(0x10e)],_0x507e07[_0x2d9e84(0xe4)][_0x2d9e84(0x10e)],_0x507e07['lev']['min']),_0xfc5422=new Cesium$3[(_0x2d9e84(0x199))](_0x507e07[_0x2d9e84(0x16b)]['max'],_0x507e07['lat']['max'],_0x507e07[_0x2d9e84(0x180)]['max']),_0x50c37e=new Cesium$3['Cartesian3']((_0xfc5422['x']-_0x565f3a['x'])/(_0x20bd47['x']-0x1),(_0xfc5422['y']-_0x565f3a['y'])/(_0x20bd47['y']-0x1),_0x20bd47['z']>0x1?(_0xfc5422['z']-_0x565f3a['z'])/(_0x20bd47['z']-0x1):0x1),_0x30e40e=new Cesium$3['Cartesian2'](_0x507e07['U'][_0x2d9e84(0x10e)],_0x507e07['U'][_0x2d9e84(0x1a3)]),_0x4b58bf=new Cesium$3['Cartesian2'](_0x507e07['V'][_0x2d9e84(0x10e)],_0x507e07['V'][_0x2d9e84(0x1a3)]),_0x118520=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){const _0x285c2f=_0x2d9e84;return _0x118520[_0x285c2f(0x116)]['U'];},'V':function(){const _0x5bd539=_0x2d9e84;return _0x118520[_0x5bd539(0x116)]['V'];},'currentParticlesPosition':function(){const _0x25ed77=_0x2d9e84;return _0x118520['particlesTextures'][_0x25ed77(0x164)];},'dimension':function(){return _0x20bd47;},'minimum':function(){return _0x565f3a;},'maximum':function(){return _0xfc5422;},'interval':function(){return _0x50c37e;}},'fragmentShaderSource':new Cesium$3[(_0x2d9e84(0x1aa))]({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures']['particlesWind'],'preExecute':function(){const _0x246063=_0x2d9e84;_0x118520['primitives']['getWind']['commandToExecute'][_0x246063(0x1b0)]=_0x118520[_0x246063(0x159)][_0x246063(0xde)];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){return _0x118520['particlesTextures']['currentParticlesSpeed'];},'particlesWind':function(){const _0x209a9e=_0x2d9e84;return _0x118520[_0x209a9e(0x159)][_0x209a9e(0xde)];},'uSpeedRange':function(){return _0x30e40e;},'vSpeedRange':function(){return _0x4b58bf;},'pixelSize':function(){const _0x28ce80=_0x2d9e84;return _0x380cb3[_0x28ce80(0x171)];},'speedFactor':function(){return _0x8bc989['speedFactor'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this[_0x2d9e84(0x159)]['nextParticlesSpeed'],'preExecute':function(){const _0x43a27d=_0x2d9e84,_0x4b6a72=_0x118520['particlesTextures']['currentParticlesSpeed'];_0x118520['particlesTextures']['currentParticlesSpeed']=_0x118520[_0x43a27d(0x159)]['postProcessingSpeed'],_0x118520[_0x43a27d(0x159)]['postProcessingSpeed']=_0x4b6a72,_0x118520[_0x43a27d(0x151)]['updateSpeed'][_0x43a27d(0x12c)][_0x43a27d(0x1b0)]=_0x118520['particlesTextures']['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){return _0x118520['particlesTextures']['currentParticlesPosition'];},'currentParticlesSpeed':function(){return _0x118520['particlesTextures']['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures']['nextParticlesPosition'],'preExecute':function(){const _0xa1fae7=_0x2d9e84,_0x49a2b8=_0x118520['particlesTextures']['currentParticlesPosition'];_0x118520[_0xa1fae7(0x159)]['currentParticlesPosition']=_0x118520['particlesTextures']['postProcessingPosition'],_0x118520['particlesTextures']['postProcessingPosition']=_0x49a2b8,_0x118520['primitives']['updatePosition'][_0xa1fae7(0x12c)]['outputTexture']=_0x118520[_0xa1fae7(0x159)]['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){const _0x2e2349=_0x2d9e84;return _0x118520['particlesTextures'][_0x2e2349(0x189)];},'nextParticlesSpeed':function(){const _0x2dcd76=_0x2d9e84;return _0x118520['particlesTextures'][_0x2dcd76(0xe8)];},'lonRange':function(){return _0x380cb3['lonRange'];},'latRange':function(){return _0x380cb3['latRange'];},'randomCoefficient':function(){const _0x1cf8db=Math['random']();return _0x1cf8db;},'dropRate':function(){return _0x8bc989['dropRate'];},'dropRateBump':function(){return _0x8bc989['dropRateBump'];}},'fragmentShaderSource':new Cesium$3[(_0x2d9e84(0x1aa))]({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures']['postProcessingPosition'],'preExecute':function(){const _0x3bbe50=_0x2d9e84;_0x118520['primitives'][_0x3bbe50(0x148)]['commandToExecute']['outputTexture']=_0x118520[_0x3bbe50(0x159)][_0x3bbe50(0x148)];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'postProcessingPosition':function(){return _0x118520['particlesTextures']['postProcessingPosition'];},'nextParticlesSpeed':function(){const _0xb4edf3=_0x2d9e84;return _0x118520[_0xb4edf3(0x159)][_0xb4edf3(0xe8)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this[_0x2d9e84(0x159)]['postProcessingSpeed'],'preExecute':function(){const _0x1cdc5e=_0x2d9e84;_0x118520['primitives']['postProcessingSpeed']['commandToExecute'][_0x1cdc5e(0x1b0)]=_0x118520[_0x1cdc5e(0x159)]['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace[_0x254ba6(0x111)];class ParticleSystem{constructor(_0x51f71f,_0x18396d,_0x2f0aac,_0x4748b5){const _0x5da460=_0x254ba6;this[_0x5da460(0x1b7)]=_0x51f71f,_0x18396d={..._0x18396d},_0x18396d['udata']&&_0x18396d['vdata']&&(_0x18396d['dimensions']={},_0x18396d['dimensions'][_0x5da460(0x16b)]=_0x18396d[_0x5da460(0x173)],_0x18396d[_0x5da460(0x1c0)]['lat']=_0x18396d['rows'],_0x18396d['dimensions']['lev']=_0x18396d[_0x5da460(0x180)]||0x1,_0x18396d['lon']={},_0x18396d['lon']['min']=_0x18396d[_0x5da460(0xe5)],_0x18396d['lon']['max']=_0x18396d['xmax'],_0x18396d[_0x5da460(0xe4)]={},_0x18396d['lat'][_0x5da460(0x10e)]=_0x18396d[_0x5da460(0x17a)],_0x18396d[_0x5da460(0xe4)]['max']=_0x18396d['ymax'],_0x18396d['lev']={},_0x18396d['lev']['min']=_0x18396d[_0x5da460(0x11d)]??0x1,_0x18396d[_0x5da460(0x180)]['max']=_0x18396d['levmax']??0x1,_0x18396d['U']={},_0x18396d['U']['array']=new Float32Array(_0x18396d['udata']),_0x18396d['U']['min']=_0x18396d[_0x5da460(0x19e)]??Math['min'](..._0x18396d['udata']),_0x18396d['U']['max']=_0x18396d['umax']??Math['max'](..._0x18396d['udata']),_0x18396d['V']={},_0x18396d['V'][_0x5da460(0x19c)]=new Float32Array(_0x18396d['vdata']),_0x18396d['V']['min']=_0x18396d[_0x5da460(0x198)]??Math[_0x5da460(0x10e)](..._0x18396d[_0x5da460(0xfa)]),_0x18396d['V'][_0x5da460(0x1a3)]=_0x18396d['vmax']??Math['max'](..._0x18396d[_0x5da460(0xfa)])),this['data']=_0x18396d,this['options']=_0x2f0aac,this['viewerParameters']=_0x4748b5,this['particlesComputing']=new ParticlesComputing(this[_0x5da460(0x1b7)],this[_0x5da460(0x158)],this[_0x5da460(0x1b1)],this['viewerParameters']),this[_0x5da460(0xf3)]=new ParticlesRendering(this[_0x5da460(0x1b7)],this['data'],this['options'],this['viewerParameters'],this['particlesComputing']);}[_0x254ba6(0x175)](_0x5559f6){const _0x4cf373=_0x254ba6;this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this['particlesComputing']['windTextures'])['forEach'](_0x2fba4b=>{const _0x482d58=_0x4321;this[_0x482d58(0x157)]['windTextures'][_0x2fba4b][_0x482d58(0x169)]();}),this[_0x4cf373(0xf3)]['textures']['colorTable']['destroy'](),Object[_0x4cf373(0x1c6)](this['particlesRendering']['framebuffers'])['forEach'](_0x1a6178=>{this['particlesRendering']['framebuffers'][_0x1a6178]['destroy']();}),this['context']=_0x5559f6,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this['options'],this[_0x4cf373(0x1bb)]),this['particlesRendering']=new ParticlesRendering(this[_0x4cf373(0x1b7)],this['data'],this['options'],this['viewerParameters'],this['particlesComputing']);}['clearFramebuffers'](){const _0x594b81=_0x254ba6,_0x4f01f8=new Cesium$2['ClearCommand']({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2[_0x594b81(0x1c8)]['OPAQUE']});Object['keys'](this[_0x594b81(0xf3)]['framebuffers'])['forEach'](_0x1a67e6=>{const _0x56e1c4=_0x594b81;_0x4f01f8[_0x56e1c4(0x14b)]=this['particlesRendering'][_0x56e1c4(0x1b6)][_0x1a67e6],_0x4f01f8['execute'](this['context']);});}['refreshParticles'](_0x3496f8){const _0x3dfd8e=_0x254ba6;this['clearFramebuffers'](),this['particlesComputing']['destroyParticlesTextures'](),this['particlesComputing']['createParticlesTextures'](this['context'],this['options'],this['viewerParameters']);if(_0x3496f8){var _0xb73ec2;const _0x32f3d0=this['particlesRendering'][_0x3dfd8e(0x11f)](this['options']);this[_0x3dfd8e(0xf3)]['primitives']['segments']['geometry']=_0x32f3d0;const _0x43a76e=Cesium$2['VertexArray'][_0x3dfd8e(0x11e)]({'context':this['context'],'geometry':_0x32f3d0,'attributeLocations':this['particlesRendering']['primitives'][_0x3dfd8e(0x17f)]['attributeLocations'],'bufferUsage':Cesium$2['BufferUsage']['STATIC_DRAW']});(_0xb73ec2=this['particlesRendering'][_0x3dfd8e(0x151)])!==null&&_0xb73ec2!==void 0x0&&(_0xb73ec2=_0xb73ec2['segments'])!==null&&_0xb73ec2!==void 0x0&&_0xb73ec2['commandToExecute']&&(this['particlesRendering']['primitives'][_0x3dfd8e(0x17f)]['commandToExecute']['vertexArray']=_0x43a76e);}}['setOptions'](_0x244f6f){const _0x2159e7=_0x254ba6;let _0x2435a7=![];this[_0x2159e7(0x1b1)]['maxParticles']!==_0x244f6f[_0x2159e7(0x17b)]&&(_0x2435a7=!![]),Object['keys'](_0x244f6f)[_0x2159e7(0x190)](_0x29b9bc=>{this['options'][_0x29b9bc]=_0x244f6f[_0x29b9bc];}),this['refreshParticles'](_0x2435a7);}['applyViewerParameters'](_0x5d62ea){const _0x35c445=_0x254ba6;Object['keys'](_0x5d62ea)['forEach'](_0x3a459e=>{this['viewerParameters'][_0x3a459e]=_0x5d62ea[_0x3a459e];}),this[_0x35c445(0x1c9)](![]);}['destroy'](){const _0x486b11=_0x254ba6;clearTimeout(this['canrefresh']),this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this[_0x486b11(0x157)]['windTextures'])['forEach'](_0x49903d=>{const _0x4f5622=_0x486b11;this[_0x4f5622(0x157)]['windTextures'][_0x49903d]['destroy']();}),this['particlesRendering'][_0x486b11(0x12b)][_0x486b11(0x143)][_0x486b11(0x169)](),Object['keys'](this[_0x486b11(0xf3)][_0x486b11(0x1b6)])['forEach'](_0x1af0cf=>{this['particlesRendering']['framebuffers'][_0x1af0cf]['destroy']();});for(const _0x2baeba in this){delete this[_0x2baeba];}}}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace[_0x254ba6(0xe6)]['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};class WindLayer extends BaseLayer$1{constructor(_0x1bba6c={}){_0x1bba6c={...DEF_OPTIONS,..._0x1bba6c},super(_0x1bba6c),this['_setOptionsHook'](_0x1bba6c);}get[_0x254ba6(0xe6)](){const _0x113694=_0x254ba6;return this[_0x113694(0x151)];}get[_0x254ba6(0x158)](){return this['_data'];}set[_0x254ba6(0x158)](_0x162c8d){const _0x6cf8dd=_0x254ba6;this[_0x6cf8dd(0x191)](_0x162c8d);}get['colors'](){return this['options']['colors'];}set[_0x254ba6(0x1be)](_0x46d271){const _0x354417=_0x254ba6;this[_0x354417(0x1b1)][_0x354417(0x1be)]=_0x46d271,this['particleSystem']&&this['particleSystem']['setOptions']({'colors':_0x46d271}),this['resize']();}['_mountedHook'](){}[_0x254ba6(0x152)](){const _0xd3ddd9=_0x254ba6;this['scene']=this['_map']['scene'],this['camera']=this[_0xd3ddd9(0x155)]['camera'],this[_0xd3ddd9(0x151)]=new Cesium$1['PrimitiveCollection'](),this['_map']['scene']['primitives'][_0xd3ddd9(0x105)](this['primitives']),this['viewerParameters']={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1[(_0xd3ddd9(0x117))](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1['BoundingSphere'](Cesium$1['Cartesian3']['ZERO'],0.99*0x615299),this['updateViewerParameters'](),window['addEventListener']('resize',this['resize']['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['_map']['on'](mars3d__namespace['EventType']['wheel'],this[_0xd3ddd9(0x18f)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0xd3ddd9(0x100)],this[_0xd3ddd9(0x18d)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this[_0xd3ddd9(0x14d)]&&this['setData'](this['_data']);}[_0x254ba6(0xe1)](){const _0x291a8e=_0x254ba6;window['removeEventListener']('resize',this[_0x291a8e(0x12f)]),this['_map'][_0x291a8e(0xfb)](mars3d__namespace['EventType'][_0x291a8e(0xec)],this['_onMap_preRenderEvent'],this),this['_map'][_0x291a8e(0xfb)](mars3d__namespace['EventType']['wheel'],this[_0x291a8e(0x18f)],this),this[_0x291a8e(0x155)]['off'](mars3d__namespace['EventType'][_0x291a8e(0x1a6)],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace[_0x291a8e(0x17c)][_0x291a8e(0x100)],this['_onMouseUpEvent'],this),this[_0x291a8e(0x155)]['off'](mars3d__namespace['EventType']['mouseMove'],this[_0x291a8e(0x112)],this),this['primitives'][_0x291a8e(0x11c)](),this['_map']['scene']['primitives']['remove'](this['primitives']);}['resize'](){const _0x4fb0d8=_0x254ba6;if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this['primitives']['removeAll'](),this['_map']['once'](mars3d__namespace[_0x4fb0d8(0x17c)]['preRender'],this['_onMap_preRenderEvent'],this);}['_onMap_preRenderEvent'](_0x4e097d){const _0x1f120b=_0x254ba6;this['particleSystem']['canvasResize'](this['scene']['context']),this[_0x1f120b(0x193)](),this[_0x1f120b(0x151)][_0x1f120b(0x16e)]=!![];}['_onMapWhellEvent'](_0x1345fd){const _0x294e77=_0x254ba6;clearTimeout(this['refreshTimer']);if(!this[_0x294e77(0x16e)]||!this['particleSystem'])return;this[_0x294e77(0x151)][_0x294e77(0x16e)]=![],this['refreshTimer']=setTimeout(()=>{const _0x1a32d5=_0x294e77;if(!this[_0x1a32d5(0x16e)])return;this['redraw']();},0xc8);}['_onMouseDownEvent'](_0x563f5e){this['mouse_down']=!![];}['_onMouseMoveEvent'](_0x4968ef){const _0x4259f6=_0x254ba6;if(!this[_0x4259f6(0x16e)]||!this['particleSystem'])return;this['mouse_down']&&(this[_0x4259f6(0x151)][_0x4259f6(0x16e)]=![],this[_0x4259f6(0x113)]=!![]);}['_onMouseUpEvent'](_0x4b30b1){const _0x1284f6=_0x254ba6;if(!this['show']||!this[_0x1284f6(0x1ac)])return;this['mouse_down']&&this[_0x1284f6(0x113)]&&this['redraw'](),this[_0x1284f6(0x151)][_0x1284f6(0x16e)]=!![],this['mouse_down']=![],this[_0x1284f6(0x113)]=![];}[_0x254ba6(0xf5)](){const _0x228ac0=_0x254ba6;if(!this[_0x228ac0(0x155)]||!this[_0x228ac0(0x16e)])return;this['updateViewerParameters'](),this[_0x228ac0(0x1ac)]['applyViewerParameters'](this[_0x228ac0(0x1bb)]),this[_0x228ac0(0x151)]['show']=!![];}['setData'](_0x1d2ddd){const _0xe183a6=_0x254ba6;this[_0xe183a6(0x14d)]=_0x1d2ddd,this['particleSystem']&&this['particleSystem']['destroy'](),this['particleSystem']=new ParticleSystem(this['scene']['context'],_0x1d2ddd,this['getOptions'](),this['viewerParameters']),this['addPrimitives']();}['_setOptionsHook'](_0x1c0fbd,_0x46d317){const _0x5cd119=_0x254ba6;if(_0x1c0fbd)for(const _0x1f34da in _0x1c0fbd){this[_0x1f34da]=_0x1c0fbd[_0x1f34da];}this[_0x5cd119(0x1ac)]&&this['particleSystem'][_0x5cd119(0x118)](this['getOptions']());}[_0x254ba6(0x147)](){const _0x1169dd=_0x254ba6,_0x3bd609=Math[_0x1169dd(0x123)](Math[_0x1169dd(0x185)](this['particlesNumber']));return this['particlesNumber']=_0x3bd609*_0x3bd609,{'particlesTextureSize':_0x3bd609,'maxParticles':this[_0x1169dd(0x1a9)],'particleHeight':this[_0x1169dd(0x1b5)],'fadeOpacity':this[_0x1169dd(0xfd)],'dropRate':this[_0x1169dd(0x14c)],'dropRateBump':this[_0x1169dd(0x142)],'speedFactor':this[_0x1169dd(0x19b)],'lineWidth':this['lineWidth'],'colors':this[_0x1169dd(0x1be)]};}['addPrimitives'](){const _0x1540d9=_0x254ba6;this['primitives'][_0x1540d9(0x105)](this[_0x1540d9(0x1ac)]['particlesComputing']['primitives'][_0x1540d9(0xe7)]),this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives']['updateSpeed']),this['primitives']['add'](this['particleSystem'][_0x1540d9(0x157)]['primitives']['updatePosition']),this[_0x1540d9(0x151)]['add'](this['particleSystem']['particlesComputing']['primitives']['postProcessingPosition']),this['primitives']['add'](this[_0x1540d9(0x1ac)]['particlesComputing'][_0x1540d9(0x151)]['postProcessingSpeed']),this['primitives']['add'](this[_0x1540d9(0x1ac)][_0x1540d9(0xf3)]['primitives']['segments']),this[_0x1540d9(0x151)]['add'](this['particleSystem']['particlesRendering']['primitives'][_0x1540d9(0x114)]),this['primitives'][_0x1540d9(0x105)](this['particleSystem'][_0x1540d9(0xf3)]['primitives'][_0x1540d9(0x134)]);}['updateViewerParameters'](){const _0xd592f0=_0x254ba6;let _0x53fbc0=this['camera'][_0xd592f0(0x172)](this['scene']['globe']['ellipsoid']);if(!_0x53fbc0){const _0x19a62e=this['_map']['getExtent']();_0x53fbc0=Cesium$1['Rectangle']['fromDegrees'](_0x19a62e['xmin'],_0x19a62e[_0xd592f0(0x17a)],_0x19a62e[_0xd592f0(0x149)],_0x19a62e[_0xd592f0(0x1a7)]);}const _0x4b80de=Util['viewRectangleToLonLatRange'](_0x53fbc0);this[_0xd592f0(0x1bb)]['lonRange']['x']=_0x4b80de[_0xd592f0(0x16b)]['min'],this['viewerParameters'][_0xd592f0(0x125)]['y']=_0x4b80de['lon']['max'],this[_0xd592f0(0x1bb)]['latRange']['x']=_0x4b80de['lat']['min'],this['viewerParameters'][_0xd592f0(0x130)]['y']=_0x4b80de[_0xd592f0(0xe4)][_0xd592f0(0x1a3)];const _0x47930d=this['camera']['getPixelSize'](this['globeBoundingSphere'],this[_0xd592f0(0x1ae)][_0xd592f0(0x1b4)],this[_0xd592f0(0x1ae)]['drawingBufferHeight']);_0x47930d>0x0&&(this['viewerParameters'][_0xd592f0(0x171)]=_0x47930d);}}mars3d__namespace[_0x254ba6(0x178)][_0x254ba6(0x1ab)](_0x254ba6(0x167),WindLayer),mars3d__namespace['layer'][_0x254ba6(0x141)]=WindLayer;class CanvasParticle{constructor(){const _0x1cf858=_0x254ba6;this['lng']=null,this['lat']=null,this[_0x1cf858(0xef)]=null,this[_0x1cf858(0x174)]=null,this['age']=null,this[_0x1cf858(0x102)]=null;}[_0x254ba6(0x169)](){for(const _0x9ee3c0 in this){delete this[_0x9ee3c0];}}}class CanvasWindField{constructor(_0x2e8c9a){this['setOptions'](_0x2e8c9a);}get['speedRate'](){return this['_speedRate'];}set[_0x254ba6(0x176)](_0x47c909){const _0x3405fb=_0x254ba6;this['_speedRate']=(0x64-(_0x47c909>0x63?0x63:_0x47c909))*0x64,this[_0x3405fb(0x110)]=[(this['xmax']-this[_0x3405fb(0xe5)])/this['_speedRate'],(this['ymax']-this['ymin'])/this['_speedRate']];}get['maxAge'](){const _0x2ba004=_0x254ba6;return this[_0x2ba004(0xfe)];}set['maxAge'](_0x5d8103){const _0x1e3a89=_0x254ba6;this[_0x1e3a89(0xfe)]=_0x5d8103;}['setOptions'](_0x581127){const _0x22f140=_0x254ba6;this['options']=_0x581127,this['maxAge']=_0x581127[_0x22f140(0x19a)]||0x78,this['speedRate']=_0x581127['speedRate']||0x32,this['particles']=[];const _0x3878e3=_0x581127['particlesNumber']||0x1000;for(let _0x17f51b=0x0;_0x17f51b<_0x3878e3;_0x17f51b++){const _0x69ddf0=this[_0x22f140(0xf6)](new CanvasParticle());this['particles'][_0x22f140(0x13f)](_0x69ddf0);}}[_0x254ba6(0xf7)](_0x1b251c){const _0xc73aa6=_0x254ba6;this[_0xc73aa6(0x18c)]=_0x1b251c[_0xc73aa6(0x18c)],this[_0xc73aa6(0x173)]=_0x1b251c['cols'],this[_0xc73aa6(0xe5)]=_0x1b251c[_0xc73aa6(0xe5)],this['xmax']=_0x1b251c['xmax'],this['ymin']=_0x1b251c['ymin'],this['ymax']=_0x1b251c['ymax'],this['grid']=[];const _0x2dda47=_0x1b251c['udata'],_0x4949e8=_0x1b251c['vdata'];let _0x30f1d8=![];_0x2dda47['length']===this['rows']&&_0x2dda47[0x0][_0xc73aa6(0x1c7)]===this['cols']&&(_0x30f1d8=!![]);let _0x1465fa=0x0,_0x41fce1=null,_0x199d75=null;for(let _0x26fa03=0x0;_0x26fa03<this['rows'];_0x26fa03++){_0x41fce1=[];for(let _0x575d87=0x0;_0x575d87<this[_0xc73aa6(0x173)];_0x575d87++,_0x1465fa++){_0x30f1d8?_0x199d75=this['_calcUV'](_0x2dda47[_0x26fa03][_0x575d87],_0x4949e8[_0x26fa03][_0x575d87]):_0x199d75=this['_calcUV'](_0x2dda47[_0x1465fa],_0x4949e8[_0x1465fa]),_0x41fce1[_0xc73aa6(0x13f)](_0x199d75);}this['grid']['push'](_0x41fce1);}this['options'][_0xc73aa6(0x121)]&&this['grid']['reverse']();}['clear'](){const _0x4f7f96=_0x254ba6;delete this['rows'],delete this[_0x4f7f96(0x173)],delete this['xmin'],delete this[_0x4f7f96(0x149)],delete this['ymin'],delete this[_0x4f7f96(0x1a7)],delete this['grid'],delete this['particles'];}['toGridXY'](_0x4e2fdc,_0x3326e7){const _0x4d615d=(_0x4e2fdc-this['xmin'])/(this['xmax']-this['xmin'])*(this['cols']-0x1),_0x444e29=(this['ymax']-_0x3326e7)/(this['ymax']-this['ymin'])*(this['rows']-0x1);return[_0x4d615d,_0x444e29];}['getUVByXY'](_0x3057a0,_0x49833f){const _0x141665=_0x254ba6;if(_0x3057a0<0x0||_0x3057a0>=this[_0x141665(0x173)]||_0x49833f>=this['rows'])return[0x0,0x0,0x0];const _0x32e7c=Math[_0x141665(0x11a)](_0x3057a0),_0x4e5aa5=Math['floor'](_0x49833f);if(_0x32e7c===_0x3057a0&&_0x4e5aa5===_0x49833f)return this['grid'][_0x49833f][_0x3057a0];const _0x4b65d7=_0x32e7c+0x1,_0xdf9312=_0x4e5aa5+0x1,_0x21773e=this['getUVByXY'](_0x32e7c,_0x4e5aa5),_0xfe00bc=this['getUVByXY'](_0x4b65d7,_0x4e5aa5),_0x3a1458=this[_0x141665(0x1bf)](_0x32e7c,_0xdf9312),_0x379b2a=this['getUVByXY'](_0x4b65d7,_0xdf9312);let _0x474a19=null;try{_0x474a19=this['_bilinearInterpolation'](_0x3057a0-_0x32e7c,_0x49833f-_0x4e5aa5,_0x21773e,_0xfe00bc,_0x3a1458,_0x379b2a);}catch(_0x98dda7){console['log'](_0x3057a0,_0x49833f);}return _0x474a19;}['_bilinearInterpolation'](_0xb11930,_0x5b483e,_0x5bd416,_0x5cbeb8,_0x8b9c84,_0x477086){const _0x3ca517=0x1-_0xb11930,_0x3ac864=0x1-_0x5b483e,_0x5a7126=_0x3ca517*_0x3ac864,_0x19b7aa=_0xb11930*_0x3ac864,_0x4b5d8f=_0x3ca517*_0x5b483e,_0x37eda2=_0xb11930*_0x5b483e,_0x1a02cf=_0x5bd416[0x0]*_0x5a7126+_0x5cbeb8[0x0]*_0x19b7aa+_0x8b9c84[0x0]*_0x4b5d8f+_0x477086[0x0]*_0x37eda2,_0x4dcf42=_0x5bd416[0x1]*_0x5a7126+_0x5cbeb8[0x1]*_0x19b7aa+_0x8b9c84[0x1]*_0x4b5d8f+_0x477086[0x1]*_0x37eda2;return this['_calcUV'](_0x1a02cf,_0x4dcf42);}['_calcUV'](_0x47c406,_0x2ff0b7){const _0x543a30=_0x254ba6;return[+_0x47c406,+_0x2ff0b7,Math[_0x543a30(0x185)](_0x47c406*_0x47c406+_0x2ff0b7*_0x2ff0b7)];}['getUVByPoint'](_0x3917e4,_0x57b642){if(!this['isInExtent'](_0x3917e4,_0x57b642))return null;const _0x37eddc=this['toGridXY'](_0x3917e4,_0x57b642),_0x3fa5ed=this['getUVByXY'](_0x37eddc[0x0],_0x37eddc[0x1]);return _0x3fa5ed;}['isInExtent'](_0x59dfd5,_0x11881e){const _0x2fc457=_0x254ba6;return _0x59dfd5>=this['xmin']&&_0x59dfd5<=this[_0x2fc457(0x149)]&&_0x11881e>=this['ymin']&&_0x11881e<=this[_0x2fc457(0x1a7)]?!![]:![];}['getRandomLatLng'](){const _0x24ab5c=fRandomByfloat(this['xmin'],this['xmax']),_0x52a0b8=fRandomByfloat(this['ymin'],this['ymax']);return{'lat':_0x52a0b8,'lng':_0x24ab5c};}['getParticles'](){const _0x5c1a50=_0x254ba6;let _0x461faf,_0x5381ff,_0x33dd3d;for(let _0x63495f=0x0,_0x77af26=this[_0x5c1a50(0x195)]['length'];_0x63495f<_0x77af26;_0x63495f++){let _0x5ac48e=this[_0x5c1a50(0x195)][_0x63495f];_0x5ac48e['age']<=0x0&&(_0x5ac48e=this['_randomParticle'](_0x5ac48e));if(_0x5ac48e['age']>0x0){const _0x585f36=_0x5ac48e['tlng'],_0x2ddf7c=_0x5ac48e[_0x5c1a50(0x174)];_0x33dd3d=this[_0x5c1a50(0x186)](_0x585f36,_0x2ddf7c),_0x33dd3d?(_0x461faf=_0x585f36+this[_0x5c1a50(0x110)][0x0]*_0x33dd3d[0x0],_0x5381ff=_0x2ddf7c+this['_calc_speedRate'][0x1]*_0x33dd3d[0x1],_0x5ac48e['lng']=_0x585f36,_0x5ac48e['lat']=_0x2ddf7c,_0x5ac48e['tlng']=_0x461faf,_0x5ac48e[_0x5c1a50(0x174)]=_0x5381ff,_0x5ac48e['speed']=_0x33dd3d[0x2],_0x5ac48e['age']--):_0x5ac48e[_0x5c1a50(0x1a4)]=0x0;}}return this[_0x5c1a50(0x195)];}['_randomParticle'](_0x151bf4){const _0x14f5ae=_0x254ba6;let _0x2f4392,_0x43e508;for(let _0x3587e0=0x0;_0x3587e0<0x1e;_0x3587e0++){_0x2f4392=this['getRandomLatLng'](),_0x43e508=this[_0x14f5ae(0x186)](_0x2f4392[_0x14f5ae(0x13e)],_0x2f4392['lat']);if(_0x43e508&&_0x43e508[0x2]>0x0)break;}if(!_0x43e508)return _0x151bf4;const _0x4043ec=_0x2f4392['lng']+this['_calc_speedRate'][0x0]*_0x43e508[0x0],_0x573a67=_0x2f4392['lat']+this['_calc_speedRate'][0x1]*_0x43e508[0x1];return _0x151bf4['lng']=_0x2f4392['lng'],_0x151bf4['lat']=_0x2f4392['lat'],_0x151bf4['tlng']=_0x4043ec,_0x151bf4['tlat']=_0x573a67,_0x151bf4['age']=Math['round'](Math['random']()*this[_0x14f5ae(0x19a)]),_0x151bf4['speed']=_0x43e508[0x2],_0x151bf4;}[_0x254ba6(0x169)](){for(const _0x35f2e9 in this){delete this[_0x35f2e9];}}}function fRandomByfloat(_0x387fb0,_0x515396){return _0x387fb0+Math['random']()*(_0x515396-_0x387fb0);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace[_0x254ba6(0xe6)]['BaseLayer'];function _0x4321(_0x3ad7b3,_0x5f417e){const _0x2db27f=_0x2db2();return _0x4321=function(_0x43216e,_0x7b8f1b){_0x43216e=_0x43216e-0xdd;let _0x400a7c=_0x2db27f[_0x43216e];return _0x400a7c;},_0x4321(_0x3ad7b3,_0x5f417e);}class CanvasWindLayer extends BaseLayer{constructor(_0x10ae31={}){const _0x57afa0=_0x254ba6;super(_0x10ae31),this[_0x57afa0(0x182)](_0x10ae31),this['canvas']=null,_0x10ae31[_0x57afa0(0x1be)]&&_0x10ae31['steps']&&(this['_colorRamp']=new mars3d__namespace['ColorRamp'](_0x10ae31));}[_0x254ba6(0x182)](_0x19e7a1,_0x10f998){const _0x1662ea=_0x254ba6;this['frameTime']=0x3e8/(_0x19e7a1[_0x1662ea(0xf2)]||0xa),this['_pointerEvents']=this['options']['pointerEvents']??![],this[_0x1662ea(0x16d)]=_0x19e7a1['color']||'#ffffff',this['lineWidth']=_0x19e7a1[_0x1662ea(0x127)]||0x1,this['fixedHeight']=_0x19e7a1['fixedHeight']??0x0,this['reverseY']=_0x19e7a1['reverseY']??![],this[_0x1662ea(0x132)]&&this['windField']['setOptions'](_0x19e7a1);}get['layer'](){return this['canvas'];}get[_0x254ba6(0x194)](){const _0x158f0e=_0x254ba6;return this['_map']['scene'][_0x158f0e(0x153)][_0x158f0e(0xfc)];}get['canvasHeight'](){return this['_map']['scene']['canvas']['clientHeight'];}get['pointerEvents'](){const _0x5e0b33=_0x254ba6;return this[_0x5e0b33(0x184)];}set['pointerEvents'](_0x181be1){const _0x5031bb=_0x254ba6;this['_pointerEvents']=_0x181be1;if(!this['canvas'])return;_0x181be1?this[_0x5031bb(0x153)][_0x5031bb(0x131)][_0x5031bb(0x13d)]=_0x5031bb(0x150):this['canvas'][_0x5031bb(0x131)][_0x5031bb(0x13d)]=_0x5031bb(0x136);}get['particlesNumber'](){return this['options']['particlesNumber'];}set['particlesNumber'](_0x414ef3){const _0x2d8838=_0x254ba6;this[_0x2d8838(0x1b1)][_0x2d8838(0x1a9)]=_0x414ef3,clearTimeout(this['_canrefresh']),this[_0x2d8838(0x133)]=setTimeout(()=>{const _0x185c19=_0x2d8838;this[_0x185c19(0xf5)]();},0x1f4);}get['speedRate'](){return this['options']['speedRate'];}set['speedRate'](_0x58a303){const _0x592d80=_0x254ba6;this['options']['speedRate']=_0x58a303,this['windField']&&(this[_0x592d80(0x132)]['speedRate']=_0x58a303);}get['maxAge'](){return this['options']['maxAge'];}set[_0x254ba6(0x19a)](_0x586115){const _0x59307c=_0x254ba6;this[_0x59307c(0x1b1)]['maxAge']=_0x586115,this['windField']&&(this['windField']['maxAge']=_0x586115);}get[_0x254ba6(0x158)](){const _0x2d0dae=_0x254ba6;return this[_0x2d0dae(0x18b)];}set[_0x254ba6(0x158)](_0x580ed9){this['setData'](_0x580ed9);}['_showHook'](_0x71745c){const _0x17d647=_0x254ba6;_0x71745c?this['_addedHook']():(this[_0x17d647(0x18b)]&&(this['options']['data']=this['windData']),this['_removedHook']());}[_0x254ba6(0xdf)](){const _0x52e906=_0x254ba6;this['options']['worker']?this[_0x52e906(0x139)]():this['windField']=new CanvasWindField(this['options']);}[_0x254ba6(0x152)](){const _0xe5bfff=_0x254ba6;this[_0xe5bfff(0x153)]=this[_0xe5bfff(0x156)](),this['canvasContext']=this[_0xe5bfff(0x153)]['getContext']('2d',{'willReadFrequently':!![]}),this[_0xe5bfff(0x10d)](),this['options'][_0xe5bfff(0x158)]&&this['setData'](this['options']['data']);}['_removedHook'](){const _0x508d9d=_0x254ba6;this[_0x508d9d(0x135)](),this['unbindEvent'](),this['canvas']&&(this['_map']['container'][_0x508d9d(0x181)](this[_0x508d9d(0x153)]),delete this[_0x508d9d(0x153)]);}['_createCanvas'](){const _0x204fed=_0x254ba6,_0x338622=mars3d__namespace['DomUtil'][_0x204fed(0x138)]('canvas','mars3d-canvasWind',this['_map']['container']);return _0x338622['style']['position']='absolute',_0x338622['style'][_0x204fed(0x10c)]='0px',_0x338622[_0x204fed(0x131)]['left']='0px',_0x338622['style']['width']=this['_map']['scene']['canvas'][_0x204fed(0xfc)]+'px',_0x338622['style']['height']=this['_map'][_0x204fed(0x1ae)]['canvas']['clientHeight']+'px',_0x338622['style']['pointerEvents']=this[_0x204fed(0x184)]?_0x204fed(0x106):'none',_0x338622['style'][_0x204fed(0xe9)]=this['options'][_0x204fed(0xe9)]??0x9,_0x338622[_0x204fed(0x15a)]=this[_0x204fed(0x155)]['scene']['canvas']['clientWidth'],_0x338622['height']=this[_0x204fed(0x155)]['scene']['canvas']['clientHeight'],_0x338622;}['resize'](){const _0x20f07b=_0x254ba6;this['canvas']&&(this['canvas'][_0x20f07b(0x131)]['width']=this['_map']['scene'][_0x20f07b(0x153)]['clientWidth']+'px',this['canvas']['style'][_0x20f07b(0x1b2)]=this['_map'][_0x20f07b(0x1ae)]['canvas']['clientHeight']+'px',this['canvas']['width']=this['_map']['scene']['canvas']['clientWidth'],this['canvas']['height']=this[_0x20f07b(0x155)]['scene']['canvas']['clientHeight']);}['bindEvent'](){const _0x44f4d3=_0x254ba6,_0x549128=this;let _0x38e018=Date[_0x44f4d3(0x15e)]();(function _0x38f003(){const _0x413126=_0x44f4d3;_0x549128['animateFrame']=window[_0x413126(0x1a2)](_0x38f003);if(_0x549128['show']&&_0x549128['windField']){const _0x5ae80=Date['now'](),_0x853314=_0x5ae80-_0x38e018;_0x853314>_0x549128['frameTime']&&(_0x38e018=_0x5ae80-_0x853314%_0x549128['frameTime'],_0x549128[_0x413126(0xed)]());}}(),window['addEventListener']('resize',this[_0x44f4d3(0x12f)][_0x44f4d3(0xe0)](this),![]),this['mouse_down']=![],this[_0x44f4d3(0x113)]=![],this[_0x44f4d3(0x1b1)][_0x44f4d3(0x144)]&&(this['_map']['on'](mars3d__namespace[_0x44f4d3(0x17c)]['wheel'],this['_onMapWhellEvent'],this),this[_0x44f4d3(0x155)]['on'](mars3d__namespace[_0x44f4d3(0x17c)]['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0x44f4d3(0x100)],this['_onMouseUpEvent'],this)));}['unbindEvent'](){const _0x162bd7=_0x254ba6;window[_0x162bd7(0x196)](this['animateFrame']),delete this['animateFrame'],window['removeEventListener']('resize',this['resize']),this['options']['mouseHidden']&&(this['_map'][_0x162bd7(0xfb)](mars3d__namespace['EventType']['wheel'],this[_0x162bd7(0x18f)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map'][_0x162bd7(0xfb)](mars3d__namespace['EventType'][_0x162bd7(0x1b9)],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0x2ca8d6){const _0x14deff=_0x254ba6;clearTimeout(this['refreshTimer']);if(!this['show']||!this['canvas'])return;this[_0x14deff(0x153)]['style'][_0x14deff(0x13b)]='hidden',this['refreshTimer']=setTimeout(()=>{const _0x7606db=_0x14deff;if(!this[_0x7606db(0x16e)])return;this['redraw'](),this['canvas']['style']['visibility']='visible';},0xc8);}['_onMouseDownEvent'](_0x39be4c){const _0x2ad941=_0x254ba6;this['mouse_down']=!![],this['_map'][_0x2ad941(0xfb)](mars3d__namespace[_0x2ad941(0x17c)]['mouseMove'],this[_0x2ad941(0x112)],this),this[_0x2ad941(0x155)]['on'](mars3d__namespace[_0x2ad941(0x17c)][_0x2ad941(0x1b9)],this['_onMouseMoveEvent'],this);}['_onMouseMoveEvent'](_0x571ded){const _0x3777a3=_0x254ba6;if(!this[_0x3777a3(0x16e)]||!this[_0x3777a3(0x153)])return;this['mouse_down']&&(this['canvas']['style']['visibility']=_0x3777a3(0x1b3),this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x464b55){const _0x57cbd0=_0x254ba6;if(!this['show']||!this[_0x57cbd0(0x153)])return;this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this[_0x57cbd0(0x112)],this),this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['canvas']['style']['visibility']='visible',this['mouse_down']=![],this[_0x57cbd0(0x113)]=![];}[_0x254ba6(0x191)](_0x4de7c2){const _0x42fe09=_0x254ba6;this['clear'](),this[_0x42fe09(0x18b)]=_0x4de7c2,this['windField']['setDate'](_0x4de7c2),this['redraw']();}[_0x254ba6(0xf5)](){const _0x1835dc=_0x254ba6;if(!this['show'])return;this['windField'][_0x1835dc(0x118)](this[_0x1835dc(0x1b1)]),this['update']();}['update'](){const _0x1b8e70=_0x254ba6;if(this[_0x1b8e70(0x15b)])return;this['_updateIng']=!![];if(this['worker'])this['windField']['update']();else{const _0x1a88ff=this['windField'][_0x1b8e70(0xe2)]();this[_0x1b8e70(0x120)](_0x1a88ff);}this['_updateIng']=![];}[_0x254ba6(0x120)](_0x3401e0){const _0x3b437b=_0x254ba6;this['canvasContext']['globalCompositeOperation']='destination-in',this[_0x3b437b(0x10a)]['fillRect'](0x0,0x0,this[_0x3b437b(0x194)],this[_0x3b437b(0x10b)]),this[_0x3b437b(0x10a)]['globalCompositeOperation']='lighter',this[_0x3b437b(0x10a)]['globalAlpha']=0.9;const _0x103af8=this['_map']['scene']['mode']!==Cesium['SceneMode'][_0x3b437b(0x16f)],_0x4af42b=this['canvasWidth']*0.25;if(this['_colorRamp'])for(let _0x482b0a=0x0,_0xa60ee3=_0x3401e0['length'];_0x482b0a<_0xa60ee3;_0x482b0a++){const _0x4b229a=_0x3401e0[_0x482b0a],_0x6244c4=this[_0x3b437b(0x160)](_0x4b229a['lng'],_0x4b229a['lat'],_0x4b229a),_0x34db37=this['_tomap'](_0x4b229a['tlng'],_0x4b229a[_0x3b437b(0x174)],_0x4b229a);if(!_0x6244c4||!_0x34db37)continue;if(_0x103af8&&Math['abs'](_0x6244c4[0x0]-_0x34db37[0x0])>=_0x4af42b)continue;this[_0x3b437b(0x10a)]['beginPath'](),this['canvasContext']['lineWidth']=this['lineWidth'],this['canvasContext']['strokeStyle']=this[_0x3b437b(0x16c)]['getColor'](_0x4b229a['speed']),this[_0x3b437b(0x10a)]['moveTo'](_0x6244c4[0x0],_0x6244c4[0x1]),this['canvasContext']['lineTo'](_0x34db37[0x0],_0x34db37[0x1]),this[_0x3b437b(0x10a)]['stroke']();}else{this['canvasContext']['beginPath'](),this['canvasContext'][_0x3b437b(0x127)]=this[_0x3b437b(0x127)],this['canvasContext']['strokeStyle']=this['color'];for(let _0x35bd3d=0x0,_0x28f648=_0x3401e0['length'];_0x35bd3d<_0x28f648;_0x35bd3d++){const _0x482129=_0x3401e0[_0x35bd3d],_0x1ad2c2=this['_tomap'](_0x482129[_0x3b437b(0x13e)],_0x482129[_0x3b437b(0xe4)],_0x482129),_0x2f9d7f=this['_tomap'](_0x482129['tlng'],_0x482129[_0x3b437b(0x174)],_0x482129);if(!_0x1ad2c2||!_0x2f9d7f)continue;if(_0x103af8&&Math['abs'](_0x1ad2c2[0x0]-_0x2f9d7f[0x0])>=_0x4af42b)continue;this['canvasContext']['moveTo'](_0x1ad2c2[0x0],_0x1ad2c2[0x1]),this[_0x3b437b(0x10a)]['lineTo'](_0x2f9d7f[0x0],_0x2f9d7f[0x1]);}this['canvasContext']['stroke']();}}['_tomap'](_0xa8b875,_0x397c9f,_0x2059dc){const _0x22c9a8=_0x254ba6,_0x446128=Cesium[_0x22c9a8(0x199)][_0x22c9a8(0xee)](_0xa8b875,_0x397c9f,this['fixedHeight']),_0x5099a0=this[_0x22c9a8(0x155)]['scene'];if(_0x5099a0[_0x22c9a8(0x1b8)]===Cesium['SceneMode']['SCENE3D']){const _0x53ddab=new Cesium['EllipsoidalOccluder'](_0x5099a0['globe']['ellipsoid'],_0x5099a0[_0x22c9a8(0x19f)]['positionWC']),_0x17a441=_0x53ddab['isPointVisible'](_0x446128);if(!_0x17a441)return _0x2059dc['age']=0x0,null;}const _0x2cb59d=Cesium[_0x22c9a8(0xf0)]['wgs84ToWindowCoordinates'](this[_0x22c9a8(0x155)]['scene'],_0x446128);return _0x2cb59d?[_0x2cb59d['x'],_0x2cb59d['y']]:null;}['clear'](){const _0x392280=_0x254ba6;this[_0x392280(0x132)]['clear'](),delete this['windData'];}[_0x254ba6(0x139)](){const _0x120d6a=_0x254ba6;this[_0x120d6a(0xf4)]=new Worker(this['options']['worker']),this['worker'][_0x120d6a(0x1ad)]=_0x264558=>{const _0x2d8c85=_0x120d6a;this['_drawLines'](_0x264558['data']['particles']),this[_0x2d8c85(0x163)]=![];},this['windField']={'init':_0x56e58c=>{const _0x56138c=_0x120d6a;this['worker'][_0x56138c(0x1c5)]({'type':'init','options':_0x56e58c});},'setOptions':_0x31d876=>{this['worker']['postMessage']({'type':'setOptions','options':_0x31d876});},'setDate':_0x45d9a4=>{const _0x4c921c=_0x120d6a;this['worker'][_0x4c921c(0x1c5)]({'type':'setDate','data':_0x45d9a4});},'update':()=>{const _0x2c6a37=_0x120d6a;if(this[_0x2c6a37(0x163)])return;this['_updateIng2']=!![],this['worker']['postMessage']({'type':'update'});},'clear':()=>{this['worker']['postMessage']({'type':'clear'});}},this[_0x120d6a(0x132)]['init'](this[_0x120d6a(0x1b1)]);}}mars3d__namespace[_0x254ba6(0x178)][_0x254ba6(0x1ab)]('canvasWind',CanvasWindLayer),mars3d__namespace['layer']['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports['CanvasWindField']=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
