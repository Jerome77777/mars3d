/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.6.11
 * 编译日期：2023-11-04 00:08:10
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x39bfda=_0x470f;(function(_0x3866da,_0x1fb2c6){const _0x360f63=_0x470f,_0x32a86b=_0x3866da();while(!![]){try{const _0x58f701=-parseInt(_0x360f63(0x2a8))/0x1*(-parseInt(_0x360f63(0x28e))/0x2)+-parseInt(_0x360f63(0x234))/0x3*(-parseInt(_0x360f63(0x286))/0x4)+-parseInt(_0x360f63(0x261))/0x5*(parseInt(_0x360f63(0x28b))/0x6)+parseInt(_0x360f63(0x2cc))/0x7*(-parseInt(_0x360f63(0x24f))/0x8)+parseInt(_0x360f63(0x262))/0x9+parseInt(_0x360f63(0x2c3))/0xa+-parseInt(_0x360f63(0x2da))/0xb;if(_0x58f701===_0x1fb2c6)break;else _0x32a86b['push'](_0x32a86b['shift']());}catch(_0x15c1b8){_0x32a86b['push'](_0x32a86b['shift']());}}}(_0x304f,0x3a0da));function _interopNamespace(_0xc7b07d){const _0x390498=_0x470f;if(_0xc7b07d&&_0xc7b07d[_0x390498(0x26b)])return _0xc7b07d;var _0x4c8f06=Object['create'](null);return _0xc7b07d&&Object['keys'](_0xc7b07d)[_0x390498(0x2d7)](function(_0x48e1d6){const _0x2da7e5=_0x390498;if(_0x48e1d6!==_0x2da7e5(0x296)){var _0x2109fa=Object[_0x2da7e5(0x206)](_0xc7b07d,_0x48e1d6);Object[_0x2da7e5(0x276)](_0x4c8f06,_0x48e1d6,_0x2109fa['get']?_0x2109fa:{'enumerable':!![],'get':function(){return _0xc7b07d[_0x48e1d6];}});}}),_0x4c8f06[_0x390498(0x296)]=_0xc7b07d,_0x4c8f06;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace['Cesium'];function getU(_0x516b01,_0x599e67){const _0x241265=_0x470f,_0x393b82=_0x516b01*Math['cos'](Cesium$7[_0x241265(0x2b5)]['toRadians'](_0x599e67));return _0x393b82;}function _0x304f(){const _0xa8d4be=['_addedHook','framebuffers','worker','RGBA','_onMouseDownEvent','random','green','context','PI_OVER_TWO','nextTrails','lng','SceneMode','Compute','_removedHook','fragmentShaderSource','canvas','width','drawingBufferWidth','rawRenderState','execute','FLOAT','viewRectangleToLonLatRange','canvasHeight','30fZtbyP','ymin','keys','visible','ComputeCommand','UNSIGNED_INT','drawingBufferHeight','initWorker','ZERO','_calcUV','textures','removeEventListener','getUVByPoint','scene','currentTrailsDepth','geometry','auto','sin','clearFramebuffers','particlesComputing','_drawLines','length','Sampler','pixelSize','getWind','postMessage','style','20072nZjsFw','BoundingSphere','_updateIng','outputTexture','getUVByXY','lighter','defined','TextureMinificationFilter','nextTrailsDepth','mouseDown','vdata','push','viewerParameters','xmin','clientWidth','xmax','clampToLatitudeRange','off','985FZpMtW','2762550efAUpi','UNSIGNED_BYTE','array','mouse_down','particlesTextureSize','mouseMove','clearCommand','clientHeight','fadeOpacity','__esModule','pow','min','mouse_move','PrimitiveCollection','Draw','canvasWind','destroyParticlesTextures','postProcessingSpeed','dropRate','pointerEvents','defineProperty','getOptions','register','SceneTransforms','unbindEvent','rows','mode','wheel','max','tlat','RenderState','Geometry','clear','applyViewerParameters','west','east','86948qBYlrN','_pointerEvents','speed','toDegrees','tlng','12090xfxpvX','animateFrame','wgs84ToWindowCoordinates','2GFMler','LINEAR','redraw','frameRate','PI_OVER_THREE','commandToExecute','ellipsoid','screen','default','particlesNumber','_onMouseMoveEvent','CanvasWindLayer','addPrimitives','height','windData','maxAge','once','CanvasWindField','_onMapWhellEvent','getRandomLatLng','preExecute','createTexture','frameTime','TextureMagnificationFilter','postProcessingPosition','_onMap_preRenderEvent','324307wMETfP','autoClear','_map','lon','shaderProgram','vertexShaderSource','particlesRendering','framebuffer','speedRate','grid','particlesWind','Cesium','PixelDatatype','Math','maxParticles','camera','colors','primitives','globeBoundingSphere','_canrefresh','EventType','show','beginPath','createComputingPrimitives','addEventListener','lineWidth','attributeLocations','4528250ulhfrU','reverse','particlesTextures','_calc_speedRate','Cartesian3','isDestroyed','lonRange','createFramebuffer','resize','28PlkPjQ','_setOptionsHook','_updateIng2','ShaderSource','Pass','udata','PrimitiveType','speedFactor','getColorTexture','top','ComponentDatatype','forEach','bindEvent','data','7223425ZDDBKi','currentParticlesSpeed','currentParticlesPosition','SCENE3D','depthTexture','LayerUtil','_bilinearInterpolation','VertexArray','vertexArray','TRIANGLES','0px','createCommand','hidden','windField','nextParticlesSpeed','segmentsDepth','lev','_mountedHook','_createCanvas','particles','vmin','destroy','commandType','createParticlesTextures','levmax','getOwnPropertyDescriptor','canvasContext','all','canvasWidth','log','currentTrails','mod','updateSpeed','atan2','colorTable','getDefaultRenderState','options','add','lat','dimensions','moveTo','setOptions','particleSystem','cols','reverseY','ymax','uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a','sqrt'];_0x304f=function(){return _0xa8d4be;};return _0x304f();}function getV(_0x4fb20f,_0x3e8b12){const _0x61751b=_0x470f,_0x3a381d=_0x4fb20f*Math[_0x61751b(0x245)](Cesium$7['Math']['toRadians'](_0x3e8b12));return _0x3a381d;}function getSpeed(_0x53f76e,_0x5728e3){const _0x1d27eb=_0x470f,_0x3a50e6=Math[_0x1d27eb(0x21c)](Math['pow'](_0x53f76e,0x2)+Math[_0x1d27eb(0x26c)](_0x5728e3,0x2));return _0x3a50e6;}function getDirection(_0x51bd42,_0x50aea2){const _0x59c566=_0x470f;let _0x39bfe3=Cesium$7['Math'][_0x59c566(0x289)](Math[_0x59c566(0x20e)](_0x50aea2,_0x51bd42));return _0x39bfe3+=_0x39bfe3<0x0?0x168:0x0,_0x39bfe3;}function _0x470f(_0x28c8a8,_0x484b78){const _0x304fc7=_0x304f();return _0x470f=function(_0x470fa8,_0x46ff0b){_0x470fa8=_0x470fa8-0x1f4;let _0x493d9c=_0x304fc7[_0x470fa8];return _0x493d9c;},_0x470f(_0x28c8a8,_0x484b78);}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0x2f9d5c){const _0x592406=_0x470f;this['commandType']=_0x2f9d5c[_0x592406(0x203)],this['geometry']=_0x2f9d5c[_0x592406(0x243)],this['attributeLocations']=_0x2f9d5c[_0x592406(0x2c2)],this['primitiveType']=_0x2f9d5c['primitiveType'],this['uniformMap']=_0x2f9d5c['uniformMap'],this[_0x592406(0x2ad)]=_0x2f9d5c[_0x592406(0x2ad)],this[_0x592406(0x22b)]=_0x2f9d5c[_0x592406(0x22b)],this['rawRenderState']=_0x2f9d5c['rawRenderState'],this['framebuffer']=_0x2f9d5c['framebuffer'],this['outputTexture']=_0x2f9d5c['outputTexture'],this[_0x592406(0x2a9)]=_0x2f9d5c['autoClear']??![],this['preExecute']=_0x2f9d5c['preExecute'],this['show']=!![],this['commandToExecute']=undefined,this['clearCommand']=undefined,this[_0x592406(0x2a9)]&&(this[_0x592406(0x268)]=new Cesium$6['ClearCommand']({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6[_0x592406(0x2d0)]['OPAQUE']}));}[_0x39bfda(0x1f8)](_0x4c232f){const _0x548af5=_0x39bfda;switch(this['commandType']){case'Draw':{const _0x458ba7=Cesium$6[_0x548af5(0x1f4)]['fromGeometry']({'context':_0x4c232f,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']}),_0x177760=Cesium$6['ShaderProgram']['fromCache']({'context':_0x4c232f,'attributeLocations':this[_0x548af5(0x2c2)],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this['fragmentShaderSource']}),_0x22891e=Cesium$6[_0x548af5(0x280)]['fromCache'](this[_0x548af5(0x22f)]);return new Cesium$6['DrawCommand']({'primitiveType':this['primitiveType'],'shaderProgram':_0x177760,'vertexArray':_0x458ba7,'modelMatrix':Cesium$6['Matrix4']['IDENTITY'],'renderState':_0x22891e,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6[_0x548af5(0x2d0)]['OPAQUE'],'pickOnly':!![],'owner':this});}case _0x548af5(0x229):{return new Cesium$6[(_0x548af5(0x238))]({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}['setGeometry'](_0x136925,_0x233556){const _0x643ecb=_0x39bfda;this[_0x643ecb(0x243)]=_0x233556;const _0x1e8106=Cesium$6['VertexArray']['fromGeometry']({'context':_0x136925,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']});this[_0x643ecb(0x293)]['vertexArray']=_0x1e8106;}['update'](_0x5d1122){const _0x3ed477=_0x39bfda;if(!this['show'])return;if(_0x5d1122[_0x3ed477(0x27c)]!==Cesium$6[_0x3ed477(0x228)]['SCENE3D'])return;!Cesium$6[_0x3ed477(0x255)](this['commandToExecute'])&&(this['commandToExecute']=this['createCommand'](_0x5d1122['context'])),Cesium$6['defined'](this[_0x3ed477(0x2a2)])&&this[_0x3ed477(0x2a2)](),Cesium$6[_0x3ed477(0x255)](this['clearCommand'])&&_0x5d1122['commandList']['push'](this['clearCommand']),_0x5d1122['commandList']['push'](this['commandToExecute']);}[_0x39bfda(0x2c8)](){return![];}['destroy'](){const _0x151cb5=_0x39bfda;if(this['clearCommand']){var _0x862e4c,_0x4b40c9;(_0x862e4c=this['clearCommand'])!==null&&_0x862e4c!==void 0x0&&_0x862e4c[_0x151cb5(0x1f5)]&&this['clearCommand']['vertexArray']['destroy'](),(_0x4b40c9=this[_0x151cb5(0x268)])!==null&&_0x4b40c9!==void 0x0&&_0x4b40c9['shaderProgram']&&this['clearCommand'][_0x151cb5(0x2ac)]['destroy'](),delete this['clearCommand'];}return this[_0x151cb5(0x293)]&&(this['commandToExecute']['vertexArray']&&this['commandToExecute']['vertexArray']['destroy'](),this['commandToExecute']['shaderProgram']&&this['commandToExecute']['shaderProgram']['destroy'](),delete this['commandToExecute']),Cesium$6['destroyObject'](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0x1a490d=function(){const _0x5154dc=_0x470f,_0x1c195c=new Cesium$5['Geometry']({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5[_0x5154dc(0x2d6)]['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5[_0x5154dc(0x2d6)]['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x1c195c;},_0x101562=function(_0x201fd9,_0x47ee0c){if(Cesium$5['defined'](_0x47ee0c)){const _0xd8b79a={};_0xd8b79a['arrayBufferView']=_0x47ee0c,_0x201fd9['source']=_0xd8b79a;}const _0x41a58c=new Cesium$5['Texture'](_0x201fd9);return _0x41a58c;},_0x330d04=function(_0x184e7b,_0x56d269,_0x20720a){const _0x14cbc7=new Cesium$5['Framebuffer']({'context':_0x184e7b,'colorTextures':[_0x56d269],'depthTexture':_0x20720a});return _0x14cbc7;},_0x263479=function(_0x3a2081){const _0x32ff88=_0x470f,_0x65fd25=!![],_0x2a1e91=![],_0x366722={'viewport':_0x3a2081['viewport'],'depthTest':_0x3a2081['depthTest'],'depthMask':_0x3a2081['depthMask'],'blending':_0x3a2081['blending']},_0x286764=Cesium$5['Appearance'][_0x32ff88(0x210)](_0x65fd25,_0x2a1e91,_0x366722);return _0x286764;},_0x152bd3=function(_0x3bc5b7){const _0x102cce=_0x470f,_0x34fa6a={},_0x5e5df7=Cesium$5['Math']['mod'](_0x3bc5b7[_0x102cce(0x284)],Cesium$5[_0x102cce(0x2b5)]['TWO_PI']),_0x37dee9=Cesium$5['Math'][_0x102cce(0x20c)](_0x3bc5b7[_0x102cce(0x285)],Cesium$5['Math']['TWO_PI']),_0x227f61=_0x3bc5b7['width'];let _0x38f2b6,_0xad682a;_0x227f61>Cesium$5['Math']['THREE_PI_OVER_TWO']?(_0x38f2b6=0x0,_0xad682a=Cesium$5[_0x102cce(0x2b5)]['TWO_PI']):_0x37dee9-_0x5e5df7<_0x227f61?(_0x38f2b6=_0x5e5df7,_0xad682a=_0x5e5df7+_0x227f61):(_0x38f2b6=_0x5e5df7,_0xad682a=_0x37dee9);_0x34fa6a['lon']={'min':Cesium$5['Math']['toDegrees'](_0x38f2b6),'max':Cesium$5['Math'][_0x102cce(0x289)](_0xad682a)};const _0x955516=_0x3bc5b7['south'],_0x38d560=_0x3bc5b7['north'],_0xa20eaa=_0x3bc5b7['height'],_0x1fbaef=_0xa20eaa>Cesium$5['Math']['PI']/0xc?_0xa20eaa/0x2:0x0;let _0x56cd1f=Cesium$5[_0x102cce(0x2b5)][_0x102cce(0x25f)](_0x955516-_0x1fbaef),_0x19149e=Cesium$5['Math'][_0x102cce(0x25f)](_0x38d560+_0x1fbaef);return _0x56cd1f<-Cesium$5['Math']['PI_OVER_THREE']&&(_0x56cd1f=-Cesium$5['Math'][_0x102cce(0x225)]),_0x19149e>Cesium$5['Math'][_0x102cce(0x292)]&&(_0x19149e=Cesium$5['Math'][_0x102cce(0x225)]),_0x34fa6a['lat']={'min':Cesium$5[_0x102cce(0x2b5)]['toDegrees'](_0x56cd1f),'max':Cesium$5['Math']['toDegrees'](_0x19149e)},_0x34fa6a;};return{'getFullscreenQuad':_0x1a490d,'createTexture':_0x101562,'createFramebuffer':_0x330d04,'createRawRenderState':_0x263479,'viewRectangleToLonLatRange':_0x152bd3};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a',screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace[_0x39bfda(0x2b3)];class ParticlesRendering{constructor(_0x4fd30f,_0x3ebebb,_0x3221cb,_0x2969bc,_0x27b51e){this['createRenderingTextures'](_0x4fd30f,_0x3ebebb,_0x3221cb['colors']),this['createRenderingFramebuffers'](_0x4fd30f),this['createRenderingPrimitives'](_0x4fd30f,_0x3221cb,_0x2969bc,_0x27b51e);}['createRenderingTextures'](_0x1d9bf7,_0x47111c,_0x50633f){const _0x48f1a9=_0x39bfda,_0x386eae={'context':_0x1d9bf7,'width':_0x1d9bf7[_0x48f1a9(0x22e)],'height':_0x1d9bf7[_0x48f1a9(0x23a)],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4['PixelDatatype'][_0x48f1a9(0x263)]},_0x5bb865={'context':_0x1d9bf7,'width':_0x1d9bf7['drawingBufferWidth'],'height':_0x1d9bf7['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4['PixelDatatype'][_0x48f1a9(0x239)]},_0x56224b=_0x50633f[_0x48f1a9(0x249)],_0x49f9b6=new Float32Array(_0x56224b*0x3);for(let _0x4ad946=0x0;_0x4ad946<_0x56224b;_0x4ad946++){const _0x2e1ae7=Cesium$4['Color']['fromCssColorString'](_0x50633f[_0x4ad946]);_0x49f9b6[0x3*_0x4ad946]=_0x2e1ae7['red'],_0x49f9b6[0x3*_0x4ad946+0x1]=_0x2e1ae7[_0x48f1a9(0x223)],_0x49f9b6[0x3*_0x4ad946+0x2]=_0x2e1ae7['blue'];}const _0x2d80b4={'context':_0x1d9bf7,'width':_0x56224b,'height':0x1,'pixelFormat':Cesium$4['PixelFormat']['RGB'],'pixelDatatype':Cesium$4['PixelDatatype'][_0x48f1a9(0x231)],'sampler':new Cesium$4[(_0x48f1a9(0x24a))]({'minificationFilter':Cesium$4['TextureMinificationFilter'][_0x48f1a9(0x28f)],'magnificationFilter':Cesium$4[_0x48f1a9(0x2a5)]['LINEAR']})};this['textures']={'segmentsColor':Util['createTexture'](_0x386eae),'segmentsDepth':Util['createTexture'](_0x5bb865),'currentTrailsColor':Util['createTexture'](_0x386eae),'currentTrailsDepth':Util['createTexture'](_0x5bb865),'nextTrailsColor':Util['createTexture'](_0x386eae),'nextTrailsDepth':Util[_0x48f1a9(0x2a3)](_0x5bb865),'colorTable':Util['createTexture'](_0x2d80b4,_0x49f9b6)};}['createRenderingFramebuffers'](_0x273beb){const _0x1ce000=_0x39bfda;this['framebuffers']={'segments':Util['createFramebuffer'](_0x273beb,this['textures']['segmentsColor'],this[_0x1ce000(0x23e)][_0x1ce000(0x1fc)]),'currentTrails':Util['createFramebuffer'](_0x273beb,this[_0x1ce000(0x23e)]['currentTrailsColor'],this['textures'][_0x1ce000(0x242)]),'nextTrails':Util[_0x1ce000(0x2ca)](_0x273beb,this['textures']['nextTrailsColor'],this[_0x1ce000(0x23e)][_0x1ce000(0x257)])};}['createSegmentsGeometry'](_0x3384e9){const _0x1cd50a=_0x39bfda,_0x3f4a32=0x4;let _0x502c5a=[];for(let _0x4ca2cf=0x0;_0x4ca2cf<_0x3384e9['particlesTextureSize'];_0x4ca2cf++){for(let _0x245991=0x0;_0x245991<_0x3384e9['particlesTextureSize'];_0x245991++){for(let _0x5d6561=0x0;_0x5d6561<_0x3f4a32;_0x5d6561++){_0x502c5a['push'](_0x4ca2cf/_0x3384e9[_0x1cd50a(0x266)]),_0x502c5a[_0x1cd50a(0x25a)](_0x245991/_0x3384e9['particlesTextureSize']);}}}_0x502c5a=new Float32Array(_0x502c5a);let _0x1f2dd7=[];const _0x13b4f0=[-0x1,0x1],_0x10ecf1=[-0x1,0x1];for(let _0x147d58=0x0;_0x147d58<_0x3384e9['maxParticles'];_0x147d58++){for(let _0x11a155=0x0;_0x11a155<_0x3f4a32/0x2;_0x11a155++){for(let _0x4be15b=0x0;_0x4be15b<_0x3f4a32/0x2;_0x4be15b++){_0x1f2dd7[_0x1cd50a(0x25a)](_0x13b4f0[_0x11a155]),_0x1f2dd7['push'](_0x10ecf1[_0x4be15b]),_0x1f2dd7['push'](0x0);}}}_0x1f2dd7=new Float32Array(_0x1f2dd7);const _0x243266=0x6*_0x3384e9['maxParticles'],_0x1f239e=new Uint32Array(_0x243266);for(let _0x3e6c6e=0x0,_0x568c40=0x0,_0x420c6c=0x0;_0x3e6c6e<_0x3384e9[_0x1cd50a(0x2b6)];_0x3e6c6e++){_0x1f239e[_0x568c40++]=_0x420c6c+0x0,_0x1f239e[_0x568c40++]=_0x420c6c+0x1,_0x1f239e[_0x568c40++]=_0x420c6c+0x2,_0x1f239e[_0x568c40++]=_0x420c6c+0x2,_0x1f239e[_0x568c40++]=_0x420c6c+0x1,_0x1f239e[_0x568c40++]=_0x420c6c+0x3,_0x420c6c+=0x4;}const _0x3b5dde=new Cesium$4[(_0x1cd50a(0x281))]({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':_0x502c5a}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':_0x1f2dd7})}),'indices':_0x1f239e});return _0x3b5dde;}['createRenderingPrimitives'](_0x428193,_0x12be44,_0x49282f,_0x520286){const _0x2a1d17=_0x39bfda,_0x207ed3=this;this['primitives']={'segments':new CustomPrimitive({'commandType':_0x2a1d17(0x270),'attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x12be44),'primitiveType':Cesium$4[_0x2a1d17(0x2d2)]['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function(){return _0x520286['particlesTextures']['currentParticlesPosition'];},'postProcessingPosition':function(){return _0x520286['particlesTextures']['postProcessingPosition'];},'postProcessingSpeed':function(){return _0x520286['particlesTextures']['postProcessingSpeed'];},'colorTable':function(){return _0x207ed3['textures']['colorTable'];},'aspect':function(){return _0x428193['drawingBufferWidth']/_0x428193['drawingBufferHeight'];},'pixelSize':function(){const _0x19c99f=_0x2a1d17;return _0x49282f[_0x19c99f(0x24b)];},'lineWidth':function(){const _0x490376=_0x2a1d17;return _0x12be44[_0x490376(0x2c1)];},'particleHeight':function(){return _0x12be44['particleHeight'];}},'vertexShaderSource':new Cesium$4[(_0x2a1d17(0x2cf))]({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers']['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType'][_0x2a1d17(0x1f6)],'uniformMap':{'segmentsColorTexture':function(){return _0x207ed3['textures']['segmentsColor'];},'segmentsDepthTexture':function(){return _0x207ed3['textures']['segmentsDepth'];},'currentTrailsColor':function(){const _0x2823a7=_0x2a1d17;return _0x207ed3['framebuffers'][_0x2823a7(0x20b)]['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0xff2797=_0x2a1d17;return _0x207ed3['framebuffers']['currentTrails'][_0xff2797(0x2de)];},'fadeOpacity':function(){return _0x12be44['fadeOpacity'];}},'vertexShaderSource':new Cesium$4[(_0x2a1d17(0x2cf))]({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this[_0x2a1d17(0x21e)]['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x2357df=_0x2a1d17,_0x179195=_0x207ed3[_0x2357df(0x21e)]['currentTrails'];_0x207ed3[_0x2357df(0x21e)]['currentTrails']=_0x207ed3['framebuffers']['nextTrails'],_0x207ed3['framebuffers'][_0x2357df(0x226)]=_0x179195,_0x207ed3['primitives']['trails']['commandToExecute']['framebuffer']=_0x207ed3['framebuffers']['nextTrails'],_0x207ed3['primitives']['trails']['clearCommand'][_0x2357df(0x2af)]=_0x207ed3['framebuffers'][_0x2357df(0x226)];}}),'screen':new CustomPrimitive({'commandType':_0x2a1d17(0x270),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'trailsColorTexture':function(){const _0x412e36=_0x2a1d17;return _0x207ed3[_0x412e36(0x21e)]['nextTrails'][_0x412e36(0x2d4)](0x0);},'trailsDepthTexture':function(){const _0x480e7e=_0x2a1d17;return _0x207ed3['framebuffers'][_0x480e7e(0x226)]['depthTexture'];}},'vertexShaderSource':new Cesium$4[(_0x2a1d17(0x2cf))]({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag='//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a',updateSpeed_frag=_0x39bfda(0x21b),updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace['Cesium'];class ParticlesComputing{constructor(_0x49afd9,_0x88d9f0,_0x1dd3af,_0x21e95a){const _0x5688c8=_0x39bfda;this[_0x5688c8(0x2d9)]=_0x88d9f0,this['createWindTextures'](_0x49afd9,_0x88d9f0),this['createParticlesTextures'](_0x49afd9,_0x1dd3af,_0x21e95a),this['createComputingPrimitives'](_0x88d9f0,_0x1dd3af,_0x21e95a);}['createWindTextures'](_0x14d168,_0x299ec0){const _0x166787=_0x39bfda,_0x318f23={'context':_0x14d168,'width':_0x299ec0['dimensions']['lon'],'height':_0x299ec0['dimensions'][_0x166787(0x213)]*(_0x299ec0['dimensions']['lev']||0x1),'pixelFormat':Cesium$3['PixelFormat']['LUMINANCE'],'pixelDatatype':Cesium$3['PixelDatatype'][_0x166787(0x231)],'flipY':![],'sampler':new Cesium$3[(_0x166787(0x24a))]({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})};this['windTextures']={'U':Util['createTexture'](_0x318f23,_0x299ec0['U']['array']),'V':Util['createTexture'](_0x318f23,_0x299ec0['V'][_0x166787(0x264)])};}[_0x39bfda(0x204)](_0x4ecec6,_0x488ff1,_0x393efe){const _0x2895a4=_0x39bfda,_0x4ac1d8={'context':_0x4ecec6,'width':_0x488ff1['particlesTextureSize'],'height':_0x488ff1[_0x2895a4(0x266)],'pixelFormat':Cesium$3['PixelFormat'][_0x2895a4(0x220)],'pixelDatatype':Cesium$3[_0x2895a4(0x2b4)]['FLOAT'],'flipY':![],'sampler':new Cesium$3[(_0x2895a4(0x24a))]({'minificationFilter':Cesium$3[_0x2895a4(0x256)]['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})},_0x193a46=this['randomizeParticles'](_0x488ff1['maxParticles'],_0x393efe),_0x48269c=new Float32Array(0x4*_0x488ff1['maxParticles'])['fill'](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x4ac1d8),'currentParticlesPosition':Util['createTexture'](_0x4ac1d8,_0x193a46),'nextParticlesPosition':Util['createTexture'](_0x4ac1d8,_0x193a46),'currentParticlesSpeed':Util['createTexture'](_0x4ac1d8,_0x48269c),'nextParticlesSpeed':Util['createTexture'](_0x4ac1d8,_0x48269c),'postProcessingPosition':Util['createTexture'](_0x4ac1d8,_0x193a46),'postProcessingSpeed':Util[_0x2895a4(0x2a3)](_0x4ac1d8,_0x48269c)};}['randomizeParticles'](_0x6d8518,_0x488082){const _0x133337=_0x39bfda,_0x4a0309=new Float32Array(0x4*_0x6d8518);for(let _0x1961b4=0x0;_0x1961b4<_0x6d8518;_0x1961b4++){_0x4a0309[0x4*_0x1961b4]=Cesium$3['Math']['randomBetween'](_0x488082['lonRange']['x'],_0x488082['lonRange']['y']),_0x4a0309[0x4*_0x1961b4+0x1]=Cesium$3[_0x133337(0x2b5)]['randomBetween'](_0x488082['latRange']['x'],_0x488082['latRange']['y']),_0x4a0309[0x4*_0x1961b4+0x2]=Cesium$3[_0x133337(0x2b5)]['randomBetween'](this[_0x133337(0x2d9)][_0x133337(0x1fd)][_0x133337(0x26d)],this['data']['lev']['max']),_0x4a0309[0x4*_0x1961b4+0x3]=0x0;}return _0x4a0309;}['destroyParticlesTextures'](){const _0x4e17e3=_0x39bfda;Object[_0x4e17e3(0x236)](this['particlesTextures'])[_0x4e17e3(0x2d7)](_0x375b45=>{const _0x18ac2a=_0x4e17e3;this['particlesTextures'][_0x375b45][_0x18ac2a(0x202)]();});}[_0x39bfda(0x2bf)](_0x1ef428,_0x4a9fea,_0x3dc553){const _0x388cab=_0x39bfda,_0x14f58b=new Cesium$3['Cartesian3'](_0x1ef428['dimensions'][_0x388cab(0x2ab)],_0x1ef428['dimensions']['lat'],_0x1ef428['dimensions']['lev']),_0x1458e3=new Cesium$3[(_0x388cab(0x2c7))](_0x1ef428[_0x388cab(0x2ab)][_0x388cab(0x26d)],_0x1ef428['lat'][_0x388cab(0x26d)],_0x1ef428[_0x388cab(0x1fd)][_0x388cab(0x26d)]),_0x26cd88=new Cesium$3['Cartesian3'](_0x1ef428['lon']['max'],_0x1ef428['lat']['max'],_0x1ef428['lev']['max']),_0x1a06c2=new Cesium$3['Cartesian3']((_0x26cd88['x']-_0x1458e3['x'])/(_0x14f58b['x']-0x1),(_0x26cd88['y']-_0x1458e3['y'])/(_0x14f58b['y']-0x1),_0x14f58b['z']>0x1?(_0x26cd88['z']-_0x1458e3['z'])/(_0x14f58b['z']-0x1):0x1),_0x5a1c5c=new Cesium$3['Cartesian2'](_0x1ef428['U']['min'],_0x1ef428['U']['max']),_0x52f1f9=new Cesium$3['Cartesian2'](_0x1ef428['V']['min'],_0x1ef428['V']['max']),_0x28ecce=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){return _0x28ecce['windTextures']['U'];},'V':function(){return _0x28ecce['windTextures']['V'];},'currentParticlesPosition':function(){return _0x28ecce['particlesTextures']['currentParticlesPosition'];},'dimension':function(){return _0x14f58b;},'minimum':function(){return _0x1458e3;},'maximum':function(){return _0x26cd88;},'interval':function(){return _0x1a06c2;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures'][_0x388cab(0x2b2)],'preExecute':function(){const _0x24cfd4=_0x388cab;_0x28ecce['primitives'][_0x24cfd4(0x24c)]['commandToExecute'][_0x24cfd4(0x252)]=_0x28ecce['particlesTextures'][_0x24cfd4(0x2b2)];}}),'updateSpeed':new CustomPrimitive({'commandType':_0x388cab(0x229),'uniformMap':{'currentParticlesSpeed':function(){return _0x28ecce['particlesTextures']['currentParticlesSpeed'];},'particlesWind':function(){const _0x105d93=_0x388cab;return _0x28ecce['particlesTextures'][_0x105d93(0x2b2)];},'uSpeedRange':function(){return _0x5a1c5c;},'vSpeedRange':function(){return _0x52f1f9;},'pixelSize':function(){const _0x252526=_0x388cab;return _0x3dc553[_0x252526(0x24b)];},'speedFactor':function(){const _0x75fc5e=_0x388cab;return _0x4a9fea[_0x75fc5e(0x2d3)];}},'fragmentShaderSource':new Cesium$3[(_0x388cab(0x2cf))]({'sources':[updateSpeed_frag]}),'outputTexture':this[_0x388cab(0x2c5)]['nextParticlesSpeed'],'preExecute':function(){const _0x4a7537=_0x388cab,_0x231767=_0x28ecce['particlesTextures']['currentParticlesSpeed'];_0x28ecce['particlesTextures'][_0x4a7537(0x2db)]=_0x28ecce[_0x4a7537(0x2c5)][_0x4a7537(0x273)],_0x28ecce[_0x4a7537(0x2c5)][_0x4a7537(0x273)]=_0x231767,_0x28ecce['primitives']['updateSpeed']['commandToExecute'][_0x4a7537(0x252)]=_0x28ecce['particlesTextures'][_0x4a7537(0x1fb)];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){return _0x28ecce['particlesTextures']['currentParticlesPosition'];},'currentParticlesSpeed':function(){const _0x12711e=_0x388cab;return _0x28ecce[_0x12711e(0x2c5)]['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3[(_0x388cab(0x2cf))]({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures']['nextParticlesPosition'],'preExecute':function(){const _0x2a8eda=_0x388cab,_0x106c5f=_0x28ecce[_0x2a8eda(0x2c5)]['currentParticlesPosition'];_0x28ecce['particlesTextures'][_0x2a8eda(0x2dc)]=_0x28ecce['particlesTextures']['postProcessingPosition'],_0x28ecce['particlesTextures']['postProcessingPosition']=_0x106c5f,_0x28ecce['primitives']['updatePosition'][_0x2a8eda(0x293)]['outputTexture']=_0x28ecce[_0x2a8eda(0x2c5)]['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){return _0x28ecce['particlesTextures']['nextParticlesPosition'];},'nextParticlesSpeed':function(){const _0x4cd367=_0x388cab;return _0x28ecce['particlesTextures'][_0x4cd367(0x1fb)];},'lonRange':function(){return _0x3dc553['lonRange'];},'latRange':function(){return _0x3dc553['latRange'];},'randomCoefficient':function(){const _0x453a89=_0x388cab,_0x1cc2e9=Math[_0x453a89(0x222)]();return _0x1cc2e9;},'dropRate':function(){const _0x91d4c2=_0x388cab;return _0x4a9fea[_0x91d4c2(0x274)];},'dropRateBump':function(){return _0x4a9fea['dropRateBump'];}},'fragmentShaderSource':new Cesium$3[(_0x388cab(0x2cf))]({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures'][_0x388cab(0x2a6)],'preExecute':function(){const _0x3ec37c=_0x388cab;_0x28ecce[_0x3ec37c(0x2b9)]['postProcessingPosition']['commandToExecute']['outputTexture']=_0x28ecce[_0x3ec37c(0x2c5)][_0x3ec37c(0x2a6)];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':_0x388cab(0x229),'uniformMap':{'postProcessingPosition':function(){const _0x210fe7=_0x388cab;return _0x28ecce['particlesTextures'][_0x210fe7(0x2a6)];},'nextParticlesSpeed':function(){return _0x28ecce['particlesTextures']['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function(){_0x28ecce['primitives']['postProcessingSpeed']['commandToExecute']['outputTexture']=_0x28ecce['particlesTextures']['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace['Cesium'];class ParticleSystem{constructor(_0xb93c36,_0x507bca,_0xa41057,_0x405942){const _0xb67fcd=_0x39bfda;this['context']=_0xb93c36,_0x507bca={..._0x507bca},_0x507bca['udata']&&_0x507bca['vdata']&&(_0x507bca[_0xb67fcd(0x214)]={},_0x507bca['dimensions']['lon']=_0x507bca['cols'],_0x507bca['dimensions']['lat']=_0x507bca['rows'],_0x507bca['dimensions']['lev']=_0x507bca['lev']||0x1,_0x507bca['lon']={},_0x507bca['lon']['min']=_0x507bca['xmin'],_0x507bca['lon']['max']=_0x507bca['xmax'],_0x507bca[_0xb67fcd(0x213)]={},_0x507bca[_0xb67fcd(0x213)]['min']=_0x507bca['ymin'],_0x507bca['lat']['max']=_0x507bca['ymax'],_0x507bca['lev']={},_0x507bca['lev'][_0xb67fcd(0x26d)]=_0x507bca['levmin']??0x1,_0x507bca['lev']['max']=_0x507bca[_0xb67fcd(0x205)]??0x1,_0x507bca['U']={},_0x507bca['U']['array']=new Float32Array(_0x507bca[_0xb67fcd(0x2d1)]),_0x507bca['U'][_0xb67fcd(0x26d)]=_0x507bca['umin']??Math['min'](..._0x507bca['udata']),_0x507bca['U'][_0xb67fcd(0x27e)]=_0x507bca['umax']??Math[_0xb67fcd(0x27e)](..._0x507bca['udata']),_0x507bca['V']={},_0x507bca['V']['array']=new Float32Array(_0x507bca['vdata']),_0x507bca['V']['min']=_0x507bca[_0xb67fcd(0x201)]??Math['min'](..._0x507bca['vdata']),_0x507bca['V']['max']=_0x507bca['vmax']??Math['max'](..._0x507bca[_0xb67fcd(0x259)])),this['data']=_0x507bca,this['options']=_0xa41057,this['viewerParameters']=_0x405942,this[_0xb67fcd(0x247)]=new ParticlesComputing(this['context'],this['data'],this[_0xb67fcd(0x211)],this[_0xb67fcd(0x25b)]),this[_0xb67fcd(0x2ae)]=new ParticlesRendering(this['context'],this[_0xb67fcd(0x2d9)],this[_0xb67fcd(0x211)],this[_0xb67fcd(0x25b)],this['particlesComputing']);}['canvasResize'](_0x35f386){const _0x4c3d67=_0x39bfda;this[_0x4c3d67(0x247)][_0x4c3d67(0x272)](),Object[_0x4c3d67(0x236)](this['particlesComputing']['windTextures'])[_0x4c3d67(0x2d7)](_0x3af9ba=>{this['particlesComputing']['windTextures'][_0x3af9ba]['destroy']();}),this['particlesRendering']['textures']['colorTable'][_0x4c3d67(0x202)](),Object[_0x4c3d67(0x236)](this['particlesRendering']['framebuffers'])[_0x4c3d67(0x2d7)](_0x290f=>{const _0x21c121=_0x4c3d67;this['particlesRendering']['framebuffers'][_0x290f][_0x21c121(0x202)]();}),this['context']=_0x35f386,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this[_0x4c3d67(0x211)],this[_0x4c3d67(0x25b)]),this['particlesRendering']=new ParticlesRendering(this['context'],this[_0x4c3d67(0x2d9)],this[_0x4c3d67(0x211)],this['viewerParameters'],this[_0x4c3d67(0x247)]);}[_0x39bfda(0x246)](){const _0x24dafe=_0x39bfda,_0x589096=new Cesium$2['ClearCommand']({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass']['OPAQUE']});Object['keys'](this['particlesRendering'][_0x24dafe(0x21e)])['forEach'](_0x3ddbd9=>{const _0x5debee=_0x24dafe;_0x589096['framebuffer']=this[_0x5debee(0x2ae)][_0x5debee(0x21e)][_0x3ddbd9],_0x589096[_0x5debee(0x230)](this['context']);});}['refreshParticles'](_0x4f62e3){const _0x43fbb0=_0x39bfda;this['clearFramebuffers'](),this['particlesComputing']['destroyParticlesTextures'](),this['particlesComputing']['createParticlesTextures'](this['context'],this['options'],this['viewerParameters']);if(_0x4f62e3){var _0x4ac840;const _0x2b1927=this['particlesRendering']['createSegmentsGeometry'](this[_0x43fbb0(0x211)]);this[_0x43fbb0(0x2ae)]['primitives']['segments'][_0x43fbb0(0x243)]=_0x2b1927;const _0x50e339=Cesium$2[_0x43fbb0(0x1f4)]['fromGeometry']({'context':this[_0x43fbb0(0x224)],'geometry':_0x2b1927,'attributeLocations':this['particlesRendering'][_0x43fbb0(0x2b9)]['segments']['attributeLocations'],'bufferUsage':Cesium$2['BufferUsage']['STATIC_DRAW']});(_0x4ac840=this[_0x43fbb0(0x2ae)]['primitives'])!==null&&_0x4ac840!==void 0x0&&(_0x4ac840=_0x4ac840['segments'])!==null&&_0x4ac840!==void 0x0&&_0x4ac840[_0x43fbb0(0x293)]&&(this['particlesRendering']['primitives']['segments']['commandToExecute']['vertexArray']=_0x50e339);}}[_0x39bfda(0x216)](_0x443056){const _0x367c91=_0x39bfda;let _0x3caf53=![];this[_0x367c91(0x211)]['maxParticles']!==_0x443056['maxParticles']&&(_0x3caf53=!![]),Object[_0x367c91(0x236)](_0x443056)[_0x367c91(0x2d7)](_0x5c45a7=>{const _0x5b9053=_0x367c91;this[_0x5b9053(0x211)][_0x5c45a7]=_0x443056[_0x5c45a7];}),this['refreshParticles'](_0x3caf53);}['applyViewerParameters'](_0x32227b){const _0x170025=_0x39bfda;Object[_0x170025(0x236)](_0x32227b)['forEach'](_0x2d3d89=>{const _0x5b5dd9=_0x170025;this[_0x5b5dd9(0x25b)][_0x2d3d89]=_0x32227b[_0x2d3d89];}),this['refreshParticles'](![]);}[_0x39bfda(0x202)](){const _0x432ed5=_0x39bfda;clearTimeout(this['canrefresh']),this['particlesComputing']['destroyParticlesTextures'](),Object[_0x432ed5(0x236)](this[_0x432ed5(0x247)]['windTextures'])['forEach'](_0xbe8ac0=>{this['particlesComputing']['windTextures'][_0xbe8ac0]['destroy']();}),this['particlesRendering']['textures'][_0x432ed5(0x20f)][_0x432ed5(0x202)](),Object['keys'](this['particlesRendering'][_0x432ed5(0x21e)])['forEach'](_0x347aea=>{const _0x13da74=_0x432ed5;this['particlesRendering'][_0x13da74(0x21e)][_0x347aea]['destroy']();});for(const _0x4f91d2 in this){delete this[_0x4f91d2];}}}const Cesium$1=mars3d__namespace[_0x39bfda(0x2b3)],BaseLayer$1=mars3d__namespace['layer']['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};class WindLayer extends BaseLayer$1{constructor(_0x4c9d82={}){const _0x5d6bfd=_0x39bfda;_0x4c9d82={...DEF_OPTIONS,..._0x4c9d82},super(_0x4c9d82),this[_0x5d6bfd(0x2cd)](_0x4c9d82);}get['layer'](){return this['primitives'];}get['data'](){return this['_data'];}set['data'](_0x251197){this['setData'](_0x251197);}get['colors'](){const _0x3a81f8=_0x39bfda;return this[_0x3a81f8(0x211)][_0x3a81f8(0x2b8)];}set['colors'](_0x73a90b){this['options']['colors']=_0x73a90b,this['particleSystem']&&this['particleSystem']['setOptions']({'colors':_0x73a90b}),this['resize']();}['_mountedHook'](){}[_0x39bfda(0x21d)](){const _0x11aa87=_0x39bfda;this[_0x11aa87(0x241)]=this['_map']['scene'],this['camera']=this[_0x11aa87(0x2aa)]['camera'],this[_0x11aa87(0x2b9)]=new Cesium$1[(_0x11aa87(0x26f))](),this['_map'][_0x11aa87(0x241)]['primitives']['add'](this['primitives']),this['viewerParameters']={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this[_0x11aa87(0x2ba)]=new Cesium$1[(_0x11aa87(0x250))](Cesium$1[_0x11aa87(0x2c7)][_0x11aa87(0x23c)],0.99*0x615299),this['updateViewerParameters'](),window[_0x11aa87(0x2c0)](_0x11aa87(0x2cb),this['resize']['bind'](this),![]),this[_0x11aa87(0x265)]=![],this[_0x11aa87(0x26e)]=![],this[_0x11aa87(0x2aa)]['on'](mars3d__namespace[_0x11aa87(0x2bc)][_0x11aa87(0x27d)],this[_0x11aa87(0x2a0)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this[_0x11aa87(0x221)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this[_0x11aa87(0x298)],this),this['_data']&&this['setData'](this['_data']);}['_removedHook'](){const _0x5206aa=_0x39bfda;window['removeEventListener']('resize',this[_0x5206aa(0x2cb)]),this[_0x5206aa(0x2aa)]['off'](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this),this['_map'][_0x5206aa(0x260)](mars3d__namespace['EventType'][_0x5206aa(0x27d)],this['_onMapWhellEvent'],this),this['_map']['off'](mars3d__namespace['EventType'][_0x5206aa(0x258)],this[_0x5206aa(0x221)],this),this[_0x5206aa(0x2aa)]['off'](mars3d__namespace[_0x5206aa(0x2bc)]['mouseUp'],this['_onMouseUpEvent'],this),this[_0x5206aa(0x2aa)]['off'](mars3d__namespace['EventType']['mouseMove'],this[_0x5206aa(0x298)],this),this['primitives']['removeAll'](),this['_map'][_0x5206aa(0x241)]['primitives']['remove'](this['primitives']);}['resize'](){const _0x38badd=_0x39bfda;if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this['primitives']['removeAll'](),this[_0x38badd(0x2aa)][_0x38badd(0x29e)](mars3d__namespace['EventType']['preRender'],this[_0x38badd(0x2a7)],this);}[_0x39bfda(0x2a7)](_0x3a19e9){const _0x5e7ad1=_0x39bfda;this['particleSystem']['canvasResize'](this[_0x5e7ad1(0x241)]['context']),this['addPrimitives'](),this['primitives']['show']=!![];}['_onMapWhellEvent'](_0xc51ac3){const _0x29115a=_0x39bfda;clearTimeout(this['refreshTimer']);if(!this['show']||!this['particleSystem'])return;this[_0x29115a(0x2b9)]['show']=![],this['refreshTimer']=setTimeout(()=>{const _0x1289dc=_0x29115a;if(!this[_0x1289dc(0x2bd)])return;this['redraw']();},0xc8);}['_onMouseDownEvent'](_0x3b8f74){this['mouse_down']=!![];}['_onMouseMoveEvent'](_0x55426c){const _0x420871=_0x39bfda;if(!this['show']||!this['particleSystem'])return;this[_0x420871(0x265)]&&(this[_0x420871(0x2b9)]['show']=![],this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x550d50){const _0x149593=_0x39bfda;if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['primitives'][_0x149593(0x2bd)]=!![],this['mouse_down']=![],this['mouse_move']=![];}['redraw'](){const _0x4d9701=_0x39bfda;if(!this['_map']||!this['show'])return;this['updateViewerParameters'](),this[_0x4d9701(0x217)][_0x4d9701(0x283)](this['viewerParameters']),this['primitives'][_0x4d9701(0x2bd)]=!![];}['setData'](_0x2452f7){const _0x15df7b=_0x39bfda;this['_data']=_0x2452f7,this[_0x15df7b(0x217)]&&this[_0x15df7b(0x217)]['destroy'](),this['particleSystem']=new ParticleSystem(this['scene']['context'],_0x2452f7,this[_0x15df7b(0x277)](),this['viewerParameters']),this[_0x15df7b(0x29a)]();}[_0x39bfda(0x2cd)](_0x123db7,_0x2d5261){const _0x751ca4=_0x39bfda;if(_0x123db7)for(const _0x49af42 in _0x123db7){this[_0x49af42]=_0x123db7[_0x49af42];}this['particleSystem']&&this['particleSystem']['setOptions'](this[_0x751ca4(0x277)]());}['getOptions'](){const _0x5b51c6=_0x39bfda,_0x281c75=Math['ceil'](Math['sqrt'](this[_0x5b51c6(0x297)]));return this['particlesNumber']=_0x281c75*_0x281c75,{'particlesTextureSize':_0x281c75,'maxParticles':this['particlesNumber'],'particleHeight':this['fixedHeight'],'fadeOpacity':this[_0x5b51c6(0x26a)],'dropRate':this['dropRate'],'dropRateBump':this['dropRateBump'],'speedFactor':this[_0x5b51c6(0x2d3)],'lineWidth':this['lineWidth'],'colors':this['colors']};}['addPrimitives'](){const _0x2f967b=_0x39bfda;this['primitives'][_0x2f967b(0x212)](this['particleSystem'][_0x2f967b(0x247)][_0x2f967b(0x2b9)]['getWind']),this['primitives']['add'](this[_0x2f967b(0x217)]['particlesComputing'][_0x2f967b(0x2b9)][_0x2f967b(0x20d)]),this[_0x2f967b(0x2b9)]['add'](this[_0x2f967b(0x217)][_0x2f967b(0x247)][_0x2f967b(0x2b9)]['updatePosition']),this['primitives']['add'](this[_0x2f967b(0x217)]['particlesComputing']['primitives']['postProcessingPosition']),this['primitives'][_0x2f967b(0x212)](this[_0x2f967b(0x217)]['particlesComputing']['primitives'][_0x2f967b(0x273)]),this[_0x2f967b(0x2b9)][_0x2f967b(0x212)](this[_0x2f967b(0x217)]['particlesRendering']['primitives']['segments']),this[_0x2f967b(0x2b9)]['add'](this[_0x2f967b(0x217)]['particlesRendering']['primitives']['trails']),this['primitives'][_0x2f967b(0x212)](this['particleSystem']['particlesRendering']['primitives'][_0x2f967b(0x295)]);}['updateViewerParameters'](){const _0x90d5=_0x39bfda;let _0x21dcb4=this[_0x90d5(0x2b7)]['computeViewRectangle'](this[_0x90d5(0x241)]['globe'][_0x90d5(0x294)]);if(!_0x21dcb4){const _0x34a729=this['_map']['getExtent']();_0x21dcb4=Cesium$1['Rectangle']['fromDegrees'](_0x34a729['xmin'],_0x34a729[_0x90d5(0x235)],_0x34a729['xmax'],_0x34a729[_0x90d5(0x21a)]);}const _0x5c27ca=Util[_0x90d5(0x232)](_0x21dcb4);this['viewerParameters'][_0x90d5(0x2c9)]['x']=_0x5c27ca[_0x90d5(0x2ab)]['min'],this[_0x90d5(0x25b)]['lonRange']['y']=_0x5c27ca['lon']['max'],this['viewerParameters']['latRange']['x']=_0x5c27ca['lat'][_0x90d5(0x26d)],this['viewerParameters']['latRange']['y']=_0x5c27ca['lat']['max'];const _0x670f03=this['camera']['getPixelSize'](this['globeBoundingSphere'],this[_0x90d5(0x241)]['drawingBufferWidth'],this['scene'][_0x90d5(0x23a)]);_0x670f03>0x0&&(this['viewerParameters']['pixelSize']=_0x670f03);}}mars3d__namespace['LayerUtil']['register']('wind',WindLayer),mars3d__namespace['layer']['WindLayer']=WindLayer;class CanvasParticle{constructor(){const _0x4faf09=_0x39bfda;this['lng']=null,this['lat']=null,this[_0x4faf09(0x28a)]=null,this['tlat']=null,this['age']=null,this['speed']=null;}['destroy'](){for(const _0x43d777 in this){delete this[_0x43d777];}}}class CanvasWindField{constructor(_0x4f27ff){this['setOptions'](_0x4f27ff);}get[_0x39bfda(0x2b0)](){return this['_speedRate'];}set['speedRate'](_0x286841){const _0x508c90=_0x39bfda;this['_speedRate']=(0x64-(_0x286841>0x63?0x63:_0x286841))*0x64,this[_0x508c90(0x2c6)]=[(this['xmax']-this['xmin'])/this['_speedRate'],(this['ymax']-this[_0x508c90(0x235)])/this['_speedRate']];}get['maxAge'](){return this['_maxAge'];}set['maxAge'](_0x145693){this['_maxAge']=_0x145693;}[_0x39bfda(0x216)](_0x673138){const _0x476ed9=_0x39bfda;this['options']=_0x673138,this['maxAge']=_0x673138[_0x476ed9(0x29d)]||0x78,this['speedRate']=_0x673138[_0x476ed9(0x2b0)]||0x32,this[_0x476ed9(0x200)]=[];const _0x2c6979=_0x673138['particlesNumber']||0x1000;for(let _0x2403c0=0x0;_0x2403c0<_0x2c6979;_0x2403c0++){const _0x3287c0=this['_randomParticle'](new CanvasParticle());this['particles']['push'](_0x3287c0);}}['setDate'](_0x4f41fb){const _0x47d247=_0x39bfda;this['rows']=_0x4f41fb['rows'],this['cols']=_0x4f41fb['cols'],this['xmin']=_0x4f41fb[_0x47d247(0x25c)],this['xmax']=_0x4f41fb[_0x47d247(0x25e)],this['ymin']=_0x4f41fb[_0x47d247(0x235)],this['ymax']=_0x4f41fb['ymax'],this[_0x47d247(0x2b1)]=[];const _0x5a7c15=_0x4f41fb[_0x47d247(0x2d1)],_0x4185fd=_0x4f41fb['vdata'];let _0x1c59ed=![];_0x5a7c15['length']===this[_0x47d247(0x27b)]&&_0x5a7c15[0x0]['length']===this['cols']&&(_0x1c59ed=!![]);let _0x1a2130=0x0,_0x349a53=null,_0x3ebcc8=null;for(let _0x41f7f0=0x0;_0x41f7f0<this['rows'];_0x41f7f0++){_0x349a53=[];for(let _0x1d6fd0=0x0;_0x1d6fd0<this['cols'];_0x1d6fd0++,_0x1a2130++){_0x1c59ed?_0x3ebcc8=this['_calcUV'](_0x5a7c15[_0x41f7f0][_0x1d6fd0],_0x4185fd[_0x41f7f0][_0x1d6fd0]):_0x3ebcc8=this[_0x47d247(0x23d)](_0x5a7c15[_0x1a2130],_0x4185fd[_0x1a2130]),_0x349a53['push'](_0x3ebcc8);}this['grid']['push'](_0x349a53);}this[_0x47d247(0x211)][_0x47d247(0x219)]&&this['grid'][_0x47d247(0x2c4)]();}[_0x39bfda(0x282)](){const _0x920cfc=_0x39bfda;delete this['rows'],delete this['cols'],delete this['xmin'],delete this[_0x920cfc(0x25e)],delete this['ymin'],delete this['ymax'],delete this['grid'],delete this[_0x920cfc(0x200)];}['toGridXY'](_0x311efc,_0x506c92){const _0x56cab5=_0x39bfda,_0x5c0911=(_0x311efc-this[_0x56cab5(0x25c)])/(this[_0x56cab5(0x25e)]-this['xmin'])*(this[_0x56cab5(0x218)]-0x1),_0x1aa949=(this['ymax']-_0x506c92)/(this[_0x56cab5(0x21a)]-this['ymin'])*(this['rows']-0x1);return[_0x5c0911,_0x1aa949];}['getUVByXY'](_0x4cc0bb,_0x2a32b2){const _0x2a093d=_0x39bfda;if(_0x4cc0bb<0x0||_0x4cc0bb>=this['cols']||_0x2a32b2>=this['rows'])return[0x0,0x0,0x0];const _0x22041d=Math['floor'](_0x4cc0bb),_0x35c040=Math['floor'](_0x2a32b2);if(_0x22041d===_0x4cc0bb&&_0x35c040===_0x2a32b2)return this['grid'][_0x2a32b2][_0x4cc0bb];const _0x9c9fc=_0x22041d+0x1,_0x34e62a=_0x35c040+0x1,_0x5f02e1=this['getUVByXY'](_0x22041d,_0x35c040),_0x3a50ce=this[_0x2a093d(0x253)](_0x9c9fc,_0x35c040),_0x185a00=this['getUVByXY'](_0x22041d,_0x34e62a),_0x3d7268=this['getUVByXY'](_0x9c9fc,_0x34e62a);let _0x1f1d25=null;try{_0x1f1d25=this['_bilinearInterpolation'](_0x4cc0bb-_0x22041d,_0x2a32b2-_0x35c040,_0x5f02e1,_0x3a50ce,_0x185a00,_0x3d7268);}catch(_0x2e0a5c){console[_0x2a093d(0x20a)](_0x4cc0bb,_0x2a32b2);}return _0x1f1d25;}[_0x39bfda(0x2e0)](_0x54c29a,_0x1acb60,_0x35f8ec,_0x26f38c,_0x41ed44,_0x40ce7b){const _0x8c79ca=_0x39bfda,_0x593f13=0x1-_0x54c29a,_0xc75d4f=0x1-_0x1acb60,_0x5649f1=_0x593f13*_0xc75d4f,_0x5b43d2=_0x54c29a*_0xc75d4f,_0x45f417=_0x593f13*_0x1acb60,_0x5d7913=_0x54c29a*_0x1acb60,_0xd78358=_0x35f8ec[0x0]*_0x5649f1+_0x26f38c[0x0]*_0x5b43d2+_0x41ed44[0x0]*_0x45f417+_0x40ce7b[0x0]*_0x5d7913,_0x2d84e7=_0x35f8ec[0x1]*_0x5649f1+_0x26f38c[0x1]*_0x5b43d2+_0x41ed44[0x1]*_0x45f417+_0x40ce7b[0x1]*_0x5d7913;return this[_0x8c79ca(0x23d)](_0xd78358,_0x2d84e7);}[_0x39bfda(0x23d)](_0x4f2a65,_0x4ee5c9){return[+_0x4f2a65,+_0x4ee5c9,Math['sqrt'](_0x4f2a65*_0x4f2a65+_0x4ee5c9*_0x4ee5c9)];}[_0x39bfda(0x240)](_0x43ad7e,_0x5d866f){const _0x2c7fa6=_0x39bfda;if(!this['isInExtent'](_0x43ad7e,_0x5d866f))return null;const _0x36e5d4=this['toGridXY'](_0x43ad7e,_0x5d866f),_0x43b617=this[_0x2c7fa6(0x253)](_0x36e5d4[0x0],_0x36e5d4[0x1]);return _0x43b617;}['isInExtent'](_0x47de45,_0x10dad5){const _0x242e3f=_0x39bfda;return _0x47de45>=this[_0x242e3f(0x25c)]&&_0x47de45<=this[_0x242e3f(0x25e)]&&_0x10dad5>=this['ymin']&&_0x10dad5<=this['ymax']?!![]:![];}[_0x39bfda(0x2a1)](){const _0x5d213f=fRandomByfloat(this['xmin'],this['xmax']),_0x3eea35=fRandomByfloat(this['ymin'],this['ymax']);return{'lat':_0x3eea35,'lng':_0x5d213f};}['getParticles'](){const _0x342a9b=_0x39bfda;let _0x45bdaa,_0x54f3d5,_0x482a88;for(let _0x3bcb8b=0x0,_0x431013=this[_0x342a9b(0x200)]['length'];_0x3bcb8b<_0x431013;_0x3bcb8b++){let _0x1ebab4=this['particles'][_0x3bcb8b];_0x1ebab4['age']<=0x0&&(_0x1ebab4=this['_randomParticle'](_0x1ebab4));if(_0x1ebab4['age']>0x0){const _0x4caf82=_0x1ebab4[_0x342a9b(0x28a)],_0x57b7ed=_0x1ebab4['tlat'];_0x482a88=this['getUVByPoint'](_0x4caf82,_0x57b7ed),_0x482a88?(_0x45bdaa=_0x4caf82+this['_calc_speedRate'][0x0]*_0x482a88[0x0],_0x54f3d5=_0x57b7ed+this['_calc_speedRate'][0x1]*_0x482a88[0x1],_0x1ebab4['lng']=_0x4caf82,_0x1ebab4['lat']=_0x57b7ed,_0x1ebab4['tlng']=_0x45bdaa,_0x1ebab4['tlat']=_0x54f3d5,_0x1ebab4[_0x342a9b(0x288)]=_0x482a88[0x2],_0x1ebab4['age']--):_0x1ebab4['age']=0x0;}}return this[_0x342a9b(0x200)];}['_randomParticle'](_0x50191f){const _0x21a707=_0x39bfda;let _0x1a6e0a,_0x3595c0;for(let _0x53f5db=0x0;_0x53f5db<0x1e;_0x53f5db++){_0x1a6e0a=this['getRandomLatLng'](),_0x3595c0=this['getUVByPoint'](_0x1a6e0a['lng'],_0x1a6e0a['lat']);if(_0x3595c0&&_0x3595c0[0x2]>0x0)break;}if(!_0x3595c0)return _0x50191f;const _0x8dbce9=_0x1a6e0a['lng']+this[_0x21a707(0x2c6)][0x0]*_0x3595c0[0x0],_0x31544b=_0x1a6e0a[_0x21a707(0x213)]+this['_calc_speedRate'][0x1]*_0x3595c0[0x1];return _0x50191f['lng']=_0x1a6e0a['lng'],_0x50191f['lat']=_0x1a6e0a['lat'],_0x50191f[_0x21a707(0x28a)]=_0x8dbce9,_0x50191f['tlat']=_0x31544b,_0x50191f['age']=Math['round'](Math['random']()*this['maxAge']),_0x50191f['speed']=_0x3595c0[0x2],_0x50191f;}['destroy'](){for(const _0x149c23 in this){delete this[_0x149c23];}}}function fRandomByfloat(_0x5d76ce,_0x47f646){const _0x37fc00=_0x39bfda;return _0x5d76ce+Math[_0x37fc00(0x222)]()*(_0x47f646-_0x5d76ce);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer']['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0xa346d4={}){super(_0xa346d4),this['_setOptionsHook'](_0xa346d4),this['canvas']=null,_0xa346d4['colors']&&_0xa346d4['steps']&&(this['_colorRamp']=new mars3d__namespace['ColorRamp'](_0xa346d4));}[_0x39bfda(0x2cd)](_0x5c567c,_0x47254f){const _0xa703a0=_0x39bfda;this['frameTime']=0x3e8/(_0x5c567c[_0xa703a0(0x291)]||0xa),this['_pointerEvents']=this['options']['pointerEvents']??![],this['color']=_0x5c567c['color']||'#ffffff',this[_0xa703a0(0x2c1)]=_0x5c567c['lineWidth']||0x1,this['fixedHeight']=_0x5c567c['fixedHeight']??0x0,this['reverseY']=_0x5c567c[_0xa703a0(0x219)]??![],this['windField']&&this['windField']['setOptions'](_0x5c567c);}get['layer'](){return this['canvas'];}get['canvasWidth'](){const _0x5e71f4=_0x39bfda;return this[_0x5e71f4(0x2aa)]['scene']['canvas'][_0x5e71f4(0x25d)];}get[_0x39bfda(0x233)](){const _0x43c32c=_0x39bfda;return this['_map']['scene'][_0x43c32c(0x22c)]['clientHeight'];}get['pointerEvents'](){return this['_pointerEvents'];}set['pointerEvents'](_0x432cec){const _0x364094=_0x39bfda;this[_0x364094(0x287)]=_0x432cec;if(!this[_0x364094(0x22c)])return;_0x432cec?this['canvas'][_0x364094(0x24e)]['pointer-events']=_0x364094(0x208):this['canvas'][_0x364094(0x24e)]['pointer-events']='none';}get['particlesNumber'](){return this['options']['particlesNumber'];}set['particlesNumber'](_0xd5cd16){const _0x28c053=_0x39bfda;this[_0x28c053(0x211)][_0x28c053(0x297)]=_0xd5cd16,clearTimeout(this['_canrefresh']),this[_0x28c053(0x2bb)]=setTimeout(()=>{this['redraw']();},0x1f4);}get['speedRate'](){const _0x50f80b=_0x39bfda;return this['options'][_0x50f80b(0x2b0)];}set[_0x39bfda(0x2b0)](_0x561a82){const _0x5484df=_0x39bfda;this['options'][_0x5484df(0x2b0)]=_0x561a82,this['windField']&&(this[_0x5484df(0x1fa)][_0x5484df(0x2b0)]=_0x561a82);}get[_0x39bfda(0x29d)](){return this['options']['maxAge'];}set[_0x39bfda(0x29d)](_0x12259e){const _0x1389e1=_0x39bfda;this['options']['maxAge']=_0x12259e,this[_0x1389e1(0x1fa)]&&(this['windField']['maxAge']=_0x12259e);}get['data'](){return this['windData'];}set[_0x39bfda(0x2d9)](_0x45394c){this['setData'](_0x45394c);}['_showHook'](_0x3ab2bf){const _0x51f842=_0x39bfda;_0x3ab2bf?this['_addedHook']():(this[_0x51f842(0x29c)]&&(this['options'][_0x51f842(0x2d9)]=this['windData']),this[_0x51f842(0x22a)]());}[_0x39bfda(0x1fe)](){const _0xe91225=_0x39bfda;this['options']['worker']?this[_0xe91225(0x23b)]():this['windField']=new CanvasWindField(this['options']);}['_addedHook'](){const _0x4890e3=_0x39bfda;this['canvas']=this[_0x4890e3(0x1ff)](),this['canvasContext']=this['canvas']['getContext']('2d',{'willReadFrequently':!![]}),this[_0x4890e3(0x2d8)](),this['options']['data']&&this['setData'](this['options']['data']);}['_removedHook'](){const _0x5bc734=_0x39bfda;this['clear'](),this[_0x5bc734(0x27a)](),this['canvas']&&(this['_map']['container']['removeChild'](this['canvas']),delete this['canvas']);}[_0x39bfda(0x1ff)](){const _0x41b1d9=_0x39bfda,_0x5d461f=mars3d__namespace['DomUtil']['create']('canvas','mars3d-canvasWind',this[_0x41b1d9(0x2aa)]['container']);return _0x5d461f[_0x41b1d9(0x24e)]['position']='absolute',_0x5d461f['style'][_0x41b1d9(0x2d5)]='0px',_0x5d461f['style']['left']=_0x41b1d9(0x1f7),_0x5d461f['style']['width']=this[_0x41b1d9(0x2aa)]['scene']['canvas']['clientWidth']+'px',_0x5d461f['style'][_0x41b1d9(0x29b)]=this['_map']['scene']['canvas'][_0x41b1d9(0x269)]+'px',_0x5d461f['style'][_0x41b1d9(0x275)]=this['_pointerEvents']?_0x41b1d9(0x244):'none',_0x5d461f[_0x41b1d9(0x24e)]['zIndex']=this['options']['zIndex']??0x9,_0x5d461f['width']=this['_map']['scene']['canvas']['clientWidth'],_0x5d461f['height']=this['_map'][_0x41b1d9(0x241)]['canvas']['clientHeight'],_0x5d461f;}['resize'](){const _0xa94d80=_0x39bfda;this['canvas']&&(this['canvas']['style'][_0xa94d80(0x22d)]=this[_0xa94d80(0x2aa)]['scene']['canvas']['clientWidth']+'px',this[_0xa94d80(0x22c)]['style']['height']=this['_map']['scene']['canvas']['clientHeight']+'px',this['canvas'][_0xa94d80(0x22d)]=this['_map']['scene']['canvas']['clientWidth'],this['canvas']['height']=this[_0xa94d80(0x2aa)]['scene']['canvas']['clientHeight']);}[_0x39bfda(0x2d8)](){const _0x61513e=_0x39bfda,_0x1d6bc0=this;let _0xf2b59b=Date['now']();(function _0x4ed9c4(){const _0x179218=_0x470f;_0x1d6bc0[_0x179218(0x28c)]=window['requestAnimationFrame'](_0x4ed9c4);if(_0x1d6bc0[_0x179218(0x2bd)]&&_0x1d6bc0['windField']){const _0x505a28=Date['now'](),_0x1ef1fc=_0x505a28-_0xf2b59b;_0x1ef1fc>_0x1d6bc0['frameTime']&&(_0xf2b59b=_0x505a28-_0x1ef1fc%_0x1d6bc0[_0x179218(0x2a4)],_0x1d6bc0['update']());}}(),window[_0x61513e(0x2c0)]('resize',this[_0x61513e(0x2cb)]['bind'](this),![]),this[_0x61513e(0x265)]=![],this[_0x61513e(0x26e)]=![],this['options']['mouseHidden']&&(this['_map']['on'](mars3d__namespace[_0x61513e(0x2bc)][_0x61513e(0x27d)],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace[_0x61513e(0x2bc)]['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace[_0x61513e(0x2bc)]['mouseUp'],this['_onMouseUpEvent'],this)));}[_0x39bfda(0x27a)](){const _0x4bb026=_0x39bfda;window['cancelAnimationFrame'](this['animateFrame']),delete this[_0x4bb026(0x28c)],window[_0x4bb026(0x23f)]('resize',this[_0x4bb026(0x2cb)]),this['options']['mouseHidden']&&(this['_map'][_0x4bb026(0x260)](mars3d__namespace['EventType']['wheel'],this[_0x4bb026(0x2a0)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace[_0x4bb026(0x2bc)]['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0x50e36c){const _0xf78db2=_0x39bfda;clearTimeout(this['refreshTimer']);if(!this[_0xf78db2(0x2bd)]||!this['canvas'])return;this['canvas']['style']['visibility']='hidden',this['refreshTimer']=setTimeout(()=>{const _0x34922f=_0xf78db2;if(!this[_0x34922f(0x2bd)])return;this['redraw'](),this[_0x34922f(0x22c)][_0x34922f(0x24e)]['visibility']='visible';},0xc8);}['_onMouseDownEvent'](_0x3b4920){const _0x4cc13e=_0x39bfda;this['mouse_down']=!![],this['_map'][_0x4cc13e(0x260)](mars3d__namespace['EventType'][_0x4cc13e(0x267)],this['_onMouseMoveEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0x4cc13e(0x267)],this['_onMouseMoveEvent'],this);}['_onMouseMoveEvent'](_0x5c092c){const _0x5765fd=_0x39bfda;if(!this['show']||!this['canvas'])return;this['mouse_down']&&(this['canvas']['style']['visibility']=_0x5765fd(0x1f9),this[_0x5765fd(0x26e)]=!![]);}['_onMouseUpEvent'](_0x2510cb){const _0x24da72=_0x39bfda;if(!this['show']||!this[_0x24da72(0x22c)])return;this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['mouse_down']&&this['mouse_move']&&this['redraw'](),this[_0x24da72(0x22c)]['style']['visibility']=_0x24da72(0x237),this['mouse_down']=![],this['mouse_move']=![];}['setData'](_0x494715){const _0x4971fd=_0x39bfda;this[_0x4971fd(0x282)](),this['windData']=_0x494715,this[_0x4971fd(0x1fa)]['setDate'](_0x494715),this['redraw']();}[_0x39bfda(0x290)](){const _0x5d256c=_0x39bfda;if(!this['show'])return;this[_0x5d256c(0x1fa)][_0x5d256c(0x216)](this['options']),this['update']();}['update'](){const _0x17f9f1=_0x39bfda;if(this['_updateIng'])return;this[_0x17f9f1(0x251)]=!![];if(this[_0x17f9f1(0x21f)])this['windField']['update']();else{const _0x1429f7=this[_0x17f9f1(0x1fa)]['getParticles']();this[_0x17f9f1(0x248)](_0x1429f7);}this[_0x17f9f1(0x251)]=![];}[_0x39bfda(0x248)](_0x2c22e4){const _0x47101f=_0x39bfda;this[_0x47101f(0x207)]['globalCompositeOperation']='destination-in',this[_0x47101f(0x207)]['fillRect'](0x0,0x0,this[_0x47101f(0x209)],this[_0x47101f(0x233)]),this['canvasContext']['globalCompositeOperation']=_0x47101f(0x254),this['canvasContext']['globalAlpha']=0.9;const _0x17b6b2=this['_map']['scene']['mode']!==Cesium['SceneMode']['SCENE3D'],_0x17341d=this['canvasWidth']*0.25;if(this['_colorRamp'])for(let _0x269451=0x0,_0x4bde5f=_0x2c22e4[_0x47101f(0x249)];_0x269451<_0x4bde5f;_0x269451++){const _0x3f5b2d=_0x2c22e4[_0x269451],_0x2cc400=this['_tomap'](_0x3f5b2d[_0x47101f(0x227)],_0x3f5b2d['lat'],_0x3f5b2d),_0x1d8f5f=this['_tomap'](_0x3f5b2d['tlng'],_0x3f5b2d[_0x47101f(0x27f)],_0x3f5b2d);if(!_0x2cc400||!_0x1d8f5f)continue;if(_0x17b6b2&&Math['abs'](_0x2cc400[0x0]-_0x1d8f5f[0x0])>=_0x17341d)continue;this['canvasContext'][_0x47101f(0x2be)](),this[_0x47101f(0x207)][_0x47101f(0x2c1)]=this['lineWidth'],this['canvasContext']['strokeStyle']=this['_colorRamp']['getColor'](_0x3f5b2d['speed']),this['canvasContext']['moveTo'](_0x2cc400[0x0],_0x2cc400[0x1]),this['canvasContext']['lineTo'](_0x1d8f5f[0x0],_0x1d8f5f[0x1]),this[_0x47101f(0x207)]['stroke']();}else{this['canvasContext']['beginPath'](),this[_0x47101f(0x207)]['lineWidth']=this['lineWidth'],this['canvasContext']['strokeStyle']=this['color'];for(let _0xa62846=0x0,_0x44f800=_0x2c22e4[_0x47101f(0x249)];_0xa62846<_0x44f800;_0xa62846++){const _0x37c866=_0x2c22e4[_0xa62846],_0x492460=this['_tomap'](_0x37c866[_0x47101f(0x227)],_0x37c866['lat'],_0x37c866),_0x121a2f=this['_tomap'](_0x37c866['tlng'],_0x37c866['tlat'],_0x37c866);if(!_0x492460||!_0x121a2f)continue;if(_0x17b6b2&&Math['abs'](_0x492460[0x0]-_0x121a2f[0x0])>=_0x17341d)continue;this['canvasContext'][_0x47101f(0x215)](_0x492460[0x0],_0x492460[0x1]),this[_0x47101f(0x207)]['lineTo'](_0x121a2f[0x0],_0x121a2f[0x1]);}this['canvasContext']['stroke']();}}['_tomap'](_0xb55f6d,_0x1d85a1,_0x5acd69){const _0x24da00=_0x39bfda,_0x3cf52f=Cesium[_0x24da00(0x2c7)]['fromDegrees'](_0xb55f6d,_0x1d85a1,this['fixedHeight']),_0x1b7fe8=this[_0x24da00(0x2aa)]['scene'];if(_0x1b7fe8['mode']===Cesium['SceneMode'][_0x24da00(0x2dd)]){const _0x9a9b32=new Cesium['EllipsoidalOccluder'](_0x1b7fe8['globe']['ellipsoid'],_0x1b7fe8['camera']['positionWC']),_0x21ad23=_0x9a9b32['isPointVisible'](_0x3cf52f);if(!_0x21ad23)return _0x5acd69['age']=0x0,null;}const _0x3a0ee6=Cesium[_0x24da00(0x279)][_0x24da00(0x28d)](this['_map'][_0x24da00(0x241)],_0x3cf52f);return _0x3a0ee6?[_0x3a0ee6['x'],_0x3a0ee6['y']]:null;}['clear'](){const _0x25adb7=_0x39bfda;this[_0x25adb7(0x1fa)]['clear'](),delete this['windData'];}['initWorker'](){const _0xd28a14=_0x39bfda;this['worker']=new Worker(this[_0xd28a14(0x211)]['worker']),this['worker']['onmessage']=_0x1a4717=>{const _0x3f4810=_0xd28a14;this[_0x3f4810(0x248)](_0x1a4717['data']['particles']),this[_0x3f4810(0x2ce)]=![];},this['windField']={'init':_0xd589c4=>{const _0x55ed3=_0xd28a14;this['worker'][_0x55ed3(0x24d)]({'type':'init','options':_0xd589c4});},'setOptions':_0x30517e=>{this['worker']['postMessage']({'type':'setOptions','options':_0x30517e});},'setDate':_0x4522c3=>{this['worker']['postMessage']({'type':'setDate','data':_0x4522c3});},'update':()=>{const _0x438015=_0xd28a14;if(this['_updateIng2'])return;this['_updateIng2']=!![],this['worker'][_0x438015(0x24d)]({'type':'update'});},'clear':()=>{this['worker']['postMessage']({'type':'clear'});}},this['windField']['init'](this['options']);}}mars3d__namespace[_0x39bfda(0x2df)][_0x39bfda(0x278)](_0x39bfda(0x271),CanvasWindLayer),mars3d__namespace['layer'][_0x39bfda(0x299)]=CanvasWindLayer,mars3d__namespace[_0x39bfda(0x29f)]=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports['CanvasWindField']=CanvasWindField,exports[_0x39bfda(0x299)]=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object['defineProperty'](exports,_0x39bfda(0x26b),{'value':!![]});
}));
