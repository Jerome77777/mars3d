/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.6.9
 * 编译日期：2023-10-17 20:06:08
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x44fff8=_0x1681;(function(_0x3a2544,_0x564533){const _0x11f369=_0x1681,_0x3c7846=_0x3a2544();while(!![]){try{const _0x29cdc5=-parseInt(_0x11f369(0x168))/0x1+-parseInt(_0x11f369(0x149))/0x2+parseInt(_0x11f369(0x1db))/0x3*(-parseInt(_0x11f369(0x19f))/0x4)+-parseInt(_0x11f369(0x10e))/0x5+parseInt(_0x11f369(0x145))/0x6*(parseInt(_0x11f369(0x116))/0x7)+parseInt(_0x11f369(0x199))/0x8+parseInt(_0x11f369(0x174))/0x9*(parseInt(_0x11f369(0x1cf))/0xa);if(_0x29cdc5===_0x564533)break;else _0x3c7846['push'](_0x3c7846['shift']());}catch(_0x48ae3e){_0x3c7846['push'](_0x3c7846['shift']());}}}(_0x1a4e,0x28421));function _interopNamespace(_0x34d3ca){if(_0x34d3ca&&_0x34d3ca['__esModule'])return _0x34d3ca;var _0x29c3bf=Object['create'](null);return _0x34d3ca&&Object['keys'](_0x34d3ca)['forEach'](function(_0x54eb76){const _0x1e05c6=_0x1681;if(_0x54eb76!=='default'){var _0x5b556c=Object['getOwnPropertyDescriptor'](_0x34d3ca,_0x54eb76);Object['defineProperty'](_0x29c3bf,_0x54eb76,_0x5b556c[_0x1e05c6(0x186)]?_0x5b556c:{'enumerable':!![],'get':function(){return _0x34d3ca[_0x54eb76];}});}}),_0x29c3bf['default']=_0x34d3ca,_0x29c3bf;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace[_0x44fff8(0x122)];function getU(_0x374df6,_0x358649){const _0x16827f=_0x44fff8,_0x546d91=_0x374df6*Math[_0x16827f(0x118)](Cesium$7['Math']['toRadians'](_0x358649));return _0x546d91;}function _0x1a4e(){const _0x17698c=['uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a','commandList','nextParticlesSpeed','array','create','layer','lng','off','none','east','postProcessingPosition','_onMouseUpEvent','maxAge','framebuffers','ZERO','maxParticles','speedRate','xmax','particlesTextureSize','particleSystem','drawingBufferWidth','windTextures','bindEvent','auto','dropRateBump','container','3252pTzVVg','_drawLines','dropRate','clientHeight','4482GHpbFI','toRadians','particlesWind','ColorRamp','Framebuffer','hidden','fromGeometry','mouseMove','getExtent','attributeLocations','add','_maxAge','random','vertexShaderSource','updateSpeed','floor','show','redraw','forEach','_randomParticle','color','fixedHeight','nextTrails','SceneMode','umin','CanvasWindField','ShaderSource','//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a','register','PrimitiveType','latRange','228370GefGiO','STATIC_DRAW','log','_onMouseMoveEvent','createCommand','UNSIGNED_INT','_colorRamp','viewerParameters','mouse_move','wheel','getOptions','lat','2736cktTeG','toDegrees','fadeOpacity','mod','globe','NEAREST','options','nextTrailsDepth','RenderState','particlesComputing','colors','screen','canrefresh','destroy','PixelFormat','_calcUV','Sampler','particlesRendering','get','visibility','reverseY','width','createTexture','destroyObject','canvasWidth','vertexArray','rawRenderState','trails','EventType','PixelDatatype','defined','animateFrame','bind','TWO_PI','tlat','isInExtent','ComponentDatatype','1649664OqbmRZ','DEPTH_COMPONENT','FLOAT','autoClear','_onMapWhellEvent','OPAQUE','752vvMNIh','framebuffer','_map','currentParticlesPosition','refreshTimer','_createCanvas','textures','min','canvas','dimensions','Cartesian3','fromCache','red','north','Color','currentParticlesSpeed','particleHeight','PI_OVER_THREE','Draw','primitives','depthTexture','BoundingSphere','getWind','commandToExecute','mouseHidden','clearCommand','_pointerEvents','getUVByXY','mode','levmin','particlesNumber','removeAll','particlesTextures','createParticlesTextures','tlng','_addedHook','frameTime','Math','max','sin','_mountedHook','cols','THREE_PI_OVER_TWO','steps','mouseDown','clientWidth','setOptions','ymax','10630bpLZPn','Pass','ymin','xmin','getColor','preRender','getRandomLatLng','createRawRenderState','_bilinearInterpolation','_removedHook','context','uniformMap','3126kjZhzH','WindUtil','push','style','getPixelSize','nextParticlesPosition','TRIANGLES','lineWidth','getFullscreenQuad','getParticles','getContext','clear','LayerUtil','_onMap_preRenderEvent','in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a','SceneTransforms','keys','pointerEvents','_onMouseDownEvent','_speedRate','camera','VertexArray','fragmentShaderSource','DrawCommand','resize','beginPath','_calc_speedRate','rgb(206,255,255)','0px','pow','DISABLE_LOG_DEPTH_FRAGMENT_WRITE','currentTrails','postProcessingSpeed','_tomap','createRenderingFramebuffers','setData','worker','mouse_down','_data','grid','_updateIng','44790hMLifW','drawingBufferHeight','GeometryAttributes','outputTexture','mouseUp','globeBoundingSphere','particles','scene','917lPnrdc','segmentsColor','cos','canvasContext','ClearCommand','vdata','segmentsDepth','windField','GeometryAttribute','data','RGBA','height','Cesium','fill','Compute','createRenderingPrimitives','createComputingPrimitives','rows','clampToLatitudeRange','lon','_setOptionsHook'];_0x1a4e=function(){return _0x17698c;};return _0x1a4e();}function getV(_0x222b60,_0x50d270){const _0x2dd958=_0x44fff8,_0x48aa8e=_0x222b60*Math[_0x2dd958(0x1c6)](Cesium$7['Math'][_0x2dd958(0x14a)](_0x50d270));return _0x48aa8e;}function getSpeed(_0x57391a,_0x36cbb9){const _0x51a62f=_0x44fff8,_0x94b631=Math['sqrt'](Math['pow'](_0x57391a,0x2)+Math[_0x51a62f(0x1f8)](_0x36cbb9,0x2));return _0x94b631;}function getDirection(_0x10cc20,_0x4e004d){let _0x18c930=Cesium$7['Math']['toDegrees'](Math['atan2'](_0x4e004d,_0x10cc20));return _0x18c930+=_0x18c930<0x0?0x168:0x0,_0x18c930;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace[_0x44fff8(0x122)];class CustomPrimitive{constructor(_0x4a4418){const _0x26eb7b=_0x44fff8;this['commandType']=_0x4a4418['commandType'],this['geometry']=_0x4a4418['geometry'],this['attributeLocations']=_0x4a4418['attributeLocations'],this['primitiveType']=_0x4a4418['primitiveType'],this['uniformMap']=_0x4a4418['uniformMap'],this['vertexShaderSource']=_0x4a4418['vertexShaderSource'],this['fragmentShaderSource']=_0x4a4418[_0x26eb7b(0x1f1)],this['rawRenderState']=_0x4a4418['rawRenderState'],this['framebuffer']=_0x4a4418[_0x26eb7b(0x1a0)],this['outputTexture']=_0x4a4418['outputTexture'],this['autoClear']=_0x4a4418['autoClear']??![],this['preExecute']=_0x4a4418['preExecute'],this['show']=!![],this['commandToExecute']=undefined,this['clearCommand']=undefined,this[_0x26eb7b(0x19c)]&&(this['clearCommand']=new Cesium$6[(_0x26eb7b(0x11a))]({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this[_0x26eb7b(0x1a0)],'pass':Cesium$6['Pass'][_0x26eb7b(0x19e)]}));}['createCommand'](_0x412ba5){const _0x579aca=_0x44fff8;switch(this['commandType']){case'Draw':{const _0x5727c0=Cesium$6[_0x579aca(0x1f0)][_0x579aca(0x14f)]({'context':_0x412ba5,'geometry':this['geometry'],'attributeLocations':this[_0x579aca(0x152)],'bufferUsage':Cesium$6['BufferUsage'][_0x579aca(0x169)]}),_0x5a1b38=Cesium$6['ShaderProgram'][_0x579aca(0x1aa)]({'context':_0x412ba5,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this[_0x579aca(0x156)],'fragmentShaderSource':this['fragmentShaderSource']}),_0x174ce4=Cesium$6[_0x579aca(0x17c)]['fromCache'](this[_0x579aca(0x18e)]);return new Cesium$6[(_0x579aca(0x1f2))]({'primitiveType':this['primitiveType'],'shaderProgram':_0x5a1b38,'vertexArray':_0x5727c0,'modelMatrix':Cesium$6['Matrix4']['IDENTITY'],'renderState':_0x174ce4,'uniformMap':this[_0x579aca(0x1da)],'castShadows':![],'receiveShadows':![],'framebuffer':this[_0x579aca(0x1a0)],'pass':Cesium$6['Pass'][_0x579aca(0x19e)],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}['setGeometry'](_0x853427,_0x13805a){const _0x40b7d7=_0x44fff8;this['geometry']=_0x13805a;const _0x5e14a8=Cesium$6['VertexArray']['fromGeometry']({'context':_0x853427,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']});this['commandToExecute'][_0x40b7d7(0x18d)]=_0x5e14a8;}['update'](_0x11b1f8){const _0x30a2ba=_0x44fff8;if(!this[_0x30a2ba(0x159)])return;if(_0x11b1f8[_0x30a2ba(0x1bb)]!==Cesium$6[_0x30a2ba(0x160)]['SCENE3D'])return;!Cesium$6[_0x30a2ba(0x192)](this['commandToExecute'])&&(this['commandToExecute']=this[_0x30a2ba(0x16c)](_0x11b1f8['context'])),Cesium$6['defined'](this['preExecute'])&&this['preExecute'](),Cesium$6[_0x30a2ba(0x192)](this['clearCommand'])&&_0x11b1f8['commandList']['push'](this['clearCommand']),_0x11b1f8[_0x30a2ba(0x12c)]['push'](this['commandToExecute']);}['isDestroyed'](){return![];}['destroy'](){const _0x2a0d9e=_0x44fff8;if(this['clearCommand']){var _0x4725b7,_0x5153d1;(_0x4725b7=this[_0x2a0d9e(0x1b8)])!==null&&_0x4725b7!==void 0x0&&_0x4725b7['vertexArray']&&this['clearCommand'][_0x2a0d9e(0x18d)]['destroy'](),(_0x5153d1=this['clearCommand'])!==null&&_0x5153d1!==void 0x0&&_0x5153d1['shaderProgram']&&this[_0x2a0d9e(0x1b8)]['shaderProgram']['destroy'](),delete this['clearCommand'];}return this['commandToExecute']&&(this['commandToExecute']['vertexArray']&&this[_0x2a0d9e(0x1b6)]['vertexArray']['destroy'](),this['commandToExecute']['shaderProgram']&&this['commandToExecute']['shaderProgram']['destroy'](),delete this['commandToExecute']),Cesium$6[_0x2a0d9e(0x18b)](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0x397359=function(){const _0x1d4cc1=_0x1681,_0x5adf92=new Cesium$5['Geometry']({'attributes':new Cesium$5[(_0x1d4cc1(0x110))]({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5[_0x1d4cc1(0x198)]['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x5adf92;},_0x3ab377=function(_0x1cd84d,_0x30f271){if(Cesium$5['defined'](_0x30f271)){const _0x325977={};_0x325977['arrayBufferView']=_0x30f271,_0x1cd84d['source']=_0x325977;}const _0x28444a=new Cesium$5['Texture'](_0x1cd84d);return _0x28444a;},_0x723dfa=function(_0x24bfda,_0x2c29f7,_0x23b40c){const _0x549bbb=_0x1681,_0x311b2f=new Cesium$5[(_0x549bbb(0x14d))]({'context':_0x24bfda,'colorTextures':[_0x2c29f7],'depthTexture':_0x23b40c});return _0x311b2f;},_0x3a7340=function(_0x2ee051){const _0x399bed=!![],_0x656f0e=![],_0x2dc06c={'viewport':_0x2ee051['viewport'],'depthTest':_0x2ee051['depthTest'],'depthMask':_0x2ee051['depthMask'],'blending':_0x2ee051['blending']},_0x4e684f=Cesium$5['Appearance']['getDefaultRenderState'](_0x399bed,_0x656f0e,_0x2dc06c);return _0x4e684f;},_0x2933a1=function(_0x1201eb){const _0x364a1c=_0x1681,_0x39aac2={},_0x4ca167=Cesium$5['Math'][_0x364a1c(0x177)](_0x1201eb['west'],Cesium$5['Math'][_0x364a1c(0x195)]),_0x53aae5=Cesium$5['Math']['mod'](_0x1201eb[_0x364a1c(0x134)],Cesium$5[_0x364a1c(0x1c4)][_0x364a1c(0x195)]),_0x36af5b=_0x1201eb['width'];let _0xbfa05e,_0x1fd1a6;_0x36af5b>Cesium$5[_0x364a1c(0x1c4)][_0x364a1c(0x1c9)]?(_0xbfa05e=0x0,_0x1fd1a6=Cesium$5['Math'][_0x364a1c(0x195)]):_0x53aae5-_0x4ca167<_0x36af5b?(_0xbfa05e=_0x4ca167,_0x1fd1a6=_0x4ca167+_0x36af5b):(_0xbfa05e=_0x4ca167,_0x1fd1a6=_0x53aae5);_0x39aac2['lon']={'min':Cesium$5['Math'][_0x364a1c(0x175)](_0xbfa05e),'max':Cesium$5['Math']['toDegrees'](_0x1fd1a6)};const _0x410d84=_0x1201eb['south'],_0x50df6f=_0x1201eb[_0x364a1c(0x1ac)],_0x197f28=_0x1201eb['height'],_0x443893=_0x197f28>Cesium$5['Math']['PI']/0xc?_0x197f28/0x2:0x0;let _0x3fa2a5=Cesium$5[_0x364a1c(0x1c4)][_0x364a1c(0x128)](_0x410d84-_0x443893),_0x226e67=Cesium$5['Math']['clampToLatitudeRange'](_0x50df6f+_0x443893);return _0x3fa2a5<-Cesium$5['Math'][_0x364a1c(0x1b0)]&&(_0x3fa2a5=-Cesium$5['Math']['PI_OVER_TWO']),_0x226e67>Cesium$5[_0x364a1c(0x1c4)]['PI_OVER_THREE']&&(_0x226e67=Cesium$5['Math']['PI_OVER_TWO']),_0x39aac2[_0x364a1c(0x173)]={'min':Cesium$5[_0x364a1c(0x1c4)][_0x364a1c(0x175)](_0x3fa2a5),'max':Cesium$5[_0x364a1c(0x1c4)]['toDegrees'](_0x226e67)},_0x39aac2;};return{'getFullscreenQuad':_0x397359,'createTexture':_0x3ab377,'createFramebuffer':_0x723dfa,'createRawRenderState':_0x3a7340,'viewRectangleToLonLatRange':_0x2933a1};}());var segmentDraw_vert=_0x44fff8(0x1e9),segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag=_0x44fff8(0x12b),screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace['Cesium'];class ParticlesRendering{constructor(_0x2e0f6b,_0x450b47,_0x32dc11,_0x2a162a,_0x3eb9aa){this['createRenderingTextures'](_0x2e0f6b,_0x450b47,_0x32dc11['colors']),this['createRenderingFramebuffers'](_0x2e0f6b),this['createRenderingPrimitives'](_0x2e0f6b,_0x32dc11,_0x2a162a,_0x3eb9aa);}['createRenderingTextures'](_0x1a914f,_0x557cea,_0x2770fd){const _0x4ba78a=_0x44fff8,_0x1c0981={'context':_0x1a914f,'width':_0x1a914f[_0x4ba78a(0x13f)],'height':_0x1a914f['drawingBufferHeight'],'pixelFormat':Cesium$4[_0x4ba78a(0x182)][_0x4ba78a(0x120)],'pixelDatatype':Cesium$4[_0x4ba78a(0x191)]['UNSIGNED_BYTE']},_0x195e30={'context':_0x1a914f,'width':_0x1a914f['drawingBufferWidth'],'height':_0x1a914f['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat'][_0x4ba78a(0x19a)],'pixelDatatype':Cesium$4[_0x4ba78a(0x191)][_0x4ba78a(0x16d)]},_0x1ccb1d=_0x2770fd['length'],_0x21f71c=new Float32Array(_0x1ccb1d*0x3);for(let _0x136771=0x0;_0x136771<_0x1ccb1d;_0x136771++){const _0x2ff1e3=Cesium$4['Color']['fromCssColorString'](_0x2770fd[_0x136771]);_0x21f71c[0x3*_0x136771]=_0x2ff1e3[_0x4ba78a(0x1ab)],_0x21f71c[0x3*_0x136771+0x1]=_0x2ff1e3['green'],_0x21f71c[0x3*_0x136771+0x2]=_0x2ff1e3['blue'];}const _0x95c816={'context':_0x1a914f,'width':_0x1ccb1d,'height':0x1,'pixelFormat':Cesium$4['PixelFormat']['RGB'],'pixelDatatype':Cesium$4['PixelDatatype']['FLOAT'],'sampler':new Cesium$4[(_0x4ba78a(0x184))]({'minificationFilter':Cesium$4['TextureMinificationFilter']['LINEAR'],'magnificationFilter':Cesium$4['TextureMagnificationFilter']['LINEAR']})};this[_0x4ba78a(0x1a5)]={'segmentsColor':Util['createTexture'](_0x1c0981),'segmentsDepth':Util[_0x4ba78a(0x18a)](_0x195e30),'currentTrailsColor':Util['createTexture'](_0x1c0981),'currentTrailsDepth':Util[_0x4ba78a(0x18a)](_0x195e30),'nextTrailsColor':Util['createTexture'](_0x1c0981),'nextTrailsDepth':Util['createTexture'](_0x195e30),'colorTable':Util['createTexture'](_0x95c816,_0x21f71c)};}[_0x44fff8(0x1fd)](_0x129055){const _0x452cde=_0x44fff8;this['framebuffers']={'segments':Util['createFramebuffer'](_0x129055,this['textures']['segmentsColor'],this['textures']['segmentsDepth']),'currentTrails':Util['createFramebuffer'](_0x129055,this['textures']['currentTrailsColor'],this['textures']['currentTrailsDepth']),'nextTrails':Util['createFramebuffer'](_0x129055,this['textures']['nextTrailsColor'],this['textures'][_0x452cde(0x17b)])};}['createSegmentsGeometry'](_0x175dff){const _0x5a5985=_0x44fff8,_0x5371c4=0x4;let _0x2d2b8d=[];for(let _0x2025d9=0x0;_0x2025d9<_0x175dff['particlesTextureSize'];_0x2025d9++){for(let _0x232998=0x0;_0x232998<_0x175dff['particlesTextureSize'];_0x232998++){for(let _0x162cc4=0x0;_0x162cc4<_0x5371c4;_0x162cc4++){_0x2d2b8d['push'](_0x2025d9/_0x175dff[_0x5a5985(0x13d)]),_0x2d2b8d['push'](_0x232998/_0x175dff['particlesTextureSize']);}}}_0x2d2b8d=new Float32Array(_0x2d2b8d);let _0x5e5fd4=[];const _0x19bd47=[-0x1,0x1],_0x294073=[-0x1,0x1];for(let _0x18fa47=0x0;_0x18fa47<_0x175dff['maxParticles'];_0x18fa47++){for(let _0x15ed72=0x0;_0x15ed72<_0x5371c4/0x2;_0x15ed72++){for(let _0x57ca72=0x0;_0x57ca72<_0x5371c4/0x2;_0x57ca72++){_0x5e5fd4['push'](_0x19bd47[_0x15ed72]),_0x5e5fd4['push'](_0x294073[_0x57ca72]),_0x5e5fd4['push'](0x0);}}}_0x5e5fd4=new Float32Array(_0x5e5fd4);const _0x21181d=0x6*_0x175dff[_0x5a5985(0x13a)],_0x277daf=new Uint32Array(_0x21181d);for(let _0x2e7fe2=0x0,_0x2a6937=0x0,_0xc7162b=0x0;_0x2e7fe2<_0x175dff[_0x5a5985(0x13a)];_0x2e7fe2++){_0x277daf[_0x2a6937++]=_0xc7162b+0x0,_0x277daf[_0x2a6937++]=_0xc7162b+0x1,_0x277daf[_0x2a6937++]=_0xc7162b+0x2,_0x277daf[_0x2a6937++]=_0xc7162b+0x2,_0x277daf[_0x2a6937++]=_0xc7162b+0x1,_0x277daf[_0x2a6937++]=_0xc7162b+0x3,_0xc7162b+=0x4;}const _0x356646=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4[_0x5a5985(0x198)]['FLOAT'],'componentsPerAttribute':0x2,'values':_0x2d2b8d}),'normal':new Cesium$4[(_0x5a5985(0x11e))]({'componentDatatype':Cesium$4[_0x5a5985(0x198)][_0x5a5985(0x19b)],'componentsPerAttribute':0x3,'values':_0x5e5fd4})}),'indices':_0x277daf});return _0x356646;}[_0x44fff8(0x125)](_0x1f172d,_0x4b2312,_0x341449,_0x33fd90){const _0x3e9419=_0x44fff8,_0xb628f3=this;this['primitives']={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x4b2312),'primitiveType':Cesium$4['PrimitiveType'][_0x3e9419(0x1e1)],'uniformMap':{'currentParticlesPosition':function(){return _0x33fd90['particlesTextures']['currentParticlesPosition'];},'postProcessingPosition':function(){const _0x10bfe2=_0x3e9419;return _0x33fd90['particlesTextures'][_0x10bfe2(0x135)];},'postProcessingSpeed':function(){const _0x43890b=_0x3e9419;return _0x33fd90['particlesTextures'][_0x43890b(0x1fb)];},'colorTable':function(){return _0xb628f3['textures']['colorTable'];},'aspect':function(){const _0x101f1f=_0x3e9419;return _0x1f172d[_0x101f1f(0x13f)]/_0x1f172d[_0x101f1f(0x10f)];},'pixelSize':function(){return _0x341449['pixelSize'];},'lineWidth':function(){return _0x4b2312['lineWidth'];},'particleHeight':function(){const _0x1df19a=_0x3e9419;return _0x4b2312[_0x1df19a(0x1af)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util[_0x3e9419(0x1d6)]({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers']['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':_0x3e9419(0x1b1),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util[_0x3e9419(0x1e3)](),'primitiveType':Cesium$4[_0x3e9419(0x166)]['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){const _0x459050=_0x3e9419;return _0xb628f3['textures'][_0x459050(0x117)];},'segmentsDepthTexture':function(){const _0x3ce89d=_0x3e9419;return _0xb628f3['textures'][_0x3ce89d(0x11c)];},'currentTrailsColor':function(){const _0x1eed96=_0x3e9419;return _0xb628f3['framebuffers'][_0x1eed96(0x1fa)]['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x4a221b=_0x3e9419;return _0xb628f3[_0x4a221b(0x138)]['currentTrails'][_0x4a221b(0x1b3)];},'fadeOpacity':function(){const _0x18dde2=_0x3e9419;return _0x4b2312[_0x18dde2(0x176)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x3e9419(0x1f9)],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this[_0x3e9419(0x138)]['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x3dbbb3=_0x3e9419,_0x656fef=_0xb628f3[_0x3dbbb3(0x138)]['currentTrails'];_0xb628f3['framebuffers']['currentTrails']=_0xb628f3['framebuffers']['nextTrails'],_0xb628f3['framebuffers']['nextTrails']=_0x656fef,_0xb628f3['primitives'][_0x3dbbb3(0x18f)]['commandToExecute']['framebuffer']=_0xb628f3[_0x3dbbb3(0x138)][_0x3dbbb3(0x15f)],_0xb628f3['primitives']['trails']['clearCommand'][_0x3dbbb3(0x1a0)]=_0xb628f3[_0x3dbbb3(0x138)]['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':_0x3e9419(0x1b1),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'trailsColorTexture':function(){const _0x119b64=_0x3e9419;return _0xb628f3[_0x119b64(0x138)]['nextTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){return _0xb628f3['framebuffers']['nextTrails']['depthTexture'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x3e9419(0x1f9)],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag=_0x44fff8(0x164),updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace['Cesium'];class ParticlesComputing{constructor(_0x63d1d6,_0x5648aa,_0x1544c9,_0x405071){const _0x3b5132=_0x44fff8;this[_0x3b5132(0x11f)]=_0x5648aa,this['createWindTextures'](_0x63d1d6,_0x5648aa),this[_0x3b5132(0x1c0)](_0x63d1d6,_0x1544c9,_0x405071),this[_0x3b5132(0x126)](_0x5648aa,_0x1544c9,_0x405071);}['createWindTextures'](_0x29c906,_0x14d9ff){const _0x599f86=_0x44fff8,_0xb9d5f2={'context':_0x29c906,'width':_0x14d9ff['dimensions']['lon'],'height':_0x14d9ff[_0x599f86(0x1a8)]['lat']*(_0x14d9ff[_0x599f86(0x1a8)]['lev']||0x1),'pixelFormat':Cesium$3[_0x599f86(0x182)]['LUMINANCE'],'pixelDatatype':Cesium$3['PixelDatatype'][_0x599f86(0x19b)],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter'][_0x599f86(0x179)],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})};this['windTextures']={'U':Util['createTexture'](_0xb9d5f2,_0x14d9ff['U'][_0x599f86(0x12e)]),'V':Util[_0x599f86(0x18a)](_0xb9d5f2,_0x14d9ff['V']['array'])};}[_0x44fff8(0x1c0)](_0x209112,_0x54013f,_0x57028f){const _0x4b2444=_0x44fff8,_0x4c89a0={'context':_0x209112,'width':_0x54013f['particlesTextureSize'],'height':_0x54013f['particlesTextureSize'],'pixelFormat':Cesium$3[_0x4b2444(0x182)]['RGBA'],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter'][_0x4b2444(0x179)],'magnificationFilter':Cesium$3['TextureMagnificationFilter'][_0x4b2444(0x179)]})},_0x2bd370=this['randomizeParticles'](_0x54013f['maxParticles'],_0x57028f),_0xcc712b=new Float32Array(0x4*_0x54013f['maxParticles'])[_0x4b2444(0x123)](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x4c89a0),'currentParticlesPosition':Util['createTexture'](_0x4c89a0,_0x2bd370),'nextParticlesPosition':Util['createTexture'](_0x4c89a0,_0x2bd370),'currentParticlesSpeed':Util[_0x4b2444(0x18a)](_0x4c89a0,_0xcc712b),'nextParticlesSpeed':Util['createTexture'](_0x4c89a0,_0xcc712b),'postProcessingPosition':Util['createTexture'](_0x4c89a0,_0x2bd370),'postProcessingSpeed':Util['createTexture'](_0x4c89a0,_0xcc712b)};}['randomizeParticles'](_0x5cb4e6,_0x105fc8){const _0x21d191=_0x44fff8,_0x4b0ff7=new Float32Array(0x4*_0x5cb4e6);for(let _0x245783=0x0;_0x245783<_0x5cb4e6;_0x245783++){_0x4b0ff7[0x4*_0x245783]=Cesium$3[_0x21d191(0x1c4)]['randomBetween'](_0x105fc8['lonRange']['x'],_0x105fc8['lonRange']['y']),_0x4b0ff7[0x4*_0x245783+0x1]=Cesium$3[_0x21d191(0x1c4)]['randomBetween'](_0x105fc8['latRange']['x'],_0x105fc8['latRange']['y']),_0x4b0ff7[0x4*_0x245783+0x2]=Cesium$3['Math']['randomBetween'](this['data']['lev'][_0x21d191(0x1a6)],this['data']['lev']['max']),_0x4b0ff7[0x4*_0x245783+0x3]=0x0;}return _0x4b0ff7;}['destroyParticlesTextures'](){Object['keys'](this['particlesTextures'])['forEach'](_0x532b78=>{const _0x29ab6b=_0x1681;this['particlesTextures'][_0x532b78][_0x29ab6b(0x181)]();});}[_0x44fff8(0x126)](_0x1f2b1b,_0x171070,_0x2cde1e){const _0x41330f=_0x44fff8,_0x472a85=new Cesium$3['Cartesian3'](_0x1f2b1b['dimensions']['lon'],_0x1f2b1b['dimensions']['lat'],_0x1f2b1b[_0x41330f(0x1a8)]['lev']),_0x2681bb=new Cesium$3[(_0x41330f(0x1a9))](_0x1f2b1b['lon']['min'],_0x1f2b1b[_0x41330f(0x173)][_0x41330f(0x1a6)],_0x1f2b1b['lev']['min']),_0x4cb883=new Cesium$3['Cartesian3'](_0x1f2b1b['lon'][_0x41330f(0x1c5)],_0x1f2b1b[_0x41330f(0x173)]['max'],_0x1f2b1b['lev'][_0x41330f(0x1c5)]),_0x51c5d4=new Cesium$3[(_0x41330f(0x1a9))]((_0x4cb883['x']-_0x2681bb['x'])/(_0x472a85['x']-0x1),(_0x4cb883['y']-_0x2681bb['y'])/(_0x472a85['y']-0x1),_0x472a85['z']>0x1?(_0x4cb883['z']-_0x2681bb['z'])/(_0x472a85['z']-0x1):0x1),_0x2c462d=new Cesium$3['Cartesian2'](_0x1f2b1b['U']['min'],_0x1f2b1b['U']['max']),_0x521f5e=new Cesium$3['Cartesian2'](_0x1f2b1b['V']['min'],_0x1f2b1b['V']['max']),_0xed8d90=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){return _0xed8d90['windTextures']['U'];},'V':function(){const _0x36311c=_0x41330f;return _0xed8d90[_0x36311c(0x140)]['V'];},'currentParticlesPosition':function(){const _0x3f3d54=_0x41330f;return _0xed8d90['particlesTextures'][_0x3f3d54(0x1a2)];},'dimension':function(){return _0x472a85;},'minimum':function(){return _0x2681bb;},'maximum':function(){return _0x4cb883;},'interval':function(){return _0x51c5d4;}},'fragmentShaderSource':new Cesium$3[(_0x41330f(0x163))]({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures'][_0x41330f(0x14b)],'preExecute':function(){const _0x177423=_0x41330f;_0xed8d90['primitives'][_0x177423(0x1b5)]['commandToExecute'][_0x177423(0x111)]=_0xed8d90['particlesTextures']['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){const _0xe4adf3=_0x41330f;return _0xed8d90[_0xe4adf3(0x1bf)][_0xe4adf3(0x1ae)];},'particlesWind':function(){return _0xed8d90['particlesTextures']['particlesWind'];},'uSpeedRange':function(){return _0x2c462d;},'vSpeedRange':function(){return _0x521f5e;},'pixelSize':function(){return _0x2cde1e['pixelSize'];},'speedFactor':function(){return _0x171070['speedFactor'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures'][_0x41330f(0x12d)],'preExecute':function(){const _0x41e202=_0x41330f,_0x42ce2b=_0xed8d90[_0x41e202(0x1bf)]['currentParticlesSpeed'];_0xed8d90['particlesTextures']['currentParticlesSpeed']=_0xed8d90[_0x41e202(0x1bf)][_0x41e202(0x1fb)],_0xed8d90[_0x41e202(0x1bf)]['postProcessingSpeed']=_0x42ce2b,_0xed8d90[_0x41e202(0x1b2)][_0x41e202(0x157)]['commandToExecute'][_0x41e202(0x111)]=_0xed8d90['particlesTextures'][_0x41e202(0x12d)];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){const _0xfe97f0=_0x41330f;return _0xed8d90[_0xfe97f0(0x1bf)][_0xfe97f0(0x1a2)];},'currentParticlesSpeed':function(){return _0xed8d90['particlesTextures']['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3[(_0x41330f(0x163))]({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures'][_0x41330f(0x1e0)],'preExecute':function(){const _0xf8c4bc=_0x41330f,_0x3c8a8f=_0xed8d90[_0xf8c4bc(0x1bf)]['currentParticlesPosition'];_0xed8d90[_0xf8c4bc(0x1bf)][_0xf8c4bc(0x1a2)]=_0xed8d90['particlesTextures'][_0xf8c4bc(0x135)],_0xed8d90['particlesTextures'][_0xf8c4bc(0x135)]=_0x3c8a8f,_0xed8d90['primitives']['updatePosition']['commandToExecute']['outputTexture']=_0xed8d90['particlesTextures'][_0xf8c4bc(0x1e0)];}}),'postProcessingPosition':new CustomPrimitive({'commandType':_0x41330f(0x124),'uniformMap':{'nextParticlesPosition':function(){const _0x2e4b55=_0x41330f;return _0xed8d90['particlesTextures'][_0x2e4b55(0x1e0)];},'nextParticlesSpeed':function(){const _0x3197e0=_0x41330f;return _0xed8d90['particlesTextures'][_0x3197e0(0x12d)];},'lonRange':function(){return _0x2cde1e['lonRange'];},'latRange':function(){return _0x2cde1e['latRange'];},'randomCoefficient':function(){const _0x14956b=_0x41330f,_0x348c5f=Math[_0x14956b(0x155)]();return _0x348c5f;},'dropRate':function(){return _0x171070['dropRate'];},'dropRateBump':function(){const _0x438bce=_0x41330f;return _0x171070[_0x438bce(0x143)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingPosition_frag]}),'outputTexture':this[_0x41330f(0x1bf)]['postProcessingPosition'],'preExecute':function(){const _0x1f225b=_0x41330f;_0xed8d90['primitives']['postProcessingPosition'][_0x1f225b(0x1b6)]['outputTexture']=_0xed8d90['particlesTextures']['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':_0x41330f(0x124),'uniformMap':{'postProcessingPosition':function(){return _0xed8d90['particlesTextures']['postProcessingPosition'];},'nextParticlesSpeed':function(){return _0xed8d90['particlesTextures']['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3[(_0x41330f(0x163))]({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function(){const _0x4d6db3=_0x41330f;_0xed8d90['primitives']['postProcessingSpeed']['commandToExecute'][_0x4d6db3(0x111)]=_0xed8d90[_0x4d6db3(0x1bf)]['postProcessingSpeed'];}})};}}function _0x1681(_0x51b267,_0x310b51){const _0x1a4e84=_0x1a4e();return _0x1681=function(_0x168111,_0x245e9e){_0x168111=_0x168111-0x108;let _0x18158e=_0x1a4e84[_0x168111];return _0x18158e;},_0x1681(_0x51b267,_0x310b51);}const Cesium$2=mars3d__namespace[_0x44fff8(0x122)];class ParticleSystem{constructor(_0x5df588,_0x3e79f6,_0x4b1f17,_0x58e196){const _0x440259=_0x44fff8;this['context']=_0x5df588,_0x3e79f6={..._0x3e79f6},_0x3e79f6['udata']&&_0x3e79f6['vdata']&&(_0x3e79f6['dimensions']={},_0x3e79f6[_0x440259(0x1a8)]['lon']=_0x3e79f6[_0x440259(0x1c8)],_0x3e79f6['dimensions']['lat']=_0x3e79f6['rows'],_0x3e79f6['dimensions']['lev']=_0x3e79f6['lev']||0x1,_0x3e79f6['lon']={},_0x3e79f6['lon']['min']=_0x3e79f6['xmin'],_0x3e79f6['lon']['max']=_0x3e79f6['xmax'],_0x3e79f6['lat']={},_0x3e79f6[_0x440259(0x173)]['min']=_0x3e79f6['ymin'],_0x3e79f6['lat']['max']=_0x3e79f6['ymax'],_0x3e79f6['lev']={},_0x3e79f6['lev']['min']=_0x3e79f6[_0x440259(0x1bc)]??0x1,_0x3e79f6['lev']['max']=_0x3e79f6['levmax']??0x1,_0x3e79f6['U']={},_0x3e79f6['U']['array']=new Float32Array(_0x3e79f6['udata']),_0x3e79f6['U']['min']=_0x3e79f6[_0x440259(0x161)]??Math['min'](..._0x3e79f6['udata']),_0x3e79f6['U']['max']=_0x3e79f6['umax']??Math['max'](..._0x3e79f6['udata']),_0x3e79f6['V']={},_0x3e79f6['V'][_0x440259(0x12e)]=new Float32Array(_0x3e79f6[_0x440259(0x11b)]),_0x3e79f6['V']['min']=_0x3e79f6['vmin']??Math['min'](..._0x3e79f6['vdata']),_0x3e79f6['V']['max']=_0x3e79f6['vmax']??Math['max'](..._0x3e79f6['vdata'])),this[_0x440259(0x11f)]=_0x3e79f6,this['options']=_0x4b1f17,this[_0x440259(0x16f)]=_0x58e196,this['particlesComputing']=new ParticlesComputing(this['context'],this[_0x440259(0x11f)],this['options'],this[_0x440259(0x16f)]),this['particlesRendering']=new ParticlesRendering(this[_0x440259(0x1d9)],this['data'],this['options'],this['viewerParameters'],this[_0x440259(0x17d)]);}['canvasResize'](_0x506425){const _0x3227cb=_0x44fff8;this['particlesComputing']['destroyParticlesTextures'](),Object[_0x3227cb(0x1eb)](this['particlesComputing']['windTextures'])['forEach'](_0xeba9a4=>{const _0xd7532=_0x3227cb;this['particlesComputing']['windTextures'][_0xeba9a4][_0xd7532(0x181)]();}),this[_0x3227cb(0x185)][_0x3227cb(0x1a5)]['colorTable']['destroy'](),Object[_0x3227cb(0x1eb)](this[_0x3227cb(0x185)]['framebuffers'])['forEach'](_0xe9ca8f=>{const _0x7e6ee7=_0x3227cb;this['particlesRendering'][_0x7e6ee7(0x138)][_0xe9ca8f]['destroy']();}),this[_0x3227cb(0x1d9)]=_0x506425,this[_0x3227cb(0x17d)]=new ParticlesComputing(this[_0x3227cb(0x1d9)],this['data'],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this['options'],this['viewerParameters'],this['particlesComputing']);}['clearFramebuffers'](){const _0x13c835=_0x44fff8,_0x58104f=new Cesium$2[(_0x13c835(0x11a))]({'color':new Cesium$2[(_0x13c835(0x1ad))](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2[_0x13c835(0x1d0)][_0x13c835(0x19e)]});Object['keys'](this[_0x13c835(0x185)]['framebuffers'])['forEach'](_0x513145=>{const _0x13174b=_0x13c835;_0x58104f['framebuffer']=this['particlesRendering']['framebuffers'][_0x513145],_0x58104f['execute'](this[_0x13174b(0x1d9)]);});}['refreshParticles'](_0x466c12){const _0x33ed27=_0x44fff8;this['clearFramebuffers'](),this['particlesComputing']['destroyParticlesTextures'](),this['particlesComputing'][_0x33ed27(0x1c0)](this['context'],this['options'],this['viewerParameters']);if(_0x466c12){var _0x2db218,_0x35aca5;const _0x34ea83=this['particlesRendering']['createSegmentsGeometry'](this['options']);this['particlesRendering']['primitives']['segments']['geometry']=_0x34ea83;const _0x4918bc=Cesium$2['VertexArray']['fromGeometry']({'context':this['context'],'geometry':_0x34ea83,'attributeLocations':this[_0x33ed27(0x185)]['primitives']['segments']['attributeLocations'],'bufferUsage':Cesium$2['BufferUsage']['STATIC_DRAW']});(_0x2db218=this[_0x33ed27(0x185)]['primitives'])!==null&&_0x2db218!==void 0x0&&(_0x35aca5=_0x2db218['segments'])!==null&&_0x35aca5!==void 0x0&&_0x35aca5['commandToExecute']&&(this['particlesRendering'][_0x33ed27(0x1b2)]['segments']['commandToExecute']['vertexArray']=_0x4918bc);}}['setOptions'](_0x660282){const _0x19984c=_0x44fff8;let _0x5a6eee=![];this['options'][_0x19984c(0x13a)]!==_0x660282[_0x19984c(0x13a)]&&(_0x5a6eee=!![]),Object[_0x19984c(0x1eb)](_0x660282)[_0x19984c(0x15b)](_0x2f3b19=>{this['options'][_0x2f3b19]=_0x660282[_0x2f3b19];}),this['refreshParticles'](_0x5a6eee);}['applyViewerParameters'](_0x5f531e){const _0x3e17f0=_0x44fff8;Object[_0x3e17f0(0x1eb)](_0x5f531e)[_0x3e17f0(0x15b)](_0x55a5ba=>{this['viewerParameters'][_0x55a5ba]=_0x5f531e[_0x55a5ba];}),this['refreshParticles'](![]);}[_0x44fff8(0x181)](){const _0x1be578=_0x44fff8;clearTimeout(this[_0x1be578(0x180)]),this[_0x1be578(0x17d)]['destroyParticlesTextures'](),Object[_0x1be578(0x1eb)](this['particlesComputing']['windTextures'])['forEach'](_0x31b6c7=>{const _0x30b396=_0x1be578;this[_0x30b396(0x17d)]['windTextures'][_0x31b6c7]['destroy']();}),this[_0x1be578(0x185)][_0x1be578(0x1a5)]['colorTable']['destroy'](),Object[_0x1be578(0x1eb)](this['particlesRendering']['framebuffers'])[_0x1be578(0x15b)](_0x4f574a=>{this['particlesRendering']['framebuffers'][_0x4f574a]['destroy']();});for(const _0x4f5136 in this){delete this[_0x4f5136];}}}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace[_0x44fff8(0x130)]['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':[_0x44fff8(0x1f6)]};class WindLayer extends BaseLayer$1{constructor(_0x21fb04={}){_0x21fb04={...DEF_OPTIONS,..._0x21fb04},super(_0x21fb04),this['_setOptionsHook'](_0x21fb04);}get['layer'](){const _0xb6adca=_0x44fff8;return this[_0xb6adca(0x1b2)];}get[_0x44fff8(0x11f)](){const _0x3d10f7=_0x44fff8;return this[_0x3d10f7(0x10b)];}set['data'](_0x16ae06){this['setData'](_0x16ae06);}get[_0x44fff8(0x17e)](){const _0x37293f=_0x44fff8;return this[_0x37293f(0x17a)][_0x37293f(0x17e)];}set['colors'](_0x6f5272){this['options']['colors']=_0x6f5272,this['particleSystem']&&this['particleSystem']['setOptions']({'colors':_0x6f5272}),this['resize']();}[_0x44fff8(0x1c7)](){}['_addedHook'](){const _0x5adbc5=_0x44fff8;this['scene']=this['_map']['scene'],this['camera']=this[_0x5adbc5(0x1a1)]['camera'],this[_0x5adbc5(0x1b2)]=new Cesium$1['PrimitiveCollection'](),this['_map']['scene'][_0x5adbc5(0x1b2)]['add'](this['primitives']),this['viewerParameters']={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1[(_0x5adbc5(0x1b4))](Cesium$1['Cartesian3'][_0x5adbc5(0x139)],0.99*0x615299),this['updateViewerParameters'](),window['addEventListener']('resize',this['resize'][_0x5adbc5(0x194)](this),![]),this[_0x5adbc5(0x10a)]=![],this[_0x5adbc5(0x170)]=![],this['_map']['on'](mars3d__namespace['EventType'][_0x5adbc5(0x171)],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this[_0x5adbc5(0x136)],this),this[_0x5adbc5(0x1a1)]['on'](mars3d__namespace['EventType'][_0x5adbc5(0x150)],this['_onMouseMoveEvent'],this),this['_data']&&this['setData'](this['_data']);}['_removedHook'](){const _0x2f78ab=_0x44fff8;window['removeEventListener']('resize',this[_0x2f78ab(0x1f3)]),this['_map'][_0x2f78ab(0x132)](mars3d__namespace[_0x2f78ab(0x190)]['preRender'],this['_onMap_preRenderEvent'],this),this[_0x2f78ab(0x1a1)]['off'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this[_0x2f78ab(0x1a1)]['off'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace['EventType'][_0x2f78ab(0x112)],this[_0x2f78ab(0x136)],this),this['_map'][_0x2f78ab(0x132)](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['primitives'][_0x2f78ab(0x1be)](),this[_0x2f78ab(0x1a1)]['scene']['primitives']['remove'](this['primitives']);}['resize'](){const _0x3c8544=_0x44fff8;if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this['primitives'][_0x3c8544(0x1be)](),this[_0x3c8544(0x1a1)]['once'](mars3d__namespace[_0x3c8544(0x190)][_0x3c8544(0x1d4)],this[_0x3c8544(0x1e8)],this);}[_0x44fff8(0x1e8)](_0x383aed){const _0x45b3cf=_0x44fff8;this['particleSystem']['canvasResize'](this['scene']['context']),this['addPrimitives'](),this['primitives'][_0x45b3cf(0x159)]=!![];}[_0x44fff8(0x19d)](_0x4629f2){const _0x3717e4=_0x44fff8;clearTimeout(this[_0x3717e4(0x1a3)]);if(!this['show']||!this[_0x3717e4(0x13e)])return;this['primitives']['show']=![],this['refreshTimer']=setTimeout(()=>{const _0xfb9ad4=_0x3717e4;if(!this[_0xfb9ad4(0x159)])return;this[_0xfb9ad4(0x15a)]();},0xc8);}['_onMouseDownEvent'](_0x476b4d){this['mouse_down']=!![];}['_onMouseMoveEvent'](_0x4abbfd){const _0x1b0243=_0x44fff8;if(!this['show']||!this[_0x1b0243(0x13e)])return;this['mouse_down']&&(this['primitives'][_0x1b0243(0x159)]=![],this[_0x1b0243(0x170)]=!![]);}['_onMouseUpEvent'](_0x402ecc){const _0x129c3c=_0x44fff8;if(!this['show']||!this[_0x129c3c(0x13e)])return;this['mouse_down']&&this['mouse_move']&&this[_0x129c3c(0x15a)](),this['primitives']['show']=!![],this['mouse_down']=![],this['mouse_move']=![];}['redraw'](){const _0x48a57b=_0x44fff8;if(!this['_map']||!this[_0x48a57b(0x159)])return;this['updateViewerParameters'](),this[_0x48a57b(0x13e)]['applyViewerParameters'](this['viewerParameters']),this[_0x48a57b(0x1b2)][_0x48a57b(0x159)]=!![];}[_0x44fff8(0x108)](_0x316263){const _0x96a414=_0x44fff8;this['_data']=_0x316263,this[_0x96a414(0x13e)]&&this['particleSystem'][_0x96a414(0x181)](),this['particleSystem']=new ParticleSystem(this['scene']['context'],_0x316263,this['getOptions'](),this[_0x96a414(0x16f)]),this['addPrimitives']();}[_0x44fff8(0x12a)](_0x2e0c6f,_0x1e6779){const _0x59994a=_0x44fff8;if(_0x2e0c6f)for(const _0x286c56 in _0x2e0c6f){this[_0x286c56]=_0x2e0c6f[_0x286c56];}this[_0x59994a(0x13e)]&&this['particleSystem']['setOptions'](this[_0x59994a(0x172)]());}[_0x44fff8(0x172)](){const _0x4c520e=_0x44fff8,_0x3463e7=Math['ceil'](Math['sqrt'](this[_0x4c520e(0x1bd)]));return this[_0x4c520e(0x1bd)]=_0x3463e7*_0x3463e7,{'particlesTextureSize':_0x3463e7,'maxParticles':this['particlesNumber'],'particleHeight':this['fixedHeight'],'fadeOpacity':this[_0x4c520e(0x176)],'dropRate':this[_0x4c520e(0x147)],'dropRateBump':this['dropRateBump'],'speedFactor':this['speedFactor'],'lineWidth':this['lineWidth'],'colors':this['colors']};}['addPrimitives'](){const _0x2980b2=_0x44fff8;this['primitives']['add'](this['particleSystem']['particlesComputing'][_0x2980b2(0x1b2)]['getWind']),this['primitives']['add'](this[_0x2980b2(0x13e)][_0x2980b2(0x17d)]['primitives']['updateSpeed']),this['primitives']['add'](this[_0x2980b2(0x13e)]['particlesComputing']['primitives']['updatePosition']),this[_0x2980b2(0x1b2)][_0x2980b2(0x153)](this['particleSystem']['particlesComputing']['primitives']['postProcessingPosition']),this['primitives']['add'](this[_0x2980b2(0x13e)]['particlesComputing']['primitives']['postProcessingSpeed']),this['primitives']['add'](this[_0x2980b2(0x13e)]['particlesRendering']['primitives']['segments']),this[_0x2980b2(0x1b2)][_0x2980b2(0x153)](this['particleSystem']['particlesRendering']['primitives']['trails']),this['primitives'][_0x2980b2(0x153)](this['particleSystem']['particlesRendering']['primitives'][_0x2980b2(0x17f)]);}['updateViewerParameters'](){const _0x3f0077=_0x44fff8;let _0x4305a0=this[_0x3f0077(0x1ef)]['computeViewRectangle'](this['scene'][_0x3f0077(0x178)]['ellipsoid']);if(!_0x4305a0){const _0x8d7314=this[_0x3f0077(0x1a1)][_0x3f0077(0x151)]();_0x4305a0=Cesium$1['Rectangle']['fromDegrees'](_0x8d7314['xmin'],_0x8d7314['ymin'],_0x8d7314[_0x3f0077(0x13c)],_0x8d7314['ymax']);}const _0x163646=Util['viewRectangleToLonLatRange'](_0x4305a0);this['viewerParameters']['lonRange']['x']=_0x163646[_0x3f0077(0x129)]['min'],this[_0x3f0077(0x16f)]['lonRange']['y']=_0x163646[_0x3f0077(0x129)]['max'],this['viewerParameters'][_0x3f0077(0x167)]['x']=_0x163646['lat']['min'],this['viewerParameters']['latRange']['y']=_0x163646['lat']['max'];const _0x3b0445=this[_0x3f0077(0x1ef)][_0x3f0077(0x1df)](this[_0x3f0077(0x113)],this[_0x3f0077(0x115)][_0x3f0077(0x13f)],this['scene']['drawingBufferHeight']);_0x3b0445>0x0&&(this[_0x3f0077(0x16f)]['pixelSize']=_0x3b0445);}}mars3d__namespace[_0x44fff8(0x1e7)][_0x44fff8(0x165)]('wind',WindLayer),mars3d__namespace[_0x44fff8(0x130)]['WindLayer']=WindLayer;class CanvasParticle{constructor(){const _0x25aad3=_0x44fff8;this[_0x25aad3(0x131)]=null,this['lat']=null,this[_0x25aad3(0x1c1)]=null,this['tlat']=null,this['age']=null,this['speed']=null;}['destroy'](){for(const _0x4faaf3 in this){delete this[_0x4faaf3];}}}class CanvasWindField{constructor(_0x379951){const _0x1a67ff=_0x44fff8;this[_0x1a67ff(0x1cd)](_0x379951);}get['speedRate'](){const _0x2b2961=_0x44fff8;return this[_0x2b2961(0x1ee)];}set['speedRate'](_0x4934a5){const _0x4203d2=_0x44fff8;this['_speedRate']=(0x64-(_0x4934a5>0x63?0x63:_0x4934a5))*0x64,this['_calc_speedRate']=[(this['xmax']-this['xmin'])/this['_speedRate'],(this['ymax']-this['ymin'])/this[_0x4203d2(0x1ee)]];}get['maxAge'](){return this['_maxAge'];}set['maxAge'](_0x35541d){const _0x306608=_0x44fff8;this[_0x306608(0x154)]=_0x35541d;}['setOptions'](_0xeb403f){const _0x5d14c0=_0x44fff8;this['options']=_0xeb403f,this['maxAge']=_0xeb403f[_0x5d14c0(0x137)]||0x78,this['speedRate']=_0xeb403f['speedRate']||0x32,this[_0x5d14c0(0x114)]=[];const _0x468512=_0xeb403f['particlesNumber']||0x1000;for(let _0x4026f7=0x0;_0x4026f7<_0x468512;_0x4026f7++){const _0x4576c9=this[_0x5d14c0(0x15c)](new CanvasParticle());this['particles'][_0x5d14c0(0x1dd)](_0x4576c9);}}['setDate'](_0x57a541){const _0x3f61ca=_0x44fff8;this[_0x3f61ca(0x127)]=_0x57a541['rows'],this['cols']=_0x57a541['cols'],this['xmin']=_0x57a541[_0x3f61ca(0x1d2)],this['xmax']=_0x57a541['xmax'],this['ymin']=_0x57a541['ymin'],this['ymax']=_0x57a541['ymax'],this[_0x3f61ca(0x10c)]=[];const _0x341ffa=_0x57a541['udata'],_0x5573c1=_0x57a541['vdata'];let _0x2c68c7=![];_0x341ffa['length']===this[_0x3f61ca(0x127)]&&_0x341ffa[0x0]['length']===this['cols']&&(_0x2c68c7=!![]);let _0x3ae068=0x0,_0x4c5f00=null,_0x18a23c=null;for(let _0x1c602a=0x0;_0x1c602a<this['rows'];_0x1c602a++){_0x4c5f00=[];for(let _0x12cbcc=0x0;_0x12cbcc<this['cols'];_0x12cbcc++,_0x3ae068++){_0x2c68c7?_0x18a23c=this[_0x3f61ca(0x183)](_0x341ffa[_0x1c602a][_0x12cbcc],_0x5573c1[_0x1c602a][_0x12cbcc]):_0x18a23c=this['_calcUV'](_0x341ffa[_0x3ae068],_0x5573c1[_0x3ae068]),_0x4c5f00['push'](_0x18a23c);}this['grid']['push'](_0x4c5f00);}this['options']['reverseY']&&this[_0x3f61ca(0x10c)]['reverse']();}['clear'](){const _0x5723ce=_0x44fff8;delete this['rows'],delete this['cols'],delete this['xmin'],delete this['xmax'],delete this[_0x5723ce(0x1d1)],delete this[_0x5723ce(0x1ce)],delete this['grid'],delete this[_0x5723ce(0x114)];}['toGridXY'](_0x2dc706,_0x3a6f09){const _0x5cee74=_0x44fff8,_0x26c129=(_0x2dc706-this['xmin'])/(this['xmax']-this[_0x5cee74(0x1d2)])*(this[_0x5cee74(0x1c8)]-0x1),_0x161080=(this['ymax']-_0x3a6f09)/(this['ymax']-this['ymin'])*(this['rows']-0x1);return[_0x26c129,_0x161080];}[_0x44fff8(0x1ba)](_0x5e6270,_0x3dedc1){const _0x456d04=_0x44fff8;if(_0x5e6270<0x0||_0x5e6270>=this['cols']||_0x3dedc1>=this['rows'])return[0x0,0x0,0x0];const _0x404286=Math[_0x456d04(0x158)](_0x5e6270),_0x4dc991=Math[_0x456d04(0x158)](_0x3dedc1);if(_0x404286===_0x5e6270&&_0x4dc991===_0x3dedc1)return this[_0x456d04(0x10c)][_0x3dedc1][_0x5e6270];const _0x6e500a=_0x404286+0x1,_0x2e72cc=_0x4dc991+0x1,_0x18bd05=this[_0x456d04(0x1ba)](_0x404286,_0x4dc991),_0x39608e=this['getUVByXY'](_0x6e500a,_0x4dc991),_0x23c242=this['getUVByXY'](_0x404286,_0x2e72cc),_0x291c7d=this['getUVByXY'](_0x6e500a,_0x2e72cc);let _0x50bd40=null;try{_0x50bd40=this['_bilinearInterpolation'](_0x5e6270-_0x404286,_0x3dedc1-_0x4dc991,_0x18bd05,_0x39608e,_0x23c242,_0x291c7d);}catch(_0x19447c){console[_0x456d04(0x16a)](_0x5e6270,_0x3dedc1);}return _0x50bd40;}[_0x44fff8(0x1d7)](_0x18cf92,_0x22297d,_0x40a7c0,_0x5eaecd,_0x334940,_0x4bb696){const _0x3c328f=_0x44fff8,_0x214da8=0x1-_0x18cf92,_0x56afdd=0x1-_0x22297d,_0x2a07b4=_0x214da8*_0x56afdd,_0x3a0eee=_0x18cf92*_0x56afdd,_0xc0f702=_0x214da8*_0x22297d,_0x45664c=_0x18cf92*_0x22297d,_0x46e00a=_0x40a7c0[0x0]*_0x2a07b4+_0x5eaecd[0x0]*_0x3a0eee+_0x334940[0x0]*_0xc0f702+_0x4bb696[0x0]*_0x45664c,_0x5f9754=_0x40a7c0[0x1]*_0x2a07b4+_0x5eaecd[0x1]*_0x3a0eee+_0x334940[0x1]*_0xc0f702+_0x4bb696[0x1]*_0x45664c;return this[_0x3c328f(0x183)](_0x46e00a,_0x5f9754);}['_calcUV'](_0x4422a8,_0x3ca952){return[+_0x4422a8,+_0x3ca952,Math['sqrt'](_0x4422a8*_0x4422a8+_0x3ca952*_0x3ca952)];}['getUVByPoint'](_0x2b80c6,_0x3927c2){if(!this['isInExtent'](_0x2b80c6,_0x3927c2))return null;const _0x1e4ef1=this['toGridXY'](_0x2b80c6,_0x3927c2),_0x384371=this['getUVByXY'](_0x1e4ef1[0x0],_0x1e4ef1[0x1]);return _0x384371;}[_0x44fff8(0x197)](_0x405a8c,_0xa711b4){const _0x464adb=_0x44fff8;return _0x405a8c>=this['xmin']&&_0x405a8c<=this['xmax']&&_0xa711b4>=this['ymin']&&_0xa711b4<=this[_0x464adb(0x1ce)]?!![]:![];}['getRandomLatLng'](){const _0x507d3f=_0x44fff8,_0xbe7c1b=fRandomByfloat(this['xmin'],this['xmax']),_0x28fb7d=fRandomByfloat(this[_0x507d3f(0x1d1)],this['ymax']);return{'lat':_0x28fb7d,'lng':_0xbe7c1b};}[_0x44fff8(0x1e4)](){const _0x1e337a=_0x44fff8;let _0x406eed,_0x57389b,_0x54b219;for(let _0x13e2a6=0x0,_0x181e9a=this['particles']['length'];_0x13e2a6<_0x181e9a;_0x13e2a6++){let _0x399276=this['particles'][_0x13e2a6];_0x399276['age']<=0x0&&(_0x399276=this['_randomParticle'](_0x399276));if(_0x399276['age']>0x0){const _0x5cd168=_0x399276['tlng'],_0x17ad7d=_0x399276['tlat'];_0x54b219=this['getUVByPoint'](_0x5cd168,_0x17ad7d),_0x54b219?(_0x406eed=_0x5cd168+this[_0x1e337a(0x1f5)][0x0]*_0x54b219[0x0],_0x57389b=_0x17ad7d+this['_calc_speedRate'][0x1]*_0x54b219[0x1],_0x399276['lng']=_0x5cd168,_0x399276['lat']=_0x17ad7d,_0x399276[_0x1e337a(0x1c1)]=_0x406eed,_0x399276[_0x1e337a(0x196)]=_0x57389b,_0x399276['speed']=_0x54b219[0x2],_0x399276['age']--):_0x399276['age']=0x0;}}return this['particles'];}['_randomParticle'](_0xc59f95){const _0x4e0986=_0x44fff8;let _0x3e9f50,_0x11f105;for(let _0x197130=0x0;_0x197130<0x1e;_0x197130++){_0x3e9f50=this[_0x4e0986(0x1d5)](),_0x11f105=this['getUVByPoint'](_0x3e9f50['lng'],_0x3e9f50['lat']);if(_0x11f105&&_0x11f105[0x2]>0x0)break;}if(!_0x11f105)return _0xc59f95;const _0x5dc3db=_0x3e9f50[_0x4e0986(0x131)]+this[_0x4e0986(0x1f5)][0x0]*_0x11f105[0x0],_0x5919f4=_0x3e9f50['lat']+this['_calc_speedRate'][0x1]*_0x11f105[0x1];return _0xc59f95['lng']=_0x3e9f50['lng'],_0xc59f95['lat']=_0x3e9f50['lat'],_0xc59f95['tlng']=_0x5dc3db,_0xc59f95['tlat']=_0x5919f4,_0xc59f95['age']=Math['round'](Math[_0x4e0986(0x155)]()*this['maxAge']),_0xc59f95['speed']=_0x11f105[0x2],_0xc59f95;}['destroy'](){for(const _0x2c5766 in this){delete this[_0x2c5766];}}}function fRandomByfloat(_0x4cc56a,_0x516736){return _0x4cc56a+Math['random']()*(_0x516736-_0x4cc56a);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer']['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0x1c15a9={}){const _0x1341e0=_0x44fff8;super(_0x1c15a9),this['_setOptionsHook'](_0x1c15a9),this['canvas']=null,_0x1c15a9['colors']&&_0x1c15a9[_0x1341e0(0x1ca)]&&(this[_0x1341e0(0x16e)]=new mars3d__namespace[(_0x1341e0(0x14c))](_0x1c15a9));}[_0x44fff8(0x12a)](_0x479af7,_0x2cbdeb){const _0x50a3f5=_0x44fff8;this['frameTime']=0x3e8/(_0x479af7['frameRate']||0xa),this['_pointerEvents']=this[_0x50a3f5(0x17a)]['pointerEvents']??![],this['color']=_0x479af7['color']||'#ffffff',this[_0x50a3f5(0x1e2)]=_0x479af7[_0x50a3f5(0x1e2)]||0x1,this[_0x50a3f5(0x15e)]=_0x479af7[_0x50a3f5(0x15e)]??0x0,this[_0x50a3f5(0x188)]=_0x479af7['reverseY']??![],this[_0x50a3f5(0x11d)]&&this['windField']['setOptions'](_0x479af7);}get[_0x44fff8(0x130)](){return this['canvas'];}get[_0x44fff8(0x18c)](){const _0x313834=_0x44fff8;return this['_map']['scene']['canvas'][_0x313834(0x1cc)];}get['canvasHeight'](){const _0x43a623=_0x44fff8;return this['_map'][_0x43a623(0x115)]['canvas']['clientHeight'];}get['pointerEvents'](){return this['_pointerEvents'];}set['pointerEvents'](_0x24af63){const _0x17a4bf=_0x44fff8;this[_0x17a4bf(0x1b9)]=_0x24af63;if(!this['canvas'])return;_0x24af63?this[_0x17a4bf(0x1a7)]['style']['pointer-events']='all':this['canvas'][_0x17a4bf(0x1de)]['pointer-events']='none';}get[_0x44fff8(0x1bd)](){const _0x529303=_0x44fff8;return this['options'][_0x529303(0x1bd)];}set['particlesNumber'](_0x998ca9){this['options']['particlesNumber']=_0x998ca9,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get[_0x44fff8(0x13b)](){const _0x4c6d4c=_0x44fff8;return this[_0x4c6d4c(0x17a)]['speedRate'];}set['speedRate'](_0x492297){const _0x3b73c2=_0x44fff8;this['options']['speedRate']=_0x492297,this['windField']&&(this[_0x3b73c2(0x11d)]['speedRate']=_0x492297);}get['maxAge'](){const _0x2315f7=_0x44fff8;return this['options'][_0x2315f7(0x137)];}set['maxAge'](_0x1d113f){const _0x2be527=_0x44fff8;this[_0x2be527(0x17a)]['maxAge']=_0x1d113f,this['windField']&&(this['windField'][_0x2be527(0x137)]=_0x1d113f);}get['data'](){return this['windData'];}set['data'](_0x22759d){this['setData'](_0x22759d);}['_showHook'](_0x5f2511){const _0x533dbf=_0x44fff8;_0x5f2511?this[_0x533dbf(0x1c2)]():(this['windData']&&(this[_0x533dbf(0x17a)]['data']=this['windData']),this[_0x533dbf(0x1d8)]());}['_mountedHook'](){this['options']['worker']?this['initWorker']():this['windField']=new CanvasWindField(this['options']);}['_addedHook'](){const _0x42608a=_0x44fff8;this[_0x42608a(0x1a7)]=this['_createCanvas'](),this['canvasContext']=this['canvas'][_0x42608a(0x1e5)]('2d',{'willReadFrequently':!![]}),this[_0x42608a(0x141)](),this['options']['data']&&this[_0x42608a(0x108)](this[_0x42608a(0x17a)]['data']);}['_removedHook'](){const _0xd8df83=_0x44fff8;this[_0xd8df83(0x1e6)](),this['unbindEvent'](),this['canvas']&&(this['_map']['container']['removeChild'](this['canvas']),delete this[_0xd8df83(0x1a7)]);}[_0x44fff8(0x1a4)](){const _0x97bd25=_0x44fff8,_0x210fca=mars3d__namespace['DomUtil'][_0x97bd25(0x12f)]('canvas','mars3d-canvasWind',this[_0x97bd25(0x1a1)][_0x97bd25(0x144)]);return _0x210fca[_0x97bd25(0x1de)]['position']='absolute',_0x210fca['style']['top']='0px',_0x210fca['style']['left']=_0x97bd25(0x1f7),_0x210fca[_0x97bd25(0x1de)]['width']=this['_map']['scene']['canvas']['clientWidth']+'px',_0x210fca[_0x97bd25(0x1de)]['height']=this['_map'][_0x97bd25(0x115)]['canvas']['clientHeight']+'px',_0x210fca['style'][_0x97bd25(0x1ec)]=this['_pointerEvents']?_0x97bd25(0x142):_0x97bd25(0x133),_0x210fca['style']['zIndex']=this['options']['zIndex']??0x9,_0x210fca['width']=this['_map'][_0x97bd25(0x115)]['canvas']['clientWidth'],_0x210fca['height']=this['_map']['scene']['canvas'][_0x97bd25(0x148)],_0x210fca;}['resize'](){const _0x6d6285=_0x44fff8;this['canvas']&&(this['canvas']['style'][_0x6d6285(0x189)]=this[_0x6d6285(0x1a1)]['scene'][_0x6d6285(0x1a7)]['clientWidth']+'px',this[_0x6d6285(0x1a7)]['style']['height']=this['_map']['scene'][_0x6d6285(0x1a7)]['clientHeight']+'px',this[_0x6d6285(0x1a7)][_0x6d6285(0x189)]=this['_map']['scene']['canvas']['clientWidth'],this['canvas'][_0x6d6285(0x121)]=this['_map'][_0x6d6285(0x115)]['canvas']['clientHeight']);}['bindEvent'](){const _0x4814fc=_0x44fff8,_0x1ce1bc=this;let _0x3086ee=Date['now']();(function _0xecbc1(){const _0x56d573=_0x1681;_0x1ce1bc[_0x56d573(0x193)]=window['requestAnimationFrame'](_0xecbc1);if(_0x1ce1bc['show']&&_0x1ce1bc['windField']){const _0x333f79=Date['now'](),_0x5a7e47=_0x333f79-_0x3086ee;_0x5a7e47>_0x1ce1bc[_0x56d573(0x1c3)]&&(_0x3086ee=_0x333f79-_0x5a7e47%_0x1ce1bc['frameTime'],_0x1ce1bc['update']());}}(),window['addEventListener']('resize',this['resize'][_0x4814fc(0x194)](this),![]),this[_0x4814fc(0x10a)]=![],this['mouse_move']=![],this[_0x4814fc(0x17a)][_0x4814fc(0x1b7)]&&(this[_0x4814fc(0x1a1)]['on'](mars3d__namespace['EventType'][_0x4814fc(0x171)],this[_0x4814fc(0x19d)],this),this['_map']['on'](mars3d__namespace[_0x4814fc(0x190)][_0x4814fc(0x1cb)],this[_0x4814fc(0x1ed)],this),this[_0x4814fc(0x1a1)]['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this)));}['unbindEvent'](){const _0x4588b5=_0x44fff8;window['cancelAnimationFrame'](this[_0x4588b5(0x193)]),delete this[_0x4588b5(0x193)],window['removeEventListener']('resize',this['resize']),this['options']['mouseHidden']&&(this[_0x4588b5(0x1a1)][_0x4588b5(0x132)](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this[_0x4588b5(0x1a1)]['off'](mars3d__namespace[_0x4588b5(0x190)]['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map'][_0x4588b5(0x132)](mars3d__namespace['EventType'][_0x4588b5(0x150)],this[_0x4588b5(0x16b)],this));}['_onMapWhellEvent'](_0x122f59){const _0x278d94=_0x44fff8;clearTimeout(this['refreshTimer']);if(!this['show']||!this['canvas'])return;this[_0x278d94(0x1a7)]['style']['visibility']='hidden',this['refreshTimer']=setTimeout(()=>{const _0x7e0551=_0x278d94;if(!this[_0x7e0551(0x159)])return;this['redraw'](),this[_0x7e0551(0x1a7)]['style']['visibility']='visible';},0xc8);}['_onMouseDownEvent'](_0x48a255){const _0x3d7ab5=_0x44fff8;this['mouse_down']=!![],this['_map']['off'](mars3d__namespace[_0x3d7ab5(0x190)]['mouseMove'],this['_onMouseMoveEvent'],this),this[_0x3d7ab5(0x1a1)]['on'](mars3d__namespace[_0x3d7ab5(0x190)][_0x3d7ab5(0x150)],this[_0x3d7ab5(0x16b)],this);}[_0x44fff8(0x16b)](_0x1b82ff){const _0x39e9ee=_0x44fff8;if(!this['show']||!this['canvas'])return;this['mouse_down']&&(this['canvas']['style']['visibility']=_0x39e9ee(0x14e),this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x42effa){const _0x2fcd24=_0x44fff8;if(!this['show']||!this['canvas'])return;this['_map']['off'](mars3d__namespace['EventType'][_0x2fcd24(0x150)],this[_0x2fcd24(0x16b)],this),this['mouse_down']&&this[_0x2fcd24(0x170)]&&this['redraw'](),this['canvas']['style'][_0x2fcd24(0x187)]='visible',this['mouse_down']=![],this['mouse_move']=![];}['setData'](_0x3b4782){this['clear'](),this['windData']=_0x3b4782,this['windField']['setDate'](_0x3b4782),this['redraw']();}[_0x44fff8(0x15a)](){const _0x1eeffc=_0x44fff8;if(!this['show'])return;this[_0x1eeffc(0x11d)][_0x1eeffc(0x1cd)](this[_0x1eeffc(0x17a)]),this['update']();}['update'](){const _0xe25801=_0x44fff8;if(this['_updateIng'])return;this[_0xe25801(0x10d)]=!![];if(this[_0xe25801(0x109)])this[_0xe25801(0x11d)]['update']();else{const _0x29a700=this['windField']['getParticles']();this[_0xe25801(0x146)](_0x29a700);}this['_updateIng']=![];}['_drawLines'](_0xf1037c){const _0x9c069=_0x44fff8;this['canvasContext']['globalCompositeOperation']='destination-in',this['canvasContext']['fillRect'](0x0,0x0,this['canvasWidth'],this['canvasHeight']),this['canvasContext']['globalCompositeOperation']='lighter',this['canvasContext']['globalAlpha']=0.9;const _0x2103dd=this[_0x9c069(0x1a1)]['scene']['mode']!==Cesium[_0x9c069(0x160)]['SCENE3D'],_0x4889d6=this['canvasWidth']*0.25;if(this[_0x9c069(0x16e)])for(let _0x168834=0x0,_0x4eae0d=_0xf1037c['length'];_0x168834<_0x4eae0d;_0x168834++){const _0x538ba7=_0xf1037c[_0x168834],_0x4b23ea=this['_tomap'](_0x538ba7['lng'],_0x538ba7['lat'],_0x538ba7),_0x170c45=this['_tomap'](_0x538ba7[_0x9c069(0x1c1)],_0x538ba7['tlat'],_0x538ba7);if(!_0x4b23ea||!_0x170c45)continue;if(_0x2103dd&&Math['abs'](_0x4b23ea[0x0]-_0x170c45[0x0])>=_0x4889d6)continue;this[_0x9c069(0x119)]['beginPath'](),this['canvasContext'][_0x9c069(0x1e2)]=this['lineWidth'],this['canvasContext']['strokeStyle']=this[_0x9c069(0x16e)][_0x9c069(0x1d3)](_0x538ba7['speed']),this['canvasContext']['moveTo'](_0x4b23ea[0x0],_0x4b23ea[0x1]),this['canvasContext']['lineTo'](_0x170c45[0x0],_0x170c45[0x1]),this[_0x9c069(0x119)]['stroke']();}else{this['canvasContext'][_0x9c069(0x1f4)](),this['canvasContext']['lineWidth']=this['lineWidth'],this['canvasContext']['strokeStyle']=this[_0x9c069(0x15d)];for(let _0x2bc576=0x0,_0x44aa1d=_0xf1037c['length'];_0x2bc576<_0x44aa1d;_0x2bc576++){const _0x442bc2=_0xf1037c[_0x2bc576],_0x402c3c=this[_0x9c069(0x1fc)](_0x442bc2['lng'],_0x442bc2['lat'],_0x442bc2),_0x3a268e=this['_tomap'](_0x442bc2[_0x9c069(0x1c1)],_0x442bc2['tlat'],_0x442bc2);if(!_0x402c3c||!_0x3a268e)continue;if(_0x2103dd&&Math['abs'](_0x402c3c[0x0]-_0x3a268e[0x0])>=_0x4889d6)continue;this[_0x9c069(0x119)]['moveTo'](_0x402c3c[0x0],_0x402c3c[0x1]),this[_0x9c069(0x119)]['lineTo'](_0x3a268e[0x0],_0x3a268e[0x1]);}this['canvasContext']['stroke']();}}[_0x44fff8(0x1fc)](_0x346dcd,_0x16299f,_0x48405c){const _0x42272a=_0x44fff8,_0x5b95be=Cesium[_0x42272a(0x1a9)]['fromDegrees'](_0x346dcd,_0x16299f,this['fixedHeight']),_0x175050=this[_0x42272a(0x1a1)][_0x42272a(0x115)];if(_0x175050['mode']===Cesium['SceneMode']['SCENE3D']){const _0x5e8ea1=new Cesium['EllipsoidalOccluder'](_0x175050['globe']['ellipsoid'],_0x175050['camera']['positionWC']),_0x20fde4=_0x5e8ea1['isPointVisible'](_0x5b95be);if(!_0x20fde4)return _0x48405c['age']=0x0,null;}const _0x3eda17=Cesium[_0x42272a(0x1ea)]['wgs84ToWindowCoordinates'](this['_map']['scene'],_0x5b95be);return _0x3eda17?[_0x3eda17['x'],_0x3eda17['y']]:null;}['clear'](){this['windField']['clear'](),delete this['windData'];}['initWorker'](){const _0x2f3c35=_0x44fff8;this['worker']=new Worker(this['options'][_0x2f3c35(0x109)]),this['worker']['onmessage']=_0x35fd0c=>{const _0x2adc01=_0x2f3c35;this[_0x2adc01(0x146)](_0x35fd0c['data']['particles']),this['_updateIng2']=![];},this['windField']={'init':_0x4fa03d=>{this['worker']['postMessage']({'type':'init','options':_0x4fa03d});},'setOptions':_0x34260e=>{this['worker']['postMessage']({'type':'setOptions','options':_0x34260e});},'setDate':_0x50a6ab=>{this['worker']['postMessage']({'type':'setDate','data':_0x50a6ab});},'update':()=>{if(this['_updateIng2'])return;this['_updateIng2']=!![],this['worker']['postMessage']({'type':'update'});},'clear':()=>{const _0x3cee81=_0x2f3c35;this['worker']['postMessage']({'type':_0x3cee81(0x1e6)});}},this['windField']['init'](this[_0x2f3c35(0x17a)]);}}mars3d__namespace[_0x44fff8(0x1e7)]['register']('canvasWind',CanvasWindLayer),mars3d__namespace['layer']['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace[_0x44fff8(0x162)]=CanvasWindField,mars3d__namespace[_0x44fff8(0x1dc)]=WindUtil,exports['CanvasWindField']=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
