/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.6.13
 * 编译日期：2023-11-20 21:17:55
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x5696fc=_0x3d7c;(function(_0x2f44ae,_0x30740e){const _0x47fda2=_0x3d7c,_0x13a559=_0x2f44ae();while(!![]){try{const _0xd6a9d9=-parseInt(_0x47fda2(0x278))/0x1+-parseInt(_0x47fda2(0x237))/0x2+parseInt(_0x47fda2(0x22a))/0x3*(-parseInt(_0x47fda2(0x248))/0x4)+-parseInt(_0x47fda2(0x239))/0x5*(-parseInt(_0x47fda2(0x26a))/0x6)+-parseInt(_0x47fda2(0x26f))/0x7*(-parseInt(_0x47fda2(0x2ca))/0x8)+parseInt(_0x47fda2(0x1f7))/0x9+parseInt(_0x47fda2(0x284))/0xa*(parseInt(_0x47fda2(0x21b))/0xb);if(_0xd6a9d9===_0x30740e)break;else _0x13a559['push'](_0x13a559['shift']());}catch(_0x33bde9){_0x13a559['push'](_0x13a559['shift']());}}}(_0x1673,0x89df7));function _interopNamespace(_0x2ee7c6){if(_0x2ee7c6&&_0x2ee7c6['__esModule'])return _0x2ee7c6;var _0x39dd11=Object['create'](null);return _0x2ee7c6&&Object['keys'](_0x2ee7c6)['forEach'](function(_0x5b295a){const _0x421e78=_0x3d7c;if(_0x5b295a!=='default'){var _0x93d77a=Object['getOwnPropertyDescriptor'](_0x2ee7c6,_0x5b295a);Object[_0x421e78(0x221)](_0x39dd11,_0x5b295a,_0x93d77a[_0x421e78(0x20a)]?_0x93d77a:{'enumerable':!![],'get':function(){return _0x2ee7c6[_0x5b295a];}});}}),_0x39dd11['default']=_0x2ee7c6,_0x39dd11;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace['Cesium'];function getU(_0x308ffa,_0x1a9131){const _0x5eda28=_0x3d7c,_0x1c5b9d=_0x308ffa*Math['cos'](Cesium$7[_0x5eda28(0x225)]['toRadians'](_0x1a9131));return _0x1c5b9d;}function getV(_0x4d4666,_0x573d7e){const _0x375455=_0x3d7c,_0x47adea=_0x4d4666*Math[_0x375455(0x201)](Cesium$7['Math']['toRadians'](_0x573d7e));return _0x47adea;}function _0x3d7c(_0x53b327,_0x454f51){const _0x16735b=_0x1673();return _0x3d7c=function(_0x3d7cfd,_0x54f5ad){_0x3d7cfd=_0x3d7cfd-0x1ea;let _0x5f2396=_0x16735b[_0x3d7cfd];return _0x5f2396;},_0x3d7c(_0x53b327,_0x454f51);}function getSpeed(_0x233c35,_0x3deb7a){const _0x2ad801=_0x3d7c,_0x3208e4=Math['sqrt'](Math[_0x2ad801(0x1ee)](_0x233c35,0x2)+Math[_0x2ad801(0x1ee)](_0x3deb7a,0x2));return _0x3208e4;}function getDirection(_0x2f996c,_0x1833c0){const _0x345824=_0x3d7c;let _0x2dcc23=Cesium$7['Math'][_0x345824(0x280)](Math['atan2'](_0x1833c0,_0x2f996c));return _0x2dcc23+=_0x2dcc23<0x0?0x168:0x0,_0x2dcc23;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0x25d8c5){const _0x49d87d=_0x3d7c;this[_0x49d87d(0x2a2)]=_0x25d8c5['commandType'],this['geometry']=_0x25d8c5[_0x49d87d(0x2c0)],this[_0x49d87d(0x273)]=_0x25d8c5['attributeLocations'],this['primitiveType']=_0x25d8c5['primitiveType'],this['uniformMap']=_0x25d8c5[_0x49d87d(0x2b5)],this['vertexShaderSource']=_0x25d8c5['vertexShaderSource'],this['fragmentShaderSource']=_0x25d8c5[_0x49d87d(0x246)],this['rawRenderState']=_0x25d8c5['rawRenderState'],this['framebuffer']=_0x25d8c5[_0x49d87d(0x244)],this['outputTexture']=_0x25d8c5['outputTexture'],this['autoClear']=_0x25d8c5['autoClear']??![],this['preExecute']=_0x25d8c5['preExecute'],this['show']=!![],this['commandToExecute']=undefined,this['clearCommand']=undefined,this['autoClear']&&(this['clearCommand']=new Cesium$6['ClearCommand']({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass'][_0x49d87d(0x2af)]}));}[_0x5696fc(0x296)](_0x581532){const _0xff7054=_0x5696fc;switch(this['commandType']){case'Draw':{const _0x5e5b31=Cesium$6['VertexArray'][_0xff7054(0x232)]({'context':_0x581532,'geometry':this['geometry'],'attributeLocations':this[_0xff7054(0x273)],'bufferUsage':Cesium$6['BufferUsage'][_0xff7054(0x227)]}),_0x51aca0=Cesium$6['ShaderProgram']['fromCache']({'context':_0x581532,'attributeLocations':this[_0xff7054(0x273)],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this['fragmentShaderSource']}),_0x459066=Cesium$6['RenderState']['fromCache'](this['rawRenderState']);return new Cesium$6[(_0xff7054(0x2ce))]({'primitiveType':this[_0xff7054(0x22c)],'shaderProgram':_0x51aca0,'vertexArray':_0x5e5b31,'modelMatrix':Cesium$6[_0xff7054(0x2d1)]['IDENTITY'],'renderState':_0x459066,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass'][_0xff7054(0x2af)],'pickOnly':!![],'owner':this});}case _0xff7054(0x1ef):{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this[_0xff7054(0x1f6)],'persists':!![]});}}}['setGeometry'](_0x522ea9,_0x5b6e7d){const _0x5018ec=_0x5696fc;this['geometry']=_0x5b6e7d;const _0x2f9edd=Cesium$6['VertexArray']['fromGeometry']({'context':_0x522ea9,'geometry':this[_0x5018ec(0x2c0)],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']});this['commandToExecute']['vertexArray']=_0x2f9edd;}[_0x5696fc(0x1f9)](_0x57f6bb){const _0x13fce4=_0x5696fc;if(!this['show'])return;if(_0x57f6bb[_0x13fce4(0x235)]!==Cesium$6['SceneMode']['SCENE3D'])return;!Cesium$6['defined'](this['commandToExecute'])&&(this['commandToExecute']=this['createCommand'](_0x57f6bb['context'])),Cesium$6['defined'](this['preExecute'])&&this[_0x13fce4(0x289)](),Cesium$6['defined'](this['clearCommand'])&&_0x57f6bb['commandList'][_0x13fce4(0x1fa)](this['clearCommand']),_0x57f6bb[_0x13fce4(0x218)]['push'](this['commandToExecute']);}[_0x5696fc(0x27d)](){return![];}['destroy'](){const _0x1f6b94=_0x5696fc;if(this['clearCommand']){var _0x2cf5e7,_0x492e94;(_0x2cf5e7=this['clearCommand'])!==null&&_0x2cf5e7!==void 0x0&&_0x2cf5e7[_0x1f6b94(0x2cd)]&&this['clearCommand'][_0x1f6b94(0x2cd)]['destroy'](),(_0x492e94=this['clearCommand'])!==null&&_0x492e94!==void 0x0&&_0x492e94['shaderProgram']&&this['clearCommand'][_0x1f6b94(0x202)]['destroy'](),delete this[_0x1f6b94(0x25c)];}return this['commandToExecute']&&(this['commandToExecute']['vertexArray']&&this[_0x1f6b94(0x255)]['vertexArray']['destroy'](),this['commandToExecute']['shaderProgram']&&this['commandToExecute'][_0x1f6b94(0x202)]['destroy'](),delete this[_0x1f6b94(0x255)]),Cesium$6[_0x1f6b94(0x212)](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0x139b43=function(){const _0x2aad2d=_0x3d7c,_0x13e1e9=new Cesium$5[(_0x2aad2d(0x210))]({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5[(_0x2aad2d(0x1f2))]({'componentDatatype':Cesium$5[_0x2aad2d(0x267)]['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x13e1e9;},_0x4d4a89=function(_0x59abde,_0x53c2cd){if(Cesium$5['defined'](_0x53c2cd)){const _0x1456a1={};_0x1456a1['arrayBufferView']=_0x53c2cd,_0x59abde['source']=_0x1456a1;}const _0x3c49bb=new Cesium$5['Texture'](_0x59abde);return _0x3c49bb;},_0x20e93e=function(_0x12f7de,_0x470d75,_0x1bf5b8){const _0x4fa842=new Cesium$5['Framebuffer']({'context':_0x12f7de,'colorTextures':[_0x470d75],'depthTexture':_0x1bf5b8});return _0x4fa842;},_0x4232f8=function(_0x5a1000){const _0x36e5ef=_0x3d7c,_0x456b82=!![],_0x307ce4=![],_0x2e7a9f={'viewport':_0x5a1000[_0x36e5ef(0x268)],'depthTest':_0x5a1000[_0x36e5ef(0x207)],'depthMask':_0x5a1000['depthMask'],'blending':_0x5a1000['blending']},_0x5a8af2=Cesium$5['Appearance']['getDefaultRenderState'](_0x456b82,_0x307ce4,_0x2e7a9f);return _0x5a8af2;},_0xec52a5=function(_0xda1ed1){const _0x5aebc6=_0x3d7c,_0x2f7843={},_0x402b8a=Cesium$5['Math']['mod'](_0xda1ed1[_0x5aebc6(0x25b)],Cesium$5['Math']['TWO_PI']),_0x19e4db=Cesium$5[_0x5aebc6(0x225)]['mod'](_0xda1ed1['east'],Cesium$5[_0x5aebc6(0x225)]['TWO_PI']),_0x3f01b7=_0xda1ed1['width'];let _0x2024a1,_0x3c7009;_0x3f01b7>Cesium$5[_0x5aebc6(0x225)]['THREE_PI_OVER_TWO']?(_0x2024a1=0x0,_0x3c7009=Cesium$5['Math']['TWO_PI']):_0x19e4db-_0x402b8a<_0x3f01b7?(_0x2024a1=_0x402b8a,_0x3c7009=_0x402b8a+_0x3f01b7):(_0x2024a1=_0x402b8a,_0x3c7009=_0x19e4db);_0x2f7843[_0x5aebc6(0x2a1)]={'min':Cesium$5['Math']['toDegrees'](_0x2024a1),'max':Cesium$5['Math']['toDegrees'](_0x3c7009)};const _0x294bb1=_0xda1ed1[_0x5aebc6(0x27e)],_0x8f8c7a=_0xda1ed1[_0x5aebc6(0x28d)],_0x2cfd71=_0xda1ed1['height'],_0x3483c2=_0x2cfd71>Cesium$5['Math']['PI']/0xc?_0x2cfd71/0x2:0x0;let _0x2af1b8=Cesium$5['Math']['clampToLatitudeRange'](_0x294bb1-_0x3483c2),_0x81a092=Cesium$5['Math'][_0x5aebc6(0x224)](_0x8f8c7a+_0x3483c2);return _0x2af1b8<-Cesium$5['Math']['PI_OVER_THREE']&&(_0x2af1b8=-Cesium$5['Math']['PI_OVER_TWO']),_0x81a092>Cesium$5[_0x5aebc6(0x225)]['PI_OVER_THREE']&&(_0x81a092=Cesium$5['Math']['PI_OVER_TWO']),_0x2f7843['lat']={'min':Cesium$5[_0x5aebc6(0x225)][_0x5aebc6(0x280)](_0x2af1b8),'max':Cesium$5[_0x5aebc6(0x225)][_0x5aebc6(0x280)](_0x81a092)},_0x2f7843;};return{'getFullscreenQuad':_0x139b43,'createTexture':_0x4d4a89,'createFramebuffer':_0x20e93e,'createRawRenderState':_0x4232f8,'viewRectangleToLonLatRange':_0xec52a5};}());function _0x1673(){const _0x40ff75=['getOptions','colors','3653251XUIgNG','TextureMinificationFilter','lev','_tomap','attributeLocations','floor','currentTrailsDepth','_addedHook','context','467160EazYOz','particles','_onMouseMoveEvent','canvasContext','in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a','isDestroyed','south','style','toDegrees','speedRate','randomBetween','depthTexture','499010XOkHsA','animateFrame','register','min','windData','preExecute','getExtent','uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a','add','north','rgb(206,255,255)','Cartesian3','setData','redraw','particlesNumber','clientHeight','_randomParticle','Sampler','createCommand','segments','lineWidth','getUVByXY','_calc_speedRate','LUMINANCE','trails','lonRange','mouse_move','length','wheel','lon','commandType','colorTable','createRenderingPrimitives','_pointerEvents','particleSystem','computeViewRectangle','_updateIng2','EllipsoidalOccluder','worker','TextureMagnificationFilter','ymax','auto','canrefresh','OPAQUE','removeAll','drawingBufferWidth','_colorRamp','setOptions','levmin','uniformMap','createSegmentsGeometry','textures','fromCssColorString','onmessage','tlng','_setOptionsHook','hidden','ymin','currentParticlesSpeed','EventType','geometry','toGridXY','init','maxParticles','none','viewerParameters','mouseMove','isPointVisible','particlesTextureSize','getColorTexture','16kuydGD','isInExtent','createParticlesTextures','vertexArray','DrawCommand','array','bind','Matrix4','_data','positionWC','uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a','now','dimensions','globeBoundingSphere','pow','Compute','nextTrails','postProcessingPosition','GeometryAttribute','off','Cesium','destroyParticlesTextures','outputTexture','6849666WbxYfT','particlesTextures','update','push','canvasHeight','mouse_down','fillRect','random','lat','_removedHook','sin','shaderProgram','zIndex','updateSpeed','Cartesian2','nextParticlesSpeed','depthTest','tlat','_bilinearInterpolation','get','forEach','PixelFormat','windTextures','ShaderSource','Draw','Geometry','resize','destroyObject','clientWidth','_onMouseUpEvent','rows','ceil','_map','commandList','_updateIng','age','33IAEiAh','mouseDown','BufferUsage','DISABLE_LOG_DEPTH_FRAGMENT_WRITE','speed','clear','defineProperty','container','FLOAT','clampToLatitudeRange','Math','framebuffers','STATIC_DRAW','log','layer','462663OkWiHz','_maxAge','primitiveType','createFramebuffer','createRawRenderState','WindLayer','windField','lng','fromGeometry','particlesRendering','createWindTextures','mode','strokeStyle','597696cQpBQJ','_onMap_preRenderEvent','56645fKKOll','_onMouseDownEvent','execute','_speedRate','show','particlesWind','maxAge','camera','WindUtil','ellipsoid','lineTo','framebuffer','round','fragmentShaderSource','postMessage','20wiFBkd','drawingBufferHeight','visibility','destroy','fixedHeight','cols','grid','NEAREST','_calcUV','particlesComputing','createTexture','PixelDatatype','vdata','commandToExecute','max','canvas','xmax','getRandomLatLng','primitives','west','clearCommand','scene','currentParticlesPosition','udata','updateViewerParameters','initWorker','nextTrailsDepth','createComputingPrimitives','unbindEvent','data','PrimitiveCollection','ComponentDatatype','viewport','pointer-events','78fdVdkR','sqrt','options'];_0x1673=function(){return _0x40ff75;};return _0x1673();}var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert=_0x5696fc(0x27c),trailDraw_frag=_0x5696fc(0x1ea),screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace['Cesium'];class ParticlesRendering{constructor(_0x384fd8,_0x2d7072,_0x1b9f5c,_0x1b64a3,_0x21ec79){const _0xc16abb=_0x5696fc;this['createRenderingTextures'](_0x384fd8,_0x2d7072,_0x1b9f5c['colors']),this['createRenderingFramebuffers'](_0x384fd8),this[_0xc16abb(0x2a4)](_0x384fd8,_0x1b9f5c,_0x1b64a3,_0x21ec79);}['createRenderingTextures'](_0xddb2be,_0x445e7b,_0x36c44a){const _0x1d0297=_0x5696fc,_0x4d3b00={'context':_0xddb2be,'width':_0xddb2be['drawingBufferWidth'],'height':_0xddb2be['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_BYTE']},_0x1ae8b9={'context':_0xddb2be,'width':_0xddb2be[_0x1d0297(0x2b1)],'height':_0xddb2be['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_INT']},_0x7fad2=_0x36c44a['length'],_0x5822cd=new Float32Array(_0x7fad2*0x3);for(let _0x2736d8=0x0;_0x2736d8<_0x7fad2;_0x2736d8++){const _0x1869a3=Cesium$4['Color'][_0x1d0297(0x2b8)](_0x36c44a[_0x2736d8]);_0x5822cd[0x3*_0x2736d8]=_0x1869a3['red'],_0x5822cd[0x3*_0x2736d8+0x1]=_0x1869a3['green'],_0x5822cd[0x3*_0x2736d8+0x2]=_0x1869a3['blue'];}const _0x45e422={'context':_0xddb2be,'width':_0x7fad2,'height':0x1,'pixelFormat':Cesium$4['PixelFormat']['RGB'],'pixelDatatype':Cesium$4['PixelDatatype'][_0x1d0297(0x223)],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4[_0x1d0297(0x270)]['LINEAR'],'magnificationFilter':Cesium$4[_0x1d0297(0x2ab)]['LINEAR']})};this[_0x1d0297(0x2b7)]={'segmentsColor':Util[_0x1d0297(0x252)](_0x4d3b00),'segmentsDepth':Util[_0x1d0297(0x252)](_0x1ae8b9),'currentTrailsColor':Util['createTexture'](_0x4d3b00),'currentTrailsDepth':Util['createTexture'](_0x1ae8b9),'nextTrailsColor':Util['createTexture'](_0x4d3b00),'nextTrailsDepth':Util['createTexture'](_0x1ae8b9),'colorTable':Util['createTexture'](_0x45e422,_0x5822cd)};}['createRenderingFramebuffers'](_0x4ce651){const _0x55a6ae=_0x5696fc;this['framebuffers']={'segments':Util[_0x55a6ae(0x22d)](_0x4ce651,this[_0x55a6ae(0x2b7)]['segmentsColor'],this[_0x55a6ae(0x2b7)]['segmentsDepth']),'currentTrails':Util['createFramebuffer'](_0x4ce651,this['textures']['currentTrailsColor'],this['textures'][_0x55a6ae(0x275)]),'nextTrails':Util['createFramebuffer'](_0x4ce651,this['textures']['nextTrailsColor'],this[_0x55a6ae(0x2b7)][_0x55a6ae(0x262)])};}[_0x5696fc(0x2b6)](_0x5dcf69){const _0x39edb7=_0x5696fc,_0x48ac43=0x4;let _0x389256=[];for(let _0xb40a81=0x0;_0xb40a81<_0x5dcf69[_0x39edb7(0x2c8)];_0xb40a81++){for(let _0x3ba937=0x0;_0x3ba937<_0x5dcf69['particlesTextureSize'];_0x3ba937++){for(let _0x2919d8=0x0;_0x2919d8<_0x48ac43;_0x2919d8++){_0x389256['push'](_0xb40a81/_0x5dcf69['particlesTextureSize']),_0x389256['push'](_0x3ba937/_0x5dcf69[_0x39edb7(0x2c8)]);}}}_0x389256=new Float32Array(_0x389256);let _0x30c9f3=[];const _0x1bac3f=[-0x1,0x1],_0x42574d=[-0x1,0x1];for(let _0x5ef626=0x0;_0x5ef626<_0x5dcf69[_0x39edb7(0x2c3)];_0x5ef626++){for(let _0x563486=0x0;_0x563486<_0x48ac43/0x2;_0x563486++){for(let _0x47365d=0x0;_0x47365d<_0x48ac43/0x2;_0x47365d++){_0x30c9f3['push'](_0x1bac3f[_0x563486]),_0x30c9f3['push'](_0x42574d[_0x47365d]),_0x30c9f3['push'](0x0);}}}_0x30c9f3=new Float32Array(_0x30c9f3);const _0x2cbcf0=0x6*_0x5dcf69['maxParticles'],_0x23acc8=new Uint32Array(_0x2cbcf0);for(let _0x4ce235=0x0,_0x53b51e=0x0,_0x2c3d38=0x0;_0x4ce235<_0x5dcf69['maxParticles'];_0x4ce235++){_0x23acc8[_0x53b51e++]=_0x2c3d38+0x0,_0x23acc8[_0x53b51e++]=_0x2c3d38+0x1,_0x23acc8[_0x53b51e++]=_0x2c3d38+0x2,_0x23acc8[_0x53b51e++]=_0x2c3d38+0x2,_0x23acc8[_0x53b51e++]=_0x2c3d38+0x1,_0x23acc8[_0x53b51e++]=_0x2c3d38+0x3,_0x2c3d38+=0x4;}const _0x25e12a=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype'][_0x39edb7(0x223)],'componentsPerAttribute':0x2,'values':_0x389256}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype'][_0x39edb7(0x223)],'componentsPerAttribute':0x3,'values':_0x30c9f3})}),'indices':_0x23acc8});return _0x25e12a;}['createRenderingPrimitives'](_0x246bcf,_0x46957c,_0x2223a0,_0x48cb8e){const _0x3f44fe=_0x5696fc,_0x15d400=this;this['primitives']={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x46957c),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function(){const _0x257b35=_0x3d7c;return _0x48cb8e['particlesTextures'][_0x257b35(0x25e)];},'postProcessingPosition':function(){return _0x48cb8e['particlesTextures']['postProcessingPosition'];},'postProcessingSpeed':function(){const _0x5be453=_0x3d7c;return _0x48cb8e[_0x5be453(0x1f8)]['postProcessingSpeed'];},'colorTable':function(){const _0x35f6fb=_0x3d7c;return _0x15d400['textures'][_0x35f6fb(0x2a3)];},'aspect':function(){const _0x51ad11=_0x3d7c;return _0x246bcf[_0x51ad11(0x2b1)]/_0x246bcf[_0x51ad11(0x249)];},'pixelSize':function(){return _0x2223a0['pixelSize'];},'lineWidth':function(){return _0x46957c['lineWidth'];},'particleHeight':function(){return _0x46957c['particleHeight'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util[_0x3f44fe(0x22e)]({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers'][_0x3f44fe(0x297)],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':_0x3f44fe(0x20f),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){const _0x2c29de=_0x3f44fe;return _0x15d400[_0x2c29de(0x2b7)]['segmentsColor'];},'segmentsDepthTexture':function(){const _0x585242=_0x3f44fe;return _0x15d400[_0x585242(0x2b7)]['segmentsDepth'];},'currentTrailsColor':function(){const _0x29bd5f=_0x3f44fe;return _0x15d400['framebuffers']['currentTrails'][_0x29bd5f(0x2c9)](0x0);},'trailsDepthTexture':function(){const _0x37a396=_0x3f44fe;return _0x15d400['framebuffers']['currentTrails'][_0x37a396(0x283)];},'fadeOpacity':function(){return _0x46957c['fadeOpacity'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this[_0x3f44fe(0x226)]['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x2f9742=_0x3f44fe,_0x39d355=_0x15d400['framebuffers']['currentTrails'];_0x15d400['framebuffers']['currentTrails']=_0x15d400[_0x2f9742(0x226)][_0x2f9742(0x1f0)],_0x15d400['framebuffers']['nextTrails']=_0x39d355,_0x15d400['primitives'][_0x2f9742(0x29c)]['commandToExecute']['framebuffer']=_0x15d400['framebuffers']['nextTrails'],_0x15d400[_0x2f9742(0x25a)][_0x2f9742(0x29c)]['clearCommand'][_0x2f9742(0x244)]=_0x15d400['framebuffers'][_0x2f9742(0x1f0)];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'trailsColorTexture':function(){const _0x2e7c20=_0x3f44fe;return _0x15d400['framebuffers']['nextTrails'][_0x2e7c20(0x2c9)](0x0);},'trailsDepthTexture':function(){return _0x15d400['framebuffers']['nextTrails']['depthTexture'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x3f44fe(0x21e)],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag='//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a',updateSpeed_frag=_0x5696fc(0x28b),updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace['Cesium'];class ParticlesComputing{constructor(_0xb45c18,_0x10a4ff,_0x321749,_0xc29976){const _0x4a91ab=_0x5696fc;this['data']=_0x10a4ff,this['createWindTextures'](_0xb45c18,_0x10a4ff),this[_0x4a91ab(0x2cc)](_0xb45c18,_0x321749,_0xc29976),this[_0x4a91ab(0x263)](_0x10a4ff,_0x321749,_0xc29976);}[_0x5696fc(0x234)](_0x5c23b8,_0x5493b9){const _0x452125=_0x5696fc,_0x148c20={'context':_0x5c23b8,'width':_0x5493b9['dimensions']['lon'],'height':_0x5493b9[_0x452125(0x1ec)][_0x452125(0x1ff)]*(_0x5493b9['dimensions'][_0x452125(0x271)]||0x1),'pixelFormat':Cesium$3['PixelFormat'][_0x452125(0x29b)],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter'][_0x452125(0x24f)],'magnificationFilter':Cesium$3[_0x452125(0x2ab)]['NEAREST']})};this['windTextures']={'U':Util[_0x452125(0x252)](_0x148c20,_0x5493b9['U'][_0x452125(0x2cf)]),'V':Util[_0x452125(0x252)](_0x148c20,_0x5493b9['V']['array'])};}['createParticlesTextures'](_0x1ac225,_0x29f759,_0x4abb56){const _0x349df6=_0x5696fc,_0x4d7546={'context':_0x1ac225,'width':_0x29f759['particlesTextureSize'],'height':_0x29f759['particlesTextureSize'],'pixelFormat':Cesium$3[_0x349df6(0x20c)]['RGBA'],'pixelDatatype':Cesium$3[_0x349df6(0x253)][_0x349df6(0x223)],'flipY':![],'sampler':new Cesium$3[(_0x349df6(0x295))]({'minificationFilter':Cesium$3[_0x349df6(0x270)]['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})},_0x28a422=this['randomizeParticles'](_0x29f759['maxParticles'],_0x4abb56),_0xf65e15=new Float32Array(0x4*_0x29f759['maxParticles'])['fill'](0x0);this['particlesTextures']={'particlesWind':Util[_0x349df6(0x252)](_0x4d7546),'currentParticlesPosition':Util['createTexture'](_0x4d7546,_0x28a422),'nextParticlesPosition':Util['createTexture'](_0x4d7546,_0x28a422),'currentParticlesSpeed':Util[_0x349df6(0x252)](_0x4d7546,_0xf65e15),'nextParticlesSpeed':Util['createTexture'](_0x4d7546,_0xf65e15),'postProcessingPosition':Util['createTexture'](_0x4d7546,_0x28a422),'postProcessingSpeed':Util[_0x349df6(0x252)](_0x4d7546,_0xf65e15)};}['randomizeParticles'](_0x35458b,_0x22344d){const _0x3e4e45=_0x5696fc,_0xf7e905=new Float32Array(0x4*_0x35458b);for(let _0x503096=0x0;_0x503096<_0x35458b;_0x503096++){_0xf7e905[0x4*_0x503096]=Cesium$3['Math']['randomBetween'](_0x22344d[_0x3e4e45(0x29d)]['x'],_0x22344d['lonRange']['y']),_0xf7e905[0x4*_0x503096+0x1]=Cesium$3['Math'][_0x3e4e45(0x282)](_0x22344d['latRange']['x'],_0x22344d['latRange']['y']),_0xf7e905[0x4*_0x503096+0x2]=Cesium$3[_0x3e4e45(0x225)][_0x3e4e45(0x282)](this['data']['lev']['min'],this[_0x3e4e45(0x265)]['lev']['max']),_0xf7e905[0x4*_0x503096+0x3]=0x0;}return _0xf7e905;}['destroyParticlesTextures'](){Object['keys'](this['particlesTextures'])['forEach'](_0x11ec56=>{const _0x29f583=_0x3d7c;this['particlesTextures'][_0x11ec56][_0x29f583(0x24b)]();});}[_0x5696fc(0x263)](_0x406155,_0x2ee4fb,_0x168496){const _0x57b66d=_0x5696fc,_0x12643e=new Cesium$3['Cartesian3'](_0x406155['dimensions']['lon'],_0x406155['dimensions'][_0x57b66d(0x1ff)],_0x406155[_0x57b66d(0x1ec)]['lev']),_0x3998ac=new Cesium$3['Cartesian3'](_0x406155[_0x57b66d(0x2a1)][_0x57b66d(0x287)],_0x406155[_0x57b66d(0x1ff)]['min'],_0x406155['lev']['min']),_0x447d42=new Cesium$3['Cartesian3'](_0x406155[_0x57b66d(0x2a1)][_0x57b66d(0x256)],_0x406155['lat']['max'],_0x406155[_0x57b66d(0x271)]['max']),_0x59c876=new Cesium$3['Cartesian3']((_0x447d42['x']-_0x3998ac['x'])/(_0x12643e['x']-0x1),(_0x447d42['y']-_0x3998ac['y'])/(_0x12643e['y']-0x1),_0x12643e['z']>0x1?(_0x447d42['z']-_0x3998ac['z'])/(_0x12643e['z']-0x1):0x1),_0x5e81d3=new Cesium$3['Cartesian2'](_0x406155['U']['min'],_0x406155['U'][_0x57b66d(0x256)]),_0x2d3faa=new Cesium$3['Cartesian2'](_0x406155['V']['min'],_0x406155['V']['max']),_0x57cb04=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':_0x57b66d(0x1ef),'uniformMap':{'U':function(){return _0x57cb04['windTextures']['U'];},'V':function(){const _0x591291=_0x57b66d;return _0x57cb04[_0x591291(0x20d)]['V'];},'currentParticlesPosition':function(){const _0x1feabf=_0x57b66d;return _0x57cb04['particlesTextures'][_0x1feabf(0x25e)];},'dimension':function(){return _0x12643e;},'minimum':function(){return _0x3998ac;},'maximum':function(){return _0x447d42;},'interval':function(){return _0x59c876;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures']['particlesWind'],'preExecute':function(){const _0x25b264=_0x57b66d;_0x57cb04[_0x25b264(0x25a)]['getWind']['commandToExecute']['outputTexture']=_0x57cb04['particlesTextures'][_0x25b264(0x23e)];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){const _0x9e2a24=_0x57b66d;return _0x57cb04['particlesTextures'][_0x9e2a24(0x2be)];},'particlesWind':function(){return _0x57cb04['particlesTextures']['particlesWind'];},'uSpeedRange':function(){return _0x5e81d3;},'vSpeedRange':function(){return _0x2d3faa;},'pixelSize':function(){return _0x168496['pixelSize'];},'speedFactor':function(){return _0x2ee4fb['speedFactor'];}},'fragmentShaderSource':new Cesium$3[(_0x57b66d(0x20e))]({'sources':[updateSpeed_frag]}),'outputTexture':this[_0x57b66d(0x1f8)]['nextParticlesSpeed'],'preExecute':function(){const _0x4ce0ed=_0x57b66d,_0xa23567=_0x57cb04['particlesTextures']['currentParticlesSpeed'];_0x57cb04['particlesTextures'][_0x4ce0ed(0x2be)]=_0x57cb04['particlesTextures']['postProcessingSpeed'],_0x57cb04['particlesTextures']['postProcessingSpeed']=_0xa23567,_0x57cb04[_0x4ce0ed(0x25a)]['updateSpeed']['commandToExecute'][_0x4ce0ed(0x1f6)]=_0x57cb04['particlesTextures'][_0x4ce0ed(0x206)];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){return _0x57cb04['particlesTextures']['currentParticlesPosition'];},'currentParticlesSpeed':function(){return _0x57cb04['particlesTextures']['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3[(_0x57b66d(0x20e))]({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures']['nextParticlesPosition'],'preExecute':function(){const _0xe21cfb=_0x57b66d,_0x2e9b4b=_0x57cb04['particlesTextures']['currentParticlesPosition'];_0x57cb04[_0xe21cfb(0x1f8)][_0xe21cfb(0x25e)]=_0x57cb04['particlesTextures'][_0xe21cfb(0x1f1)],_0x57cb04[_0xe21cfb(0x1f8)]['postProcessingPosition']=_0x2e9b4b,_0x57cb04['primitives']['updatePosition'][_0xe21cfb(0x255)][_0xe21cfb(0x1f6)]=_0x57cb04[_0xe21cfb(0x1f8)]['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){return _0x57cb04['particlesTextures']['nextParticlesPosition'];},'nextParticlesSpeed':function(){const _0x5e4fd4=_0x57b66d;return _0x57cb04[_0x5e4fd4(0x1f8)]['nextParticlesSpeed'];},'lonRange':function(){return _0x168496['lonRange'];},'latRange':function(){return _0x168496['latRange'];},'randomCoefficient':function(){const _0x5b9875=Math['random']();return _0x5b9875;},'dropRate':function(){return _0x2ee4fb['dropRate'];},'dropRateBump':function(){return _0x2ee4fb['dropRateBump'];}},'fragmentShaderSource':new Cesium$3[(_0x57b66d(0x20e))]({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures']['postProcessingPosition'],'preExecute':function(){const _0x58f7bb=_0x57b66d;_0x57cb04['primitives']['postProcessingPosition']['commandToExecute'][_0x58f7bb(0x1f6)]=_0x57cb04[_0x58f7bb(0x1f8)]['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'postProcessingPosition':function(){return _0x57cb04['particlesTextures']['postProcessingPosition'];},'nextParticlesSpeed':function(){return _0x57cb04['particlesTextures']['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this[_0x57b66d(0x1f8)]['postProcessingSpeed'],'preExecute':function(){_0x57cb04['primitives']['postProcessingSpeed']['commandToExecute']['outputTexture']=_0x57cb04['particlesTextures']['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace['Cesium'];class ParticleSystem{constructor(_0x16d2bf,_0x72fa8c,_0x40dc3f,_0x375453){const _0x2e945c=_0x5696fc;this[_0x2e945c(0x277)]=_0x16d2bf,_0x72fa8c={..._0x72fa8c},_0x72fa8c['udata']&&_0x72fa8c['vdata']&&(_0x72fa8c['dimensions']={},_0x72fa8c[_0x2e945c(0x1ec)]['lon']=_0x72fa8c['cols'],_0x72fa8c['dimensions']['lat']=_0x72fa8c['rows'],_0x72fa8c['dimensions']['lev']=_0x72fa8c['lev']||0x1,_0x72fa8c[_0x2e945c(0x2a1)]={},_0x72fa8c['lon'][_0x2e945c(0x287)]=_0x72fa8c['xmin'],_0x72fa8c[_0x2e945c(0x2a1)]['max']=_0x72fa8c['xmax'],_0x72fa8c[_0x2e945c(0x1ff)]={},_0x72fa8c['lat']['min']=_0x72fa8c['ymin'],_0x72fa8c[_0x2e945c(0x1ff)]['max']=_0x72fa8c['ymax'],_0x72fa8c['lev']={},_0x72fa8c[_0x2e945c(0x271)]['min']=_0x72fa8c[_0x2e945c(0x2b4)]??0x1,_0x72fa8c['lev']['max']=_0x72fa8c['levmax']??0x1,_0x72fa8c['U']={},_0x72fa8c['U'][_0x2e945c(0x2cf)]=new Float32Array(_0x72fa8c[_0x2e945c(0x25f)]),_0x72fa8c['U']['min']=_0x72fa8c['umin']??Math['min'](..._0x72fa8c['udata']),_0x72fa8c['U'][_0x2e945c(0x256)]=_0x72fa8c['umax']??Math['max'](..._0x72fa8c['udata']),_0x72fa8c['V']={},_0x72fa8c['V']['array']=new Float32Array(_0x72fa8c[_0x2e945c(0x254)]),_0x72fa8c['V']['min']=_0x72fa8c['vmin']??Math['min'](..._0x72fa8c['vdata']),_0x72fa8c['V']['max']=_0x72fa8c['vmax']??Math['max'](..._0x72fa8c['vdata'])),this['data']=_0x72fa8c,this[_0x2e945c(0x26c)]=_0x40dc3f,this[_0x2e945c(0x2c5)]=_0x375453,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this[_0x2e945c(0x26c)],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this[_0x2e945c(0x265)],this['options'],this['viewerParameters'],this['particlesComputing']);}['canvasResize'](_0x406a88){const _0x5429a2=_0x5696fc;this['particlesComputing'][_0x5429a2(0x1f5)](),Object['keys'](this['particlesComputing']['windTextures'])['forEach'](_0x40de9e=>{this['particlesComputing']['windTextures'][_0x40de9e]['destroy']();}),this['particlesRendering']['textures']['colorTable']['destroy'](),Object['keys'](this[_0x5429a2(0x233)]['framebuffers'])[_0x5429a2(0x20b)](_0x51e385=>{const _0x5b95e4=_0x5429a2;this[_0x5b95e4(0x233)]['framebuffers'][_0x51e385]['destroy']();}),this['context']=_0x406a88,this[_0x5429a2(0x251)]=new ParticlesComputing(this['context'],this['data'],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this[_0x5429a2(0x26c)],this[_0x5429a2(0x2c5)],this['particlesComputing']);}['clearFramebuffers'](){const _0x4a8036=_0x5696fc,_0x40afc9=new Cesium$2['ClearCommand']({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass']['OPAQUE']});Object['keys'](this[_0x4a8036(0x233)][_0x4a8036(0x226)])['forEach'](_0x471b3f=>{const _0x5c8e4e=_0x4a8036;_0x40afc9['framebuffer']=this['particlesRendering']['framebuffers'][_0x471b3f],_0x40afc9[_0x5c8e4e(0x23b)](this['context']);});}['refreshParticles'](_0x363a94){const _0x12fe63=_0x5696fc;this['clearFramebuffers'](),this['particlesComputing']['destroyParticlesTextures'](),this['particlesComputing'][_0x12fe63(0x2cc)](this[_0x12fe63(0x277)],this['options'],this['viewerParameters']);if(_0x363a94){var _0x1dda9c;const _0x5f21ff=this['particlesRendering']['createSegmentsGeometry'](this['options']);this['particlesRendering']['primitives']['segments'][_0x12fe63(0x2c0)]=_0x5f21ff;const _0x2cbc46=Cesium$2['VertexArray']['fromGeometry']({'context':this[_0x12fe63(0x277)],'geometry':_0x5f21ff,'attributeLocations':this['particlesRendering']['primitives']['segments']['attributeLocations'],'bufferUsage':Cesium$2[_0x12fe63(0x21d)]['STATIC_DRAW']});(_0x1dda9c=this['particlesRendering']['primitives'])!==null&&_0x1dda9c!==void 0x0&&(_0x1dda9c=_0x1dda9c[_0x12fe63(0x297)])!==null&&_0x1dda9c!==void 0x0&&_0x1dda9c['commandToExecute']&&(this[_0x12fe63(0x233)]['primitives']['segments'][_0x12fe63(0x255)]['vertexArray']=_0x2cbc46);}}['setOptions'](_0x372112){const _0x1addc1=_0x5696fc;let _0xb8c4b6=![];this['options']['maxParticles']!==_0x372112['maxParticles']&&(_0xb8c4b6=!![]),Object['keys'](_0x372112)[_0x1addc1(0x20b)](_0x91427c=>{this['options'][_0x91427c]=_0x372112[_0x91427c];}),this['refreshParticles'](_0xb8c4b6);}['applyViewerParameters'](_0x1a6341){Object['keys'](_0x1a6341)['forEach'](_0x31734b=>{this['viewerParameters'][_0x31734b]=_0x1a6341[_0x31734b];}),this['refreshParticles'](![]);}[_0x5696fc(0x24b)](){const _0xe43515=_0x5696fc;clearTimeout(this[_0xe43515(0x2ae)]),this[_0xe43515(0x251)]['destroyParticlesTextures'](),Object['keys'](this['particlesComputing']['windTextures'])[_0xe43515(0x20b)](_0x20a7e9=>{const _0x21f071=_0xe43515;this['particlesComputing'][_0x21f071(0x20d)][_0x20a7e9]['destroy']();}),this['particlesRendering'][_0xe43515(0x2b7)][_0xe43515(0x2a3)]['destroy'](),Object['keys'](this['particlesRendering']['framebuffers'])[_0xe43515(0x20b)](_0x17984c=>{this['particlesRendering']['framebuffers'][_0x17984c]['destroy']();});for(const _0x2471a4 in this){delete this[_0x2471a4];}}}const Cesium$1=mars3d__namespace[_0x5696fc(0x1f4)],BaseLayer$1=mars3d__namespace['layer']['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':[_0x5696fc(0x28e)]};class WindLayer extends BaseLayer$1{constructor(_0x1901cc={}){const _0x5dc935=_0x5696fc;_0x1901cc={...DEF_OPTIONS,..._0x1901cc},super(_0x1901cc),this[_0x5dc935(0x2bb)](_0x1901cc);}get['layer'](){return this['primitives'];}get['data'](){return this['_data'];}set['data'](_0xd76c39){const _0x52dcf5=_0x5696fc;this[_0x52dcf5(0x290)](_0xd76c39);}get['colors'](){return this['options']['colors'];}set[_0x5696fc(0x26e)](_0x52ef44){const _0x49753e=_0x5696fc;this['options'][_0x49753e(0x26e)]=_0x52ef44,this['particleSystem']&&this['particleSystem'][_0x49753e(0x2b3)]({'colors':_0x52ef44}),this['resize']();}['_mountedHook'](){}[_0x5696fc(0x276)](){const _0x42e081=_0x5696fc;this['scene']=this['_map'][_0x42e081(0x25d)],this[_0x42e081(0x240)]=this[_0x42e081(0x217)]['camera'],this['primitives']=new Cesium$1[(_0x42e081(0x266))](),this['_map']['scene'][_0x42e081(0x25a)]['add'](this[_0x42e081(0x25a)]),this['viewerParameters']={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1[(_0x42e081(0x205))](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1['BoundingSphere'](Cesium$1['Cartesian3']['ZERO'],0.99*0x615299),this[_0x42e081(0x260)](),window['addEventListener']('resize',this['resize']['bind'](this),![]),this[_0x42e081(0x1fc)]=![],this['mouse_move']=![],this['_map']['on'](mars3d__namespace['EventType'][_0x42e081(0x2a0)],this['_onMapWhellEvent'],this),this[_0x42e081(0x217)]['on'](mars3d__namespace['EventType'][_0x42e081(0x21c)],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this[_0x42e081(0x217)]['on'](mars3d__namespace['EventType'][_0x42e081(0x2c6)],this['_onMouseMoveEvent'],this),this['_data']&&this['setData'](this['_data']);}[_0x5696fc(0x200)](){const _0x502c63=_0x5696fc;window['removeEventListener']('resize',this['resize']),this[_0x502c63(0x217)]['off'](mars3d__namespace[_0x502c63(0x2bf)]['preRender'],this[_0x502c63(0x238)],this),this['_map'][_0x502c63(0x1f3)](mars3d__namespace[_0x502c63(0x2bf)][_0x502c63(0x2a0)],this['_onMapWhellEvent'],this),this[_0x502c63(0x217)][_0x502c63(0x1f3)](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace[_0x502c63(0x2bf)]['mouseUp'],this[_0x502c63(0x214)],this),this['_map']['off'](mars3d__namespace[_0x502c63(0x2bf)]['mouseMove'],this[_0x502c63(0x27a)],this),this[_0x502c63(0x25a)]['removeAll'](),this['_map']['scene']['primitives']['remove'](this['primitives']);}['resize'](){const _0x5dbf47=_0x5696fc;if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this['primitives'][_0x5dbf47(0x2b0)](),this[_0x5dbf47(0x217)]['once'](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this);}[_0x5696fc(0x238)](_0x442700){const _0xc3674c=_0x5696fc;this['particleSystem']['canvasResize'](this['scene'][_0xc3674c(0x277)]),this['addPrimitives'](),this[_0xc3674c(0x25a)]['show']=!![];}['_onMapWhellEvent'](_0x5c85ce){const _0xb8f13=_0x5696fc;clearTimeout(this['refreshTimer']);if(!this['show']||!this[_0xb8f13(0x2a6)])return;this['primitives'][_0xb8f13(0x23d)]=![],this['refreshTimer']=setTimeout(()=>{const _0x20d241=_0xb8f13;if(!this[_0x20d241(0x23d)])return;this['redraw']();},0xc8);}['_onMouseDownEvent'](_0x624bb7){this['mouse_down']=!![];}['_onMouseMoveEvent'](_0xdd1005){const _0x30fa98=_0x5696fc;if(!this['show']||!this[_0x30fa98(0x2a6)])return;this[_0x30fa98(0x1fc)]&&(this[_0x30fa98(0x25a)][_0x30fa98(0x23d)]=![],this['mouse_move']=!![]);}[_0x5696fc(0x214)](_0x244f49){const _0x58134d=_0x5696fc;if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['primitives']['show']=!![],this['mouse_down']=![],this[_0x58134d(0x29e)]=![];}[_0x5696fc(0x291)](){const _0x4b23f4=_0x5696fc;if(!this[_0x4b23f4(0x217)]||!this[_0x4b23f4(0x23d)])return;this[_0x4b23f4(0x260)](),this['particleSystem']['applyViewerParameters'](this['viewerParameters']),this[_0x4b23f4(0x25a)]['show']=!![];}[_0x5696fc(0x290)](_0x756a7d){const _0x4fc427=_0x5696fc;this[_0x4fc427(0x2d2)]=_0x756a7d,this['particleSystem']&&this['particleSystem']['destroy'](),this[_0x4fc427(0x2a6)]=new ParticleSystem(this['scene']['context'],_0x756a7d,this[_0x4fc427(0x26d)](),this[_0x4fc427(0x2c5)]),this['addPrimitives']();}['_setOptionsHook'](_0x269451,_0xa82530){const _0x323c42=_0x5696fc;if(_0x269451)for(const _0x371748 in _0x269451){this[_0x371748]=_0x269451[_0x371748];}this['particleSystem']&&this[_0x323c42(0x2a6)]['setOptions'](this['getOptions']());}['getOptions'](){const _0x241225=_0x5696fc,_0xc51146=Math[_0x241225(0x216)](Math['sqrt'](this['particlesNumber']));return this[_0x241225(0x292)]=_0xc51146*_0xc51146,{'particlesTextureSize':_0xc51146,'maxParticles':this['particlesNumber'],'particleHeight':this['fixedHeight'],'fadeOpacity':this['fadeOpacity'],'dropRate':this['dropRate'],'dropRateBump':this['dropRateBump'],'speedFactor':this['speedFactor'],'lineWidth':this['lineWidth'],'colors':this[_0x241225(0x26e)]};}['addPrimitives'](){const _0x2eb922=_0x5696fc;this[_0x2eb922(0x25a)]['add'](this['particleSystem']['particlesComputing']['primitives']['getWind']),this[_0x2eb922(0x25a)]['add'](this['particleSystem']['particlesComputing']['primitives'][_0x2eb922(0x204)]),this[_0x2eb922(0x25a)]['add'](this['particleSystem'][_0x2eb922(0x251)]['primitives']['updatePosition']),this['primitives']['add'](this[_0x2eb922(0x2a6)]['particlesComputing']['primitives'][_0x2eb922(0x1f1)]),this[_0x2eb922(0x25a)]['add'](this['particleSystem']['particlesComputing']['primitives']['postProcessingSpeed']),this['primitives']['add'](this['particleSystem']['particlesRendering'][_0x2eb922(0x25a)]['segments']),this['primitives']['add'](this[_0x2eb922(0x2a6)][_0x2eb922(0x233)]['primitives']['trails']),this[_0x2eb922(0x25a)][_0x2eb922(0x28c)](this['particleSystem'][_0x2eb922(0x233)][_0x2eb922(0x25a)]['screen']);}['updateViewerParameters'](){const _0x2a53d0=_0x5696fc;let _0x359fdc=this['camera'][_0x2a53d0(0x2a7)](this['scene']['globe'][_0x2a53d0(0x242)]);if(!_0x359fdc){const _0x1ed470=this['_map'][_0x2a53d0(0x28a)]();_0x359fdc=Cesium$1['Rectangle']['fromDegrees'](_0x1ed470['xmin'],_0x1ed470['ymin'],_0x1ed470['xmax'],_0x1ed470['ymax']);}const _0x10c2ee=Util['viewRectangleToLonLatRange'](_0x359fdc);this['viewerParameters']['lonRange']['x']=_0x10c2ee[_0x2a53d0(0x2a1)]['min'],this['viewerParameters'][_0x2a53d0(0x29d)]['y']=_0x10c2ee['lon']['max'],this['viewerParameters']['latRange']['x']=_0x10c2ee['lat']['min'],this[_0x2a53d0(0x2c5)]['latRange']['y']=_0x10c2ee['lat'][_0x2a53d0(0x256)];const _0x4bd115=this['camera']['getPixelSize'](this[_0x2a53d0(0x1ed)],this['scene'][_0x2a53d0(0x2b1)],this['scene']['drawingBufferHeight']);_0x4bd115>0x0&&(this['viewerParameters']['pixelSize']=_0x4bd115);}}mars3d__namespace['LayerUtil'][_0x5696fc(0x286)]('wind',WindLayer),mars3d__namespace[_0x5696fc(0x229)][_0x5696fc(0x22f)]=WindLayer;class CanvasParticle{constructor(){const _0x3a34a6=_0x5696fc;this['lng']=null,this['lat']=null,this['tlng']=null,this[_0x3a34a6(0x208)]=null,this['age']=null,this['speed']=null;}['destroy'](){for(const _0x1b9c5c in this){delete this[_0x1b9c5c];}}}class CanvasWindField{constructor(_0x4921fd){this['setOptions'](_0x4921fd);}get['speedRate'](){const _0x18a0a4=_0x5696fc;return this[_0x18a0a4(0x23c)];}set['speedRate'](_0x47ae24){const _0xae0ea1=_0x5696fc;this['_speedRate']=(0x64-(_0x47ae24>0x63?0x63:_0x47ae24))*0x64,this[_0xae0ea1(0x29a)]=[(this[_0xae0ea1(0x258)]-this['xmin'])/this['_speedRate'],(this['ymax']-this[_0xae0ea1(0x2bd)])/this['_speedRate']];}get[_0x5696fc(0x23f)](){const _0x1a3bf5=_0x5696fc;return this[_0x1a3bf5(0x22b)];}set['maxAge'](_0x344757){this['_maxAge']=_0x344757;}['setOptions'](_0x606646){const _0x2d2743=_0x5696fc;this['options']=_0x606646,this[_0x2d2743(0x23f)]=_0x606646['maxAge']||0x78,this['speedRate']=_0x606646[_0x2d2743(0x281)]||0x32,this['particles']=[];const _0x28106c=_0x606646[_0x2d2743(0x292)]||0x1000;for(let _0x58e7fd=0x0;_0x58e7fd<_0x28106c;_0x58e7fd++){const _0x294e42=this['_randomParticle'](new CanvasParticle());this[_0x2d2743(0x279)][_0x2d2743(0x1fa)](_0x294e42);}}['setDate'](_0x210621){const _0x18caa1=_0x5696fc;this['rows']=_0x210621['rows'],this['cols']=_0x210621[_0x18caa1(0x24d)],this['xmin']=_0x210621['xmin'],this['xmax']=_0x210621[_0x18caa1(0x258)],this[_0x18caa1(0x2bd)]=_0x210621['ymin'],this['ymax']=_0x210621['ymax'],this['grid']=[];const _0x221bad=_0x210621['udata'],_0x908755=_0x210621['vdata'];let _0x4a9201=![];_0x221bad['length']===this['rows']&&_0x221bad[0x0]['length']===this[_0x18caa1(0x24d)]&&(_0x4a9201=!![]);let _0x31b86f=0x0,_0x20711b=null,_0x45a705=null;for(let _0x2b531e=0x0;_0x2b531e<this[_0x18caa1(0x215)];_0x2b531e++){_0x20711b=[];for(let _0x3a4c3=0x0;_0x3a4c3<this[_0x18caa1(0x24d)];_0x3a4c3++,_0x31b86f++){_0x4a9201?_0x45a705=this[_0x18caa1(0x250)](_0x221bad[_0x2b531e][_0x3a4c3],_0x908755[_0x2b531e][_0x3a4c3]):_0x45a705=this['_calcUV'](_0x221bad[_0x31b86f],_0x908755[_0x31b86f]),_0x20711b[_0x18caa1(0x1fa)](_0x45a705);}this[_0x18caa1(0x24e)]['push'](_0x20711b);}this[_0x18caa1(0x26c)]['reverseY']&&this['grid']['reverse']();}[_0x5696fc(0x220)](){const _0x5ecec6=_0x5696fc;delete this[_0x5ecec6(0x215)],delete this['cols'],delete this['xmin'],delete this['xmax'],delete this['ymin'],delete this[_0x5ecec6(0x2ac)],delete this['grid'],delete this[_0x5ecec6(0x279)];}['toGridXY'](_0x993c69,_0x3cb476){const _0x7a2739=_0x5696fc,_0x4d6611=(_0x993c69-this['xmin'])/(this['xmax']-this['xmin'])*(this['cols']-0x1),_0x4cac56=(this['ymax']-_0x3cb476)/(this[_0x7a2739(0x2ac)]-this['ymin'])*(this['rows']-0x1);return[_0x4d6611,_0x4cac56];}['getUVByXY'](_0xdd61a7,_0x437c84){const _0x1f5ed6=_0x5696fc;if(_0xdd61a7<0x0||_0xdd61a7>=this[_0x1f5ed6(0x24d)]||_0x437c84>=this['rows'])return[0x0,0x0,0x0];const _0x491aab=Math[_0x1f5ed6(0x274)](_0xdd61a7),_0x52216f=Math[_0x1f5ed6(0x274)](_0x437c84);if(_0x491aab===_0xdd61a7&&_0x52216f===_0x437c84)return this[_0x1f5ed6(0x24e)][_0x437c84][_0xdd61a7];const _0x1c9198=_0x491aab+0x1,_0x4088d0=_0x52216f+0x1,_0x219575=this[_0x1f5ed6(0x299)](_0x491aab,_0x52216f),_0x33c945=this['getUVByXY'](_0x1c9198,_0x52216f),_0xf89141=this['getUVByXY'](_0x491aab,_0x4088d0),_0x2aafc2=this[_0x1f5ed6(0x299)](_0x1c9198,_0x4088d0);let _0x14387b=null;try{_0x14387b=this[_0x1f5ed6(0x209)](_0xdd61a7-_0x491aab,_0x437c84-_0x52216f,_0x219575,_0x33c945,_0xf89141,_0x2aafc2);}catch(_0x29d8ff){console[_0x1f5ed6(0x228)](_0xdd61a7,_0x437c84);}return _0x14387b;}[_0x5696fc(0x209)](_0x3c6e16,_0x4029ec,_0x37e48e,_0x19c43b,_0x156fdc,_0x589bf1){const _0x199044=0x1-_0x3c6e16,_0x2fe869=0x1-_0x4029ec,_0x5b476a=_0x199044*_0x2fe869,_0x541c33=_0x3c6e16*_0x2fe869,_0x515ebb=_0x199044*_0x4029ec,_0x4d2713=_0x3c6e16*_0x4029ec,_0x47704b=_0x37e48e[0x0]*_0x5b476a+_0x19c43b[0x0]*_0x541c33+_0x156fdc[0x0]*_0x515ebb+_0x589bf1[0x0]*_0x4d2713,_0x3f47fa=_0x37e48e[0x1]*_0x5b476a+_0x19c43b[0x1]*_0x541c33+_0x156fdc[0x1]*_0x515ebb+_0x589bf1[0x1]*_0x4d2713;return this['_calcUV'](_0x47704b,_0x3f47fa);}['_calcUV'](_0x5068a9,_0x2a3c69){const _0x26ef97=_0x5696fc;return[+_0x5068a9,+_0x2a3c69,Math[_0x26ef97(0x26b)](_0x5068a9*_0x5068a9+_0x2a3c69*_0x2a3c69)];}['getUVByPoint'](_0x35458c,_0xb82834){const _0x1032c1=_0x5696fc;if(!this[_0x1032c1(0x2cb)](_0x35458c,_0xb82834))return null;const _0x3dfcf6=this[_0x1032c1(0x2c1)](_0x35458c,_0xb82834),_0x218c71=this[_0x1032c1(0x299)](_0x3dfcf6[0x0],_0x3dfcf6[0x1]);return _0x218c71;}[_0x5696fc(0x2cb)](_0x23902c,_0x3a64dd){return _0x23902c>=this['xmin']&&_0x23902c<=this['xmax']&&_0x3a64dd>=this['ymin']&&_0x3a64dd<=this['ymax']?!![]:![];}[_0x5696fc(0x259)](){const _0xef91e=_0x5696fc,_0x4a6351=fRandomByfloat(this['xmin'],this['xmax']),_0x18deb7=fRandomByfloat(this[_0xef91e(0x2bd)],this['ymax']);return{'lat':_0x18deb7,'lng':_0x4a6351};}['getParticles'](){const _0x3b81fc=_0x5696fc;let _0x4b7256,_0x352fdc,_0x1f6d0b;for(let _0xb90048=0x0,_0x1b8d5c=this['particles'][_0x3b81fc(0x29f)];_0xb90048<_0x1b8d5c;_0xb90048++){let _0x434184=this[_0x3b81fc(0x279)][_0xb90048];_0x434184[_0x3b81fc(0x21a)]<=0x0&&(_0x434184=this[_0x3b81fc(0x294)](_0x434184));if(_0x434184[_0x3b81fc(0x21a)]>0x0){const _0x5995a7=_0x434184[_0x3b81fc(0x2ba)],_0x498af8=_0x434184['tlat'];_0x1f6d0b=this['getUVByPoint'](_0x5995a7,_0x498af8),_0x1f6d0b?(_0x4b7256=_0x5995a7+this['_calc_speedRate'][0x0]*_0x1f6d0b[0x0],_0x352fdc=_0x498af8+this['_calc_speedRate'][0x1]*_0x1f6d0b[0x1],_0x434184['lng']=_0x5995a7,_0x434184['lat']=_0x498af8,_0x434184['tlng']=_0x4b7256,_0x434184['tlat']=_0x352fdc,_0x434184[_0x3b81fc(0x21f)]=_0x1f6d0b[0x2],_0x434184['age']--):_0x434184['age']=0x0;}}return this[_0x3b81fc(0x279)];}[_0x5696fc(0x294)](_0x5d4209){const _0x51c891=_0x5696fc;let _0x586583,_0x59b6c5;for(let _0x28a6d6=0x0;_0x28a6d6<0x1e;_0x28a6d6++){_0x586583=this['getRandomLatLng'](),_0x59b6c5=this['getUVByPoint'](_0x586583[_0x51c891(0x231)],_0x586583['lat']);if(_0x59b6c5&&_0x59b6c5[0x2]>0x0)break;}if(!_0x59b6c5)return _0x5d4209;const _0x3aa87d=_0x586583[_0x51c891(0x231)]+this['_calc_speedRate'][0x0]*_0x59b6c5[0x0],_0x27c058=_0x586583['lat']+this['_calc_speedRate'][0x1]*_0x59b6c5[0x1];return _0x5d4209['lng']=_0x586583['lng'],_0x5d4209['lat']=_0x586583[_0x51c891(0x1ff)],_0x5d4209['tlng']=_0x3aa87d,_0x5d4209['tlat']=_0x27c058,_0x5d4209['age']=Math[_0x51c891(0x245)](Math['random']()*this[_0x51c891(0x23f)]),_0x5d4209['speed']=_0x59b6c5[0x2],_0x5d4209;}['destroy'](){for(const _0x5bc4e0 in this){delete this[_0x5bc4e0];}}}function fRandomByfloat(_0x13e1f5,_0x4b2bf0){const _0x303c55=_0x5696fc;return _0x13e1f5+Math[_0x303c55(0x1fe)]()*(_0x4b2bf0-_0x13e1f5);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer']['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0x56482c={}){super(_0x56482c),this['_setOptionsHook'](_0x56482c),this['canvas']=null,_0x56482c['colors']&&_0x56482c['steps']&&(this['_colorRamp']=new mars3d__namespace['ColorRamp'](_0x56482c));}['_setOptionsHook'](_0x54cedc,_0x4c1a28){const _0xe8f6ec=_0x5696fc;this['frameTime']=0x3e8/(_0x54cedc['frameRate']||0xa),this[_0xe8f6ec(0x2a5)]=this[_0xe8f6ec(0x26c)]['pointerEvents']??![],this['color']=_0x54cedc['color']||'#ffffff',this['lineWidth']=_0x54cedc[_0xe8f6ec(0x298)]||0x1,this['fixedHeight']=_0x54cedc[_0xe8f6ec(0x24c)]??0x0,this['reverseY']=_0x54cedc['reverseY']??![],this[_0xe8f6ec(0x230)]&&this['windField']['setOptions'](_0x54cedc);}get['layer'](){const _0x1e5d38=_0x5696fc;return this[_0x1e5d38(0x257)];}get['canvasWidth'](){const _0x550ee5=_0x5696fc;return this['_map'][_0x550ee5(0x25d)][_0x550ee5(0x257)][_0x550ee5(0x213)];}get[_0x5696fc(0x1fb)](){return this['_map']['scene']['canvas']['clientHeight'];}get['pointerEvents'](){return this['_pointerEvents'];}set['pointerEvents'](_0x3b401d){const _0x2c2ab0=_0x5696fc;this['_pointerEvents']=_0x3b401d;if(!this['canvas'])return;_0x3b401d?this['canvas']['style'][_0x2c2ab0(0x269)]='all':this['canvas']['style']['pointer-events']='none';}get['particlesNumber'](){return this['options']['particlesNumber'];}set['particlesNumber'](_0x40a004){const _0x2a8550=_0x5696fc;this[_0x2a8550(0x26c)]['particlesNumber']=_0x40a004,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get['speedRate'](){const _0x1b9f47=_0x5696fc;return this['options'][_0x1b9f47(0x281)];}set['speedRate'](_0x19f318){const _0x3f5ad9=_0x5696fc;this['options']['speedRate']=_0x19f318,this['windField']&&(this[_0x3f5ad9(0x230)]['speedRate']=_0x19f318);}get['maxAge'](){return this['options']['maxAge'];}set[_0x5696fc(0x23f)](_0x4d55c8){const _0x4ca990=_0x5696fc;this['options'][_0x4ca990(0x23f)]=_0x4d55c8,this[_0x4ca990(0x230)]&&(this['windField']['maxAge']=_0x4d55c8);}get['data'](){return this['windData'];}set['data'](_0x1ca49f){this['setData'](_0x1ca49f);}['_showHook'](_0x3bd6e6){_0x3bd6e6?this['_addedHook']():(this['windData']&&(this['options']['data']=this['windData']),this['_removedHook']());}['_mountedHook'](){const _0x4127a2=_0x5696fc;this['options']['worker']?this[_0x4127a2(0x261)]():this[_0x4127a2(0x230)]=new CanvasWindField(this['options']);}['_addedHook'](){const _0x4c216e=_0x5696fc;this['canvas']=this['_createCanvas'](),this['canvasContext']=this['canvas']['getContext']('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this['options'][_0x4c216e(0x265)]&&this['setData'](this['options'][_0x4c216e(0x265)]);}['_removedHook'](){const _0x4e3137=_0x5696fc;this['clear'](),this[_0x4e3137(0x264)](),this['canvas']&&(this['_map']['container']['removeChild'](this['canvas']),delete this['canvas']);}['_createCanvas'](){const _0x376e1d=_0x5696fc,_0x3d5842=mars3d__namespace['DomUtil']['create']('canvas','mars3d-canvasWind',this[_0x376e1d(0x217)][_0x376e1d(0x222)]);return _0x3d5842['style']['position']='absolute',_0x3d5842['style']['top']='0px',_0x3d5842['style']['left']='0px',_0x3d5842['style']['width']=this['_map']['scene']['canvas']['clientWidth']+'px',_0x3d5842[_0x376e1d(0x27f)]['height']=this[_0x376e1d(0x217)]['scene']['canvas'][_0x376e1d(0x293)]+'px',_0x3d5842['style']['pointerEvents']=this['_pointerEvents']?_0x376e1d(0x2ad):_0x376e1d(0x2c4),_0x3d5842['style']['zIndex']=this['options'][_0x376e1d(0x203)]??0x9,_0x3d5842['width']=this['_map']['scene']['canvas']['clientWidth'],_0x3d5842['height']=this['_map']['scene']['canvas']['clientHeight'],_0x3d5842;}[_0x5696fc(0x211)](){const _0x340273=_0x5696fc;this['canvas']&&(this['canvas']['style']['width']=this[_0x340273(0x217)]['scene'][_0x340273(0x257)]['clientWidth']+'px',this['canvas'][_0x340273(0x27f)]['height']=this[_0x340273(0x217)]['scene']['canvas']['clientHeight']+'px',this[_0x340273(0x257)]['width']=this[_0x340273(0x217)]['scene'][_0x340273(0x257)]['clientWidth'],this[_0x340273(0x257)]['height']=this['_map']['scene']['canvas'][_0x340273(0x293)]);}['bindEvent'](){const _0x39eec7=_0x5696fc,_0x421197=this;let _0x55034a=Date['now']();(function _0x181e93(){const _0x1a6e40=_0x3d7c;_0x421197['animateFrame']=window['requestAnimationFrame'](_0x181e93);if(_0x421197[_0x1a6e40(0x23d)]&&_0x421197['windField']){const _0x195056=Date[_0x1a6e40(0x1eb)](),_0x30f655=_0x195056-_0x55034a;_0x30f655>_0x421197['frameTime']&&(_0x55034a=_0x195056-_0x30f655%_0x421197['frameTime'],_0x421197['update']());}}(),window['addEventListener']('resize',this['resize'][_0x39eec7(0x2d0)](this),![]),this['mouse_down']=![],this[_0x39eec7(0x29e)]=![],this['options']['mouseHidden']&&(this['_map']['on'](mars3d__namespace['EventType'][_0x39eec7(0x2a0)],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this[_0x39eec7(0x23a)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this)));}[_0x5696fc(0x264)](){const _0x2f9378=_0x5696fc;window['cancelAnimationFrame'](this[_0x2f9378(0x285)]),delete this['animateFrame'],window['removeEventListener']('resize',this['resize']),this['options']['mouseHidden']&&(this['_map']['off'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseDown'],this[_0x2f9378(0x23a)],this),this[_0x2f9378(0x217)]['off'](mars3d__namespace[_0x2f9378(0x2bf)]['mouseUp'],this['_onMouseUpEvent'],this),this[_0x2f9378(0x217)]['off'](mars3d__namespace[_0x2f9378(0x2bf)]['mouseMove'],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0x3b1c88){const _0x3028f7=_0x5696fc;clearTimeout(this['refreshTimer']);if(!this['show']||!this[_0x3028f7(0x257)])return;this[_0x3028f7(0x257)]['style'][_0x3028f7(0x24a)]=_0x3028f7(0x2bc),this['refreshTimer']=setTimeout(()=>{const _0x5423c=_0x3028f7;if(!this['show'])return;this['redraw'](),this['canvas'][_0x5423c(0x27f)]['visibility']='visible';},0xc8);}['_onMouseDownEvent'](_0x58fb3a){const _0x4ebea5=_0x5696fc;this['mouse_down']=!![],this['_map']['off'](mars3d__namespace['EventType'][_0x4ebea5(0x2c6)],this[_0x4ebea5(0x27a)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this);}[_0x5696fc(0x27a)](_0x58130d){const _0x1ec21c=_0x5696fc;if(!this['show']||!this['canvas'])return;this['mouse_down']&&(this['canvas']['style']['visibility']='hidden',this[_0x1ec21c(0x29e)]=!![]);}['_onMouseUpEvent'](_0x3fe323){const _0x1f8769=_0x5696fc;if(!this['show']||!this[_0x1f8769(0x257)])return;this['_map']['off'](mars3d__namespace[_0x1f8769(0x2bf)][_0x1f8769(0x2c6)],this['_onMouseMoveEvent'],this),this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['canvas']['style'][_0x1f8769(0x24a)]='visible',this['mouse_down']=![],this['mouse_move']=![];}['setData'](_0x34650d){const _0x3778bf=_0x5696fc;this['clear'](),this[_0x3778bf(0x288)]=_0x34650d,this['windField']['setDate'](_0x34650d),this['redraw']();}[_0x5696fc(0x291)](){const _0x15fb41=_0x5696fc;if(!this['show'])return;this['windField'][_0x15fb41(0x2b3)](this['options']),this['update']();}[_0x5696fc(0x1f9)](){const _0x1b9bed=_0x5696fc;if(this[_0x1b9bed(0x219)])return;this[_0x1b9bed(0x219)]=!![];if(this['worker'])this['windField'][_0x1b9bed(0x1f9)]();else{const _0x4fc958=this[_0x1b9bed(0x230)]['getParticles']();this['_drawLines'](_0x4fc958);}this['_updateIng']=![];}['_drawLines'](_0x5ccd51){const _0x198102=_0x5696fc;this['canvasContext']['globalCompositeOperation']='destination-in',this['canvasContext'][_0x198102(0x1fd)](0x0,0x0,this['canvasWidth'],this['canvasHeight']),this['canvasContext']['globalCompositeOperation']='lighter',this['canvasContext']['globalAlpha']=0.9;const _0x436add=this['_map'][_0x198102(0x25d)]['mode']!==Cesium['SceneMode']['SCENE3D'],_0x3d9dea=this['canvasWidth']*0.25;if(this[_0x198102(0x2b2)])for(let _0x1dcff5=0x0,_0x30412a=_0x5ccd51[_0x198102(0x29f)];_0x1dcff5<_0x30412a;_0x1dcff5++){const _0x240aa0=_0x5ccd51[_0x1dcff5],_0x13a9ec=this[_0x198102(0x272)](_0x240aa0['lng'],_0x240aa0['lat'],_0x240aa0),_0x3bb104=this['_tomap'](_0x240aa0['tlng'],_0x240aa0['tlat'],_0x240aa0);if(!_0x13a9ec||!_0x3bb104)continue;if(_0x436add&&Math['abs'](_0x13a9ec[0x0]-_0x3bb104[0x0])>=_0x3d9dea)continue;this['canvasContext']['beginPath'](),this[_0x198102(0x27b)]['lineWidth']=this['lineWidth'],this['canvasContext'][_0x198102(0x236)]=this['_colorRamp']['getColor'](_0x240aa0['speed']),this['canvasContext']['moveTo'](_0x13a9ec[0x0],_0x13a9ec[0x1]),this['canvasContext']['lineTo'](_0x3bb104[0x0],_0x3bb104[0x1]),this['canvasContext']['stroke']();}else{this['canvasContext']['beginPath'](),this['canvasContext']['lineWidth']=this['lineWidth'],this['canvasContext']['strokeStyle']=this['color'];for(let _0x1f4251=0x0,_0x5975e1=_0x5ccd51['length'];_0x1f4251<_0x5975e1;_0x1f4251++){const _0x28a6a1=_0x5ccd51[_0x1f4251],_0x52279d=this['_tomap'](_0x28a6a1['lng'],_0x28a6a1['lat'],_0x28a6a1),_0x1f771f=this['_tomap'](_0x28a6a1['tlng'],_0x28a6a1[_0x198102(0x208)],_0x28a6a1);if(!_0x52279d||!_0x1f771f)continue;if(_0x436add&&Math['abs'](_0x52279d[0x0]-_0x1f771f[0x0])>=_0x3d9dea)continue;this['canvasContext']['moveTo'](_0x52279d[0x0],_0x52279d[0x1]),this['canvasContext'][_0x198102(0x243)](_0x1f771f[0x0],_0x1f771f[0x1]);}this[_0x198102(0x27b)]['stroke']();}}['_tomap'](_0x29623d,_0x38a906,_0x54491d){const _0x2aa948=_0x5696fc,_0x40db46=Cesium[_0x2aa948(0x28f)]['fromDegrees'](_0x29623d,_0x38a906,this[_0x2aa948(0x24c)]),_0x2cacdf=this['_map']['scene'];if(_0x2cacdf[_0x2aa948(0x235)]===Cesium['SceneMode']['SCENE3D']){const _0xfa9c5f=new Cesium[(_0x2aa948(0x2a9))](_0x2cacdf['globe']['ellipsoid'],_0x2cacdf['camera'][_0x2aa948(0x2d3)]),_0x48e878=_0xfa9c5f[_0x2aa948(0x2c7)](_0x40db46);if(!_0x48e878)return _0x54491d[_0x2aa948(0x21a)]=0x0,null;}const _0x4cf770=Cesium['SceneTransforms']['wgs84ToWindowCoordinates'](this[_0x2aa948(0x217)]['scene'],_0x40db46);return _0x4cf770?[_0x4cf770['x'],_0x4cf770['y']]:null;}['clear'](){const _0x23654c=_0x5696fc;this[_0x23654c(0x230)]['clear'](),delete this['windData'];}[_0x5696fc(0x261)](){const _0x38ffb8=_0x5696fc;this['worker']=new Worker(this[_0x38ffb8(0x26c)]['worker']),this[_0x38ffb8(0x2aa)][_0x38ffb8(0x2b9)]=_0x564bbb=>{const _0x13004e=_0x38ffb8;this['_drawLines'](_0x564bbb[_0x13004e(0x265)]['particles']),this[_0x13004e(0x2a8)]=![];},this['windField']={'init':_0x1e589d=>{this['worker']['postMessage']({'type':'init','options':_0x1e589d});},'setOptions':_0x33efde=>{const _0x41159e=_0x38ffb8;this[_0x41159e(0x2aa)]['postMessage']({'type':'setOptions','options':_0x33efde});},'setDate':_0x35dbe0=>{const _0x55321e=_0x38ffb8;this[_0x55321e(0x2aa)]['postMessage']({'type':'setDate','data':_0x35dbe0});},'update':()=>{const _0xc10d68=_0x38ffb8;if(this['_updateIng2'])return;this[_0xc10d68(0x2a8)]=!![],this['worker'][_0xc10d68(0x247)]({'type':'update'});},'clear':()=>{this['worker']['postMessage']({'type':'clear'});}},this['windField'][_0x38ffb8(0x2c2)](this['options']);}}mars3d__namespace['LayerUtil'][_0x5696fc(0x286)]('canvasWind',CanvasWindLayer),mars3d__namespace['layer']['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace[_0x5696fc(0x241)]=WindUtil,exports['CanvasWindField']=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
